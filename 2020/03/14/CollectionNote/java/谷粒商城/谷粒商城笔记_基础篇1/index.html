<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="momo"><meta name="copyright" content="momo"><meta name="generator" content="Hexo 5.2.0"><meta name="theme" content="hexo-theme-yun"><title>谷粒商城笔记_基础篇1 | 我的笔记</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"ppxiaodi.gitee.io","root":"/","title":"momo的小站","version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="谷粒商城笔记_基础篇1  本文由 简悦 SimpRead 转码， 原文地址 blog.csdn.net  本文重点记录老师讲的话 和 一些配置流程，耗时良久，视频文档内容基本都已文字识别后放到本文档。   springcloud 笔记：https:&#x2F;&#x2F;blog.csdn.net&#x2F;hancoder&#x2F;article&#x2F;details&#x2F;109063671   笔记 - 基础篇 - 1(P1-P28)：ht">
<meta property="og:type" content="article">
<meta property="og:title" content="谷粒商城笔记_基础篇1">
<meta property="og:url" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/index.html">
<meta property="og:site_name" content="我的笔记">
<meta property="og:description" content="谷粒商城笔记_基础篇1  本文由 简悦 SimpRead 转码， 原文地址 blog.csdn.net  本文重点记录老师讲的话 和 一些配置流程，耗时良久，视频文档内容基本都已文字识别后放到本文档。   springcloud 笔记：https:&#x2F;&#x2F;blog.csdn.net&#x2F;hancoder&#x2F;article&#x2F;details&#x2F;109063671   笔记 - 基础篇 - 1(P1-P28)：ht">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/e82aab83b242fc2d6ed4e2aedda46a09.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/daa627be6f5ec78f0a9849eb2ebc5fa8.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/fdc2f8288ce78208ae8283ba3badc009.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/fbb8434bb556db0c66a04c4cc82a02a2.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/7204fc79483b476668d6d1d22f60d3c0.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/6c67b73c8075604ff5b71aa4f95cdc43.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/2fdf100883db00cc9f66d2f815c7f6ba.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/bde1fce13ef5a36c94f931903d8d7d91.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/395c34887dc7cd9fbddfbde5b3cb919a.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/36abb19df131d0a12a64e1148e656d83.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/9326f35e00df660ec46058ecd9246fa6.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/8c98dccd0b06bda0e3cf5f8979804f47.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/686e6687aa58620e0dd6e19fb6ac3f51.png">
<meta property="og:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/d15088764d4c25830bebca3f7f533b21.png">
<meta property="article:published_time" content="2020-03-13T16:00:00.000Z">
<meta property="article:modified_time" content="2021-07-11T08:54:54.260Z">
<meta property="article:author" content="momo">
<meta property="article:tag" content="java">
<meta property="article:tag" content="谷粒商城">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/e82aab83b242fc2d6ed4e2aedda46a09.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="momo"><img width="96" loading="lazy" src="/yun.png" alt="momo"></a><div class="site-author-name"><a href="/about/">momo</a></div><a class="site-name" href="/about/site.html">我的笔记</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">198</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">58</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">47</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=kZJzggTTCf4SpvEQ8lXWoi5ZjhAx0ILZ&amp;jump_from=webapi" title="QQ 群 1050458482" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/jizhideyunyoujun" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/yunyoujun/" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=247102977" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/yunyoujun/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1579790" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/about/white-qrcode-and-search.jpg" title="微信公众号" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/YunYouJun" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/elpsycn" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@yunyoujun.cn" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-train-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">谷粒商城笔记_基础篇1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一、项目简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E5%BC%80%E5%8F%91%E6%AD%A4%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.1.1.</span> <span class="toc-text">如何快速开发此项目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">二、分布式基础概念</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%88%92%E5%88%86%E5%9B%BE"><span class="toc-number">1.2.0.0.1.</span> <span class="toc-text">微服务划分图</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81linux-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.</span> <span class="toc-text">三、linux 环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85-docker"><span class="toc-number">1.3.0.0.1.</span> <span class="toc-text">虚拟机安装 docker</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-mysql"><span class="toc-number">1.3.0.0.2.</span> <span class="toc-text">安装 mysql</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Redis"><span class="toc-number">1.3.0.0.3.</span> <span class="toc-text">Redis</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-nginx"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">安装 nginx</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81IDEA-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">1.4.</span> <span class="toc-text">四、IDEA 开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#maven"><span class="toc-number">1.4.0.0.1.</span> <span class="toc-text">maven</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vsCode"><span class="toc-number">1.4.0.0.2.</span> <span class="toc-text">vsCode</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81git-%E4%BB%A3%E7%A0%81%E7%9B%B8%E5%85%B3"><span class="toc-number">1.5.</span> <span class="toc-text">五、git 代码相关</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-git"><span class="toc-number">1.5.0.0.1.</span> <span class="toc-text">安装 git</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%81%E4%BA%91"><span class="toc-number">1.5.1.</span> <span class="toc-text">码云</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%B0%E6%9C%89%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">现有项目</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%8E-0-%E6%90%AD%E5%BB%BA"><span class="toc-number">1.5.1.1.1.</span> <span class="toc-text">从 0 搭建</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.6.</span> <span class="toc-text">六、数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VSCode-%E5%87%86%E5%A4%87"><span class="toc-number">1.6.1.</span> <span class="toc-text">VSCode 准备</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%BA%BA%E4%BA%BA%E9%A1%B9%E7%9B%AE-npm"><span class="toc-number">1.7.</span> <span class="toc-text">七、人人项目 npm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%87%AA%E5%B7%B1%E6%90%AD%E5%BB%BA%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">1 自己搭建的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%BA%E4%BA%BA-vue%EF%BC%88npm%EF%BC%89"><span class="toc-number">1.7.1.0.1.</span> <span class="toc-text">人人 vue（npm）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-fast-vue-%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.7.2.</span> <span class="toc-text">启动 fast-vue 项目</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#P16-npm-install-%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">P16 npm install 报错问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E4%BA%BA%E4%BA%BA%E9%A1%B9%E7%9B%AE-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-number">1.8.</span> <span class="toc-text">八、人人项目 - 逆向工程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">1.8.0.0.1.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#coupon"><span class="toc-number">1.8.0.1.</span> <span class="toc-text">coupon</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#member"><span class="toc-number">1.8.0.2.</span> <span class="toc-text">member</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#order"><span class="toc-number">1.8.0.3.</span> <span class="toc-text">order</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ware"><span class="toc-number">1.8.0.4.</span> <span class="toc-text">ware</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81SpringCloud-Alibaba-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.9.</span> <span class="toc-text">九、SpringCloud Alibaba 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81Nacos-8848"><span class="toc-number">1.10.</span> <span class="toc-text">十、Nacos-8848</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81Feign%EF%BC%88%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%EF%BC%89%E4%B8%8E%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-number">1.11.</span> <span class="toc-text">十一、Feign（远程调用）与注册中心</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#nacos-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-number">1.11.0.0.1.</span> <span class="toc-text">nacos 作为配置中心</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E7%BD%91%E5%85%B3-gateway-88"><span class="toc-number">1.12.</span> <span class="toc-text">十二、网关 gateway-88</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E5%89%8D%E7%AB%AF-vue-8001-%E5%92%8C-element-ui"><span class="toc-number">1.13.</span> <span class="toc-text">十三、前端 vue-8001 和 element-ui</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="toc-number">1.14.</span> <span class="toc-text">十四、三级分类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#element-ui-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.14.0.1.</span> <span class="toc-text">element-ui 的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pms-category-%E8%A1%A8%E8%AF%B4%E6%98%8E"><span class="toc-number">1.14.0.2.</span> <span class="toc-text">pms_category 表说明</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#sql-%E6%B3%A8%EF%BC%9A"><span class="toc-number">1.14.0.2.1.</span> <span class="toc-text">sql 注：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%8D%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98"><span class="toc-number">1.14.0.2.2.</span> <span class="toc-text">验证码不显示问题</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8F%9C%E5%8D%95%E8%B7%AF%E7%94%B1"><span class="toc-number">1.14.0.2.3.</span> <span class="toc-text">菜单路由</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E5%85%B3-88"><span class="toc-number">1.14.0.2.4.</span> <span class="toc-text">网关 88</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E5%85%B3-%E8%B7%AF%E5%BE%84%E9%87%8D%E5%86%99"><span class="toc-number">1.14.0.2.5.</span> <span class="toc-text">网关 - 路径重写</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F-P47"><span class="toc-number">1.14.0.3.</span> <span class="toc-text">跨域 P47</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#P48-product-%E8%B7%AF%E5%BE%84%E9%87%8D%E5%86%99"><span class="toc-number">1.14.0.4.</span> <span class="toc-text">P48 product 路径重写</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%94%E8%AE%B0-2"><span class="toc-number">1.15.</span> <span class="toc-text">笔记 2</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="momo"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="我的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">谷粒商城笔记_基础篇1</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-14T00:00:00+08:00">2020-03-14</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2021-07-11 16:54:54" itemprop="dateModified" datetime="2021-07-11T16:54:54+08:00">2021-07-11</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/java/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">java</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">谷粒商城</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/java/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">java</span></a><a class="tag-item" href="/tags/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">谷粒商城</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1>谷粒商城笔记_基础篇1</h1>
<blockquote>
<p>本文由 <a target="_blank" rel="noopener" href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/106922139">blog.csdn.net</a></p>
</blockquote>
<p>本文重点记录老师讲的话 和 一些配置流程，耗时良久，视频文档内容基本都已文字识别后放到本文档。</p>
<ul>
<li>
<p>springcloud 笔记：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/109063671">https://blog.csdn.net/hancoder/article/details/109063671</a></p>
</li>
<li>
<p>笔记 - 基础篇 - 1(P1-P28)：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/106922139">https://blog.csdn.net/hancoder/article/details/106922139</a></p>
</li>
<li>
<p>笔记 - 基础篇 - 2(P28-P100)：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612619">https://blog.csdn.net/hancoder/article/details/107612619</a></p>
</li>
<li>
<p>笔记 - 高级篇：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612746">https://blog.csdn.net/hancoder/article/details/107612746</a></p>
</li>
<li>
<p>笔记 - 集群篇：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612802">https://blog.csdn.net/hancoder/article/details/107612802</a></p>
</li>
<li>
<p>笔记版本说明：之前提供过笔记文档，但只有 P1-P50 的内容，2021 年 2 月版为至 P250 的内容。请点击【下面】分栏查看系列笔记</p>
</li>
<li>
<p>笔记下载地址 (2021 版本)：</p>
<ul>
<li>离线 md 笔记为什么不开源：主要原因是笔记未整理结束，不希望广播出去 beta 版，csdn 上是最新版内容，10W 字都是在 csdn 免费开放观看的。此外笔记内图床流量等需要我续费，每打开一次离线 md 笔记我的流量就溜走几十 M，确实顶不住，请见谅</li>
</ul>
</li>
<li>
<p>sql：<a target="_blank" rel="noopener" href="https://github.com/FermHan/gulimall/sql%E6%96%87%E4%BB%B6">https://github.com/FermHan/gulimall/sql 文件</a></p>
</li>
<li>
<p>启动项目顺序：<a target="_blank" rel="noopener" href="https://github.com/FermHan/gulimall/blob/main">https://github.com/FermHan/gulimall/blob/main</a> / 启动项目顺序. md</p>
</li>
</ul>
<blockquote>
<p>本文 1.5W 字，请直接 ctrl+F 搜索内容</p>
</blockquote>
<h2 id="一、项目简介"><a class="header-anchor" href="#一、项目简介">¶</a>一、项目简介</h2>
<h3 id="如何快速开发此项目"><a class="header-anchor" href="#如何快速开发此项目">¶</a>如何快速开发此项目</h3>
<p>最好的方式当然是手敲代码了，但是对于大多数人来说 100 多小时的视频时长，加上手敲代码，得 1 个月起步了。</p>
<p>所以我推荐你可以构建自己的项目，但一定要下载别人的项目，选择性 复制里面的文件，因为有挺多东西手敲其实有点费时。</p>
<blockquote>
<p>原则是文件是自己创建出来的，而里面的代码内容是听到课时复制进去的。</p>
<p>如果你还想更快，直接用别人的 vue 项目吧，但 java 项目还是得自己搭建</p>
</blockquote>
<p>但一定要保证搞懂，比如我有复制别人的一些代码，但我借着笔记也做小结。</p>
<p>另外本项目适合人群：学过 ssm 是必须的。</p>
<p>项目里有 mybatis-plus 和 springcloud 的内容，你可以用本项目来做实操，也可以利用本项目初识 cloud，但最好还是对微服务有一定了解。</p>
<p>给常用项目加了热部署等</p>
<p>sql：<a target="_blank" rel="noopener" href="https://github.com/FermHan/gulimall">https://github.com/FermHan/gulimall</a></p>
<p>打赏码与离线 markdown 笔记个人邮箱在文尾</p>
<h2 id="二、分布式基础概念"><a class="header-anchor" href="#二、分布式基础概念">¶</a>二、分布式基础概念</h2>
<p>集群是个物理形态，分布式是个工作方式。</p>
<p>远程调用：在分布式系统中，各个服务可能处于不同主机，但是服务之间不可避免的相互调用，我们成为远程调用</p>
<p>springcloud 中使用 HTTP+JSON 的方式完成远程调用</p>
<p><strong>服务注册 / 发现 &amp; 注册中心</strong></p>
<p>A 服务调用 B 服务，A 服务并不知道 B 服务当前在哪几台服务器有，那些是正常的，那些服务已经下线。解决这个问题可以引入注册中心。</p>
<p>配置中心用来几种管理微服务的配置信息。</p>
<p><strong>服务熔断 &amp; 服务降级</strong></p>
<p>在微服务架构中，微服务之间通过网络进行通信，存在相互依赖，当其中一个服务不可用时，有可能会造成雪崩效应。要防止这样的情况，必须要有容错机制来保护服务。</p>
<p>rpc</p>
<p>情景：</p>
<p>订单服务 --&gt; 商品服务 --&gt; 库存服务</p>
<p>库存服务出现故障导致响应慢，导致商品服务需要等待，可能等到 10s 后库存服务才能响应。库存服务的不可用导致商品服务阻塞，商品服务等的期间，订单服务也处于阻塞。一个服务不可用导致整个服务链都阻塞。如果是高并发，第一个请求调用后阻塞 10s 得不到结果，第二个请求直接阻塞 10s。更多的请求进来导致请求积压，全部阻塞，最终服务器的资源耗尽。导致雪崩</p>
<p>解决方案：</p>
<p>1 服务熔断</p>
<p>指定超时时间，库存服务 3s 没有响应就超时，如果经常失败，比如 10s 内 100 个请求都失败了。开启断路保护机制，下一次请求进来不调用库存服务了，因为上一次 100% 错误都出现了，我们直接在此中断，商品服务直接返回，返回一些默认数据或者 null，而不调用库存服务了，这样就不会导致请求积压。</p>
<ul>
<li>设置服务的超时，当被调用的服务经常失败到达某个阈值，我们可以开启断路保护机制，后来的请求不再去调用这个服务。本地直接返回默认的数据</li>
</ul>
<p>2 服务降级</p>
<ul>
<li>在运维期间，当系统处于高峰期，系统资源紧张，我们可以让非核心业务降级运行。降级：某些服务不处理，或者处理简单【抛异常、返回 NULL、调用 Mock 数据、调用 Faaback 处理逻辑】</li>
</ul>
<p><strong>API 网关</strong></p>
<p>客户端发送请求到服务器路途中，设置一个网关，请求都先到达网关，网关对请求进行统一认证（合法非法）和处理等操作。他是安检。</p>
<p>在微服务架构中，API gateway 作为整体架构的重要组件，它抽象了微服务中都需要的公共功能，同时提供了客户端负载均衡，服务自动熔断，灰度发布，统一认证，限流流控，日志统计等丰富的功能，帮助我们解决很多 API 管理难题。</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/e82aab83b242fc2d6ed4e2aedda46a09.png" class="" loading="lazy">
<p>前后分离开发，分为内网部署和外网部署，外网是面向公众访问的，部署前端项目，可以有手机 APP，电脑网页；内网部署的是后端集群，前端在页面上操作发送请求到后端，在这途中会经过 Nginx 集群，Nginx 把请求转交给 API 网关 (springcloud gateway)（网关可以根据当前请求动态地路由到指定的服务，看当前请求是想调用商品服务还是购物车服务还是检索），从路由过来如果请求很多，可以负载均衡地调用商品服务器中一台（商品服务复制了多份），当商品服务器出现问题也可以在网关层面对服务进行熔断或降级（使用阿里的 sentinel 组件），网关还有其他的功能如认证授权、限流（只放行部分到服务器）等。</p>
<p>到达服务器后进行处理（springboot 为微服务），服务与服务可能会相互调用（使用 feign 组件），有些请求可能经过登录才能进行（基于 OAuth2.0 的认证中心。安全和权限使用 springSecurity 控制）</p>
<p>服务可能保存了一些数据或者需要使用缓存，我们使用 redis 集群（分片 + 哨兵集群）。持久化使用 mysql，读写分离和分库分表。</p>
<p>服务和服务之间会使用消息队列（RabbitMQ），来完成异步解耦，分布式事务的一致性。有些服务可能需要全文检索，检索商品信息，使用 ElaticSearch。</p>
<p>服务可能需要存取数据，使用阿里云的对象存储服务 OSS。</p>
<p>项目上线后为了快速定位问题，使用 ELK 对日志进行处理，使用 LogStash 收集业务里的各种日志，把日志存储到 ES 中，用 Kibana 可视化页面从 ES 中检索出相关信息，帮助我们快速定位问题所在。</p>
<p>在分布式系统中，由于我们每个服务都可能部署在很多台机器，服务和服务可能相互调用，就得知道彼此都在哪里，所以需要将所有服务都注册到注册中心。服务从注册中心发现其他服务所在位置（使用阿里 Nacos 作为注册中心）。</p>
<p>每个服务的配置众多，为了实现改一处配置相同配置就同步更改，就需要配置中心，也使用阿里的 Nacos，服务从配置中心中动态取配置。</p>
<p>服务追踪，追踪服务调用链哪里出现问题，使用 springcloud 提供的 Sleuth、Zipkin、Metrics，把每个服务的信息交给开源的 Prometheus 进行聚合分析，再由 Grafana 进行可视化展示，提供 Prometheus 提供的 AlterManager 实时得到服务的告警信息，以短信 / 邮件的方式告知服务开发人员。</p>
<p>还提供了持续集成和持续部署。项目发布起来后，因为微服务众多，每一个都打包部署到服务器太麻烦，有了持续集成后开发人员可以将修改后的代码提交到 github，运维人员可以通过自动化工具 Jenkins Pipeline 将 github 中获取的代码打包成 docker 镜像，最终是由 k8s 集成 docker 服务，将服务以 docker 容器的方式运行。</p>
<h5 id="微服务划分图"><a class="header-anchor" href="#微服务划分图">¶</a>微服务划分图</h5>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/daa627be6f5ec78f0a9849eb2ebc5fa8.png" class="" loading="lazy">
<p>反映了需要创建的微服务以及相关技术。</p>
<p>前后分离开发。前端项目分为 admin-vue（工作人员使用的后台管理系统）、shop-vue（面向公众访问的 web 网站）、app（公众）、小程序（公众）</p>
<ul>
<li>商品服务：商品的增删改查、商品的上下架、商品详情</li>
<li>支付服务</li>
<li>优惠服务</li>
<li>用户服务：用户的个人中心、收货地址</li>
<li>仓储服务：商品的库存</li>
<li>秒杀服务：</li>
<li>订单服务：订单增删改查</li>
<li>检索服务：商品的检索 ES</li>
<li>中央认证服务：登录、注册、单点登录、社交登录</li>
<li>购物车服务：</li>
<li>后台管理系统：添加优惠信息等</li>
</ul>
<h2 id="三、linux-环境搭建"><a class="header-anchor" href="#三、linux-环境搭建">¶</a>三、linux 环境搭建</h2>
<p>visualBox 进行安装需要 cpu 开启虚拟化，在开机启动的时候设置主板，CPU configuration，然后点击 Intel Vitualization Technology。重启电脑</p>
<p>普通安装 linux 虚拟机太麻烦，可以利用 vagrant 可以帮助我们快速地创建一个虚拟机。主要装了 vitualbox，vagrant 可以帮助我们快速创建出一个虚拟机。他有一个镜像仓库。</p>
<p>去 <a target="_blank" rel="noopener" href="https://www.vagrantup.com/">https://www.vagrantup.com/</a> 下载 vagrant 安装，安装后重启系统。cmd 中输入 vagrant 有版本代表成功了。</p>
<p>输入<code>vagrant init centos/7</code>，即可初始化一个 centos7 系统。（注意这个命令在哪个目录下执行的，他的 Vagrantfile 就生成在哪里）</p>
<p><code>vagrant up</code>启动虚拟机环境。</p>
<p>启动后出现 default folder:/cygdrive/c/User/… =&gt;/vagrant。然后 ctrl+c 退出</p>
<p>前面的页面中有 ssh 账号信息。<code>vagrant ssh</code> 就会连上虚拟机。可以使用 exit 退出</p>
<blockquote>
<p>下次使用也可以直接 vagrant up 直接启动，但要确保当前目录在 C:/ 用户 / 文件夹下，他下面有一个<code>Vagrantfile</code>，不过我们也可以配置环境变量。</p>
<p>启动后再次<code>vagrant ssh</code>连上即可</p>
</blockquote>
<p>不过他使用的网络方式是网络地址转换 NAT（端口转发），如果其他主机要访问虚拟机，必须由 windows 端口如 3333 断发给虚拟机端口如 3306。这样每在 linux 里安一个软件都要进行端口映射，不方便，（也可以在 virualBox 里挨个设置）。我们想要给虚拟机一个固定的 ip 地址，windows 和虚拟机可以互相 ping 通。</p>
<ul>
<li>
<p>方式 1 是在虚拟机中配置静态 ip。</p>
</li>
<li>
<p>也可以更改 Vagrantfile 更改虚拟机 ip，修改其中的<code>config.vm.network &quot;private_network&quot;,ip:&quot;192.168.56.10&quot;</code>，这个 ip 需要在 windows 的 ipconfig 中查到 vitualbox 的虚拟网卡 ip，然后更改下最后一个数字就行（不能是 1，1 是我们的主机）。配置完后 vagrant reload 重启虚拟机。在虚拟机中<code>ip addr</code>就可以查看到地址了。互相 ping 也能 ping 通。</p>
</li>
<li>
<p>关掉防火墙，VirualBox 中第一个网卡设置 NAT，第二个网卡设置仅主机</p>
</li>
<li>
<p>如果 ping 不了 baidu</p>
<ul>
<li>
<p>cd /etc/sysconfig/network-scripts</p>
</li>
<li>
<p>ls 一般有 ifcfg-eth0 1</p>
</li>
<li>
<p>ip addr 看哪个网格是 192.168.56 网段，然后 vim 他</p>
</li>
<li>
<p>vim ifcfg-eth1 加入</p>
<pre class="line-numbers language-none"><code class="language-none">GATEWAY&#x3D;192.168.56.1
DNS1&#x3D;114.114.114.114
DNS2&#x3D;8.8.8.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>service network restart</p>
</li>
</ul>
</li>
</ul>
<p>默认只允许 ssh 登录方式，为了后来操作方便，文件上传等，我们可以配置允许账号密码登录</p>
<pre class="line-numbers language-none"><code class="language-none">vim &#x2F;etc&#x2F;ssh&#x2F;sshd_config
修改
PasswordAuthentication yes
重启
service sshd restart
账号root
密码vagrant<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>配置源</p>
<pre class="line-numbers language-none"><code class="language-none"># 备份原yum源

mv &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo.backup
# 使用新yum源
curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.163.com&#x2F;.help&#x2F;CentOS7-Base-163.repo
# 生成缓存
yum makecache<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="虚拟机安装-docker"><a class="header-anchor" href="#虚拟机安装-docker">¶</a>虚拟机安装 docker</h5>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<pre class="line-numbers language-none"><code class="language-none">#卸载系统之前的docker 
sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine
                  
                  
sudo yum install -y yum-utils

# 配置镜像
sudo yum-config-manager \
    --add-repo \
    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo
    
sudo yum install docker-ce docker-ce-cli containerd.io

sudo systemctl start docker
# 设置开机自启动
sudo systemctl enable docker

docker -v
sudo docker images

# 配置镜像加速<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-qingdao/instances/mirrors">https://cr.console.aliyun.com/cn-qingdao/instances/mirrors</a></p>
<p>根据页面命令执行完命令</p>
<pre class="line-numbers language-none"><code class="language-none">sudo mkdir -p &#x2F;etc&#x2F;docker
sudo tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;
&#123;
  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;chqac97z.mirror.aliyuncs.com&quot;]
&#125;
EOF

sudo systemctl daemon-reload
sudo systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="安装-mysql"><a class="header-anchor" href="#安装-mysql">¶</a>安装 mysql</h5>
<p>用 docker 安装上 mysql，去 docker 仓库里搜索 mysql</p>
<pre class="line-numbers language-none"><code class="language-none">sudo docker pull mysql:5.7

# --name指定容器名字 -v目录挂载 -p指定端口映射  -e设置mysql参数 -d后台运行
sudo docker run -p 3306:3306 --name mysql \
-v &#x2F;mydata&#x2F;mysql&#x2F;log:&#x2F;var&#x2F;log&#x2F;mysql \
-v &#x2F;mydata&#x2F;mysql&#x2F;data:&#x2F;var&#x2F;lib&#x2F;mysql \
-v &#x2F;mydata&#x2F;mysql&#x2F;conf:&#x2F;etc&#x2F;mysql \
-e MYSQL_ROOT_PASSWORD&#x3D;root \
-d mysql:5.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">su root 密码为vagrant，这样就可以不写sudo了<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@localhost vagrant]# docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                               NAMES
6a685a33103f        mysql:5.7           &quot;docker-entrypoint.s…&quot;   32 seconds ago      Up 30 seconds       0.0.0.0:3306-&gt;3306&#x2F;tcp, 33060&#x2F;tcp   mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">docker exec -it mysql bin&#x2F;bash
exit;

因为有目录映射，所以我们可以直接在镜像外执行
vi &#x2F;mydata&#x2F;mysql&#x2F;conf&#x2F;my.conf 

[client]
default-character-set&#x3D;utf8
[mysql]
default-character-set&#x3D;utf8
[mysqld]
init_connect&#x3D;&#39;SET collation_connection &#x3D; utf8_unicode_ci&#39;
init_connect&#x3D;&#39;SET NAMES utf8&#39;
character-set-server&#x3D;utf8
collation-server&#x3D;utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve

保存(注意评论区该配置不对，不是collection而是collation)

docker restart mysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>如何通过其他工具链接 ssh</p>
<p>修改 / etc/ssh/sshd_config</p>
<p>修改 PasswordAuthentication yes</p>
<p>systemctl restart sshd.service 或 service sshd restart</p>
<p>连接 192.168.56.10:22 端口成功，用户名 root，密码 vagrant</p>
<p>也可以通过 vagrant ssh-config 查看 ip 和端口，此时是 127.0.0.1:2222</p>
</blockquote>
<h5 id="Redis"><a class="header-anchor" href="#Redis">¶</a>Redis</h5>
<p>如果直接挂载的话 docker 会以为挂载的是一个目录，所以我们先创建一个文件然后再挂载，在虚拟机中。</p>
<pre class="line-numbers language-none"><code class="language-none"># 在虚拟机中
mkdir -p &#x2F;mydata&#x2F;redis&#x2F;conf
touch &#x2F;mydata&#x2F;redis&#x2F;conf&#x2F;redis.conf

docker pull redis

docker run -p 6379:6379 --name redis \
-v &#x2F;mydata&#x2F;redis&#x2F;data:&#x2F;data \
-v &#x2F;mydata&#x2F;redis&#x2F;conf&#x2F;redis.conf:&#x2F;etc&#x2F;redis&#x2F;redis.conf \
-d redis redis-server &#x2F;etc&#x2F;redis&#x2F;redis.conf

# 直接进去redis客户端。
docker exec -it redis redis-cli<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>默认是不持久化的。在配置文件中输入 appendonly yes，就可以 aof 持久化了。修改完 docker restart redis，docker -it redis redis-cli</p>
<pre class="line-numbers language-none"><code class="language-none">vim &#x2F;mydata&#x2F;redis&#x2F;conf&#x2F;redis.conf
# 插入下面内容
appendonly yes
保存

docker restart redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>设置 redis 容器在 docker 启动的时候启动</p>
<pre class="line-numbers language-none"><code class="language-none">docker update redis --restart&#x3D;always<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="安装-nginx"><a class="header-anchor" href="#安装-nginx">¶</a>安装 nginx</h4>
<p>安装 nginx 为 P124 的内容</p>
<pre class="line-numbers language-none"><code class="language-none">docker pull nginx:1.10
# 随便启动一个nginx实例，只是为了复制出配置
docker run -p 80:80 --name nginx -d nginx:1.10

cd &#x2F;mydata&#x2F;nginx
docker container cp nginx:&#x2F;etc&#x2F;nginx .
然后在外部 &#x2F;mydata&#x2F;nginx&#x2F;nginx 有了一堆文件
mv &#x2F;mydata&#x2F;nginx&#x2F;nginx &#x2F;mydata&#x2F;nginx&#x2F;conf
# 停掉nginx
docker stop nginx
docker rm nginx

# 创建新的nginx
docker run -p 80:80 --name nginx \
-v &#x2F;mydata&#x2F;nginx&#x2F;html:&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html \
-v &#x2F;mydata&#x2F;nginx&#x2F;logs:&#x2F;var&#x2F;log&#x2F;nginx \
-v &#x2F;mydata&#x2F;nginx&#x2F;conf:&#x2F;etc&#x2F;nginx \
-d nginx:1.10


docker update nginx --restart&#x3D;always<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>测试</p>
<pre class="line-numbers language-none"><code class="language-none">cd &#x2F;mydata&#x2F;nginx&#x2F;html&#x2F;
vim index.html
随便写写
测试 http:&#x2F;&#x2F;192.168.56.10:80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="四、IDEA-开发环境"><a class="header-anchor" href="#四、IDEA-开发环境">¶</a>四、IDEA 开发环境</h2>
<h5 id="maven"><a class="header-anchor" href="#maven">¶</a>maven</h5>
<p>在 settings 中配置阿里云镜像，配置 jdk1.8。这个基本都配置过，不贴了</p>
<p>IDEA 安装插件 lombok，mybatisX。IDEA 设置里配置好 maven</p>
<h5 id="vsCode"><a class="header-anchor" href="#vsCode">¶</a>vsCode</h5>
<p>下载 vsCode 用于前端管理系统。在 vsCode 里安装插件。</p>
<ul>
<li>Auto Close Tag</li>
<li>Auto Rename Tag</li>
<li>Chinese</li>
<li>ESlint</li>
<li>HTML CSS Support</li>
<li>HTML Snippets</li>
<li>JavaScript ES6</li>
<li>Live Server</li>
<li>open in brower</li>
<li>Vetur</li>
</ul>
<h2 id="五、git-代码相关"><a class="header-anchor" href="#五、git-代码相关">¶</a>五、git 代码相关</h2>
<h5 id="安装-git"><a class="header-anchor" href="#安装-git">¶</a>安装 git</h5>
<p>下载 git 客户端，右键桌面 Git GUI/bash Here。去 bash，</p>
<pre class="line-numbers language-none"><code class="language-none"># 配置用户名
git config --global user.name &quot;username&quot;  &#x2F;&#x2F;(名字，随意写)

# 配置邮箱
git config --global user.email &quot;55333@qq.com&quot; &#x2F;&#x2F; 注册账号时使用的邮箱

# 配置ssh免密登录
ssh-keygen -t rsa -C &quot;55333@qq.com&quot;
三次回车后生成了密钥：公钥私钥
cat ~&#x2F;.ssh&#x2F;id_rsa.pub

也可以查看密钥
浏览器登录码云后，个人头像上点设置--ssh公钥---随便填个标题---复制
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6MWhGXSKdRxr1mGPZysDrcwABMTrxc8Va2IWZyIMMRHH9Qn&#x2F;wy3PN2I9144UUqg65W0CDE&#x2F;thxbOdn78MygFFsIG4j0wdT9sdjmSfzQikLHFsJ02yr58V6J2zwXcW9AhIlaGr+XIlGKDUy5mXb4OF+6UMXM6HKF7rY9FYh9wL6bun9f1jV4Ydlxftb&#x2F;xtV8oQXXNJbI6OoqkogPKBYcNdWzMbjJdmbq2bSQugGaPVnHEqAD74Qgkw1G7SIDTXnY55gBlFPVzjLWUu74OWFCx4pFHH6LRZOCLlMaJ9haTwT2DB&#x2F;sFzOG&#x2F;Js+cEExx&#x2F;arJ2rvvdmTMwlv&#x2F;T+6xhrMS3 553736044@qq.com

# 测试
ssh -T git@gitee.com
测试成功，就可以无密给码云推送仓库了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="码云"><a class="header-anchor" href="#码云">¶</a>码云</h3>
<blockquote>
<p>本课程老师选用的是 gitee，你选择提交到 github 也可以</p>
</blockquote>
<h4 id="现有项目"><a class="header-anchor" href="#现有项目">¶</a>现有项目</h4>
<p>项目刚出来的时候老师没把代码放出来，但现在好像把完整版的代码放出来了，所以你可以运行老师给的项目试一下。</p>
<p>但是老师的项目 nacos 等信息可能没有，还需要你自己搭建。一个好的方式是编译 nacos 的源码项目到 IDEA 中。而这种解决方案网上开源的同学们都是这么做的。</p>
<p>除此之外，基本老师给的项目里都全了，你要做的就是改改里面的配置信息等。作为参数，我提供一个别人的链接吧</p>
<p><code>https://github.com/1046762075/mall</code>，把他拉取到你的本地或者克隆到你的码云上再拉取都可以</p>
<h5 id="从-0-搭建"><a class="header-anchor" href="#从-0-搭建">¶</a>从 0 搭建</h5>
<p>在码云新建仓库，仓库名 gulimall，选择语言 java，在. gitignore 选中 maven（就会忽略掉 maven 一些个人无需上传的配置文件），许可证选 Apache-2.0，开发模型选生成 / 开发模型，开发时在 dev 分支，发布时在 master 分支，创建。</p>
<p>在 IDEA 中 New–Project from version control–git–复制刚才项目的地址，如<code>https://github.com/1046762075/mall</code></p>
<p>IDEA 然后 New Module–Spring Initializer–com.atguigu.gulimall ， Artifact 填 gulimall-product。Next—选择<code>web</code>（web 开发），springcloud routing 里选中<code>openFeign</code>（rpc 调用）。</p>
<p>依次创建出以下服务</p>
<ul>
<li>商品服务 product</li>
<li>存储服务 ware</li>
<li>订单服务 order</li>
<li>优惠券服务 coupon</li>
<li>用户服务 member</li>
</ul>
<p>共同点：</p>
<ul>
<li>导入 web 和 openFeign</li>
<li>group：com.atguigu.gulimall</li>
<li>Artifact：gulimall-XXX</li>
<li>每一个服务，包名 <a target="_blank" rel="noopener" href="http://com.atguigu.gulimall.XXX">com.atguigu.gulimall.XXX</a>{product/order/ware/coupon/member}</li>
<li>模块名：gulimall-XXX</li>
</ul>
<p>然后右下角显示了 springboot 的 service 选项，选择他</p>
<p>从某个项目粘贴个 pom.xml 粘贴到项目目录，修改他</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;
&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;
	xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 https:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;
	&lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;

	&lt;groupId&gt;com.atguigu.gulimall&lt;&#x2F;groupId&gt;
	&lt;artifactId&gt;gulimall&lt;&#x2F;artifactId&gt;
	&lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;
	&lt;name&gt;gulimall&lt;&#x2F;name&gt;
	&lt;description&gt;聚合服务&lt;&#x2F;description&gt;

	&lt;packaging&gt;pom&lt;&#x2F;packaging&gt;

	&lt;modules&gt;
		&lt;module&gt;gulimall-coupon&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-member&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-order&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-product&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-ware&lt;&#x2F;module&gt;

	&lt;&#x2F;modules&gt;

&lt;&#x2F;project&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 maven 窗口刷新，并点击 + 号，找到刚才的 pom.xml 添加进来，发现多了个 root。这样比如运行 root 的 clean 命令，其他项目也一起 clean 了。</p>
<p>修改总项目的<code>.gitignore</code>，把小项目里的垃圾文件在提交的时候忽略掉，比如 <a target="_blank" rel="noopener" href="http://HELP.md">HELP.md</a>。。。</p>
<pre class="line-numbers language-none"><code class="language-none">**&#x2F;mvnw
**&#x2F;mvnw.cmd
**&#x2F;.mvn
**&#x2F;target&#x2F;
.idea
**&#x2F;.gitignore<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>如果你是拉取的我的仓库，你也可以看到我仓库里是没有那些 target 目录的，非常精简</p>
</blockquote>
<p>在 version control/local Changes，点击刷新看 Unversioned Files，可以看到变化。</p>
<p>全选最后剩下 21 个文件，选择右键、Add to VCS。</p>
<p>在 IDEA 中安装插件：gitee，重启 IDEA。</p>
<p>在 D 额 fault changelist 右键点击 commit，去掉右面的勾选 Perform code analysis、CHECK TODO，然后点击 COMMIT，有个下拉列表，点击 commit and push 才会提交到云端。此时就可以在浏览器中看到了。</p>
<ul>
<li>commit 只是保存更新到本地</li>
<li>push 才是提交到 gitee</li>
</ul>
<h2 id="六、数据库"><a class="header-anchor" href="#六、数据库">¶</a>六、数据库</h2>
<p>课件提供了 sql，但是里面只有表，没有数据，所以建议不要用课件里的。</p>
<p>另外视频评论区的 sql 文件有问题，后面和 sql 查询 java-entity 类对应不上，我看了下准确的应该是视频评论区 == <a target="_blank" rel="noopener" href="https://space.bilibili.com/59372233">特立独行ベ猫</a> == 那个版本的：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/1046762075/mall/tree/master/%E7%AC%94%E8%AE%B0%E3%80%81RabbitMQ%E9%98%9F%E5%88%97%E4%BF%A1%E6%81%AF%E3%80%81nginx%E9%85%8D%E7%BD%AE%E3%80%81SQL%E3%80%81%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E3%80%81%E5%9F%9F%E5%90%8D%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/SQL">https://github.com/1046762075/mall/tree/master/笔记、RabbitMQ队列信息、nginx配置、SQL、静态资源、域名解决方案/SQL</a></p>
<p>但是这个 sql 也得自己改一下（改数据库 database 的问题，还有他 admin 那个数据库里的表名也不对劲，他可能有自己的规则，但我们还是按视频中的来），所以弃用了他的 admin 库</p>
<p>我自己修改过的 sql 上传到了：<a target="_blank" rel="noopener" href="https://github.com/FermHan/gulimall">https://github.com/FermHan/gulimall</a></p>
<p>如何改：加上类似下面的语句</p>
<pre class="line-numbers language-none"><code class="language-none">CREATE DATABASE &#x2F;*!32312 IF NOT EXISTS*&#x2F;&#96;guli_pms&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8mb4 *&#x2F;;

-- 根据需要改数据库名即可，表名无需改动
USE &#96;guli_pms&#96;;
-- 也集合P71的内容进行了修改<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>我把 sql 文件也放到了 IDEA 项目中，项目中有个<code>sql.zip</code>就是 sql 文件</p>
</blockquote>
<p>因为已经有人贡献 sql 文件了，所以我们不理会下面引用部分的内容了。</p>
<blockquote>
<p>安装 powerDesigner 软件。<a target="_blank" rel="noopener" href="http://forspeed.onlinedown.net/down/powerdesigner1029.zip">http://forspeed.onlinedown.net/down/powerdesigner1029.zip</a></p>
<p>其他软件：<br>
<a target="_blank" rel="noopener" href="https://www.lanzous.com/b015ag33e">https://www.lanzous.com/b015ag33e</a></p>
<p>密码: 2wre</p>
<p>所有的数据库数据再复杂也不建立外键，因为在电商系统里，数据量大，做外键关联很耗性能。</p>
<p>name 是给我们看的，code 才是数据库里真正的信息。</p>
<p>选择 primary 和 identity 作为主键。然后点 preview 就可以看到生成这张表的语句。</p>
<p>点击菜单栏 database–generate database—点击确定</p>
</blockquote>
<p>找到评论区的 sql 文件，打开 sqlyog 软件，链接（linux 里的 mysql docker 镜像）192.168.56.10，账号密码 root。</p>
<blockquote>
<p>注意重启虚拟机和 docker 后里面的容器就关了。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">sudo docker ps
sudo docker ps -a
# 这两个命令的差别就是后者会显示  【已创建但没有启动的容器】

# 我们接下来设置我们要用的容器每次都是自动启动
sudo docker update redis --restart&#x3D;always
sudo docker update mysql --restart&#x3D;always
# 如果不配置上面的内容的话，我们也可以选择手动启动
sudo docker start mysql
sudo docker start redis
# 如果要进入已启动的容器
sudo docker exec -it mysql &#x2F;bin&#x2F;bash
# &#x2F;bin&#x2F;bash就是进入一般的命令行，如果改成redis就是进入了redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后接着去 sqlyog 执行我们的操作，在左侧 root 上右键建立数据库：字符集选 utf8mb4，他能兼容 utf8 且能解决一些乱码的问题。分别建立了下面数据库（根据自己情况来）</p>
<pre class="line-numbers language-none"><code class="language-none">gulimall-oms
gulimall-pms
gulimall-sms
gulimall-ums
gulimall-wms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后打开对应的 sql 在对应的数据库中执行。依次执行。(注意 sql 文件里没有建库语句)</p>
<h3 id="VSCode-准备"><a class="header-anchor" href="#VSCode-准备">¶</a>VSCode 准备</h3>
<p>点击执行 sql 脚本，依次选择评论区给的压缩包里的 sql 语句</p>
<h2 id="七、人人项目-npm"><a class="header-anchor" href="#七、人人项目-npm">¶</a>七、人人项目 npm</h2>
<h3 id="1-自己搭建的方式"><a class="header-anchor" href="#1-自己搭建的方式">¶</a>1 自己搭建的方式</h3>
<p>在码云上搜索人人开源，我们使用 renren-fast（后端）、renren-fast-vue（前端）项目。</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/renrenio">https://gitee.com/renrenio</a></p>
<pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;gitee.com&#x2F;renrenio&#x2F;renren-fast.git

git clone https:&#x2F;&#x2F;gitee.com&#x2F;renrenio&#x2F;renren-fast-vue.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>下载到了桌面，我们把 renren-fast 移动到我们的项目文件夹（删掉. git 文件），而 renren-vue 是用 VSCode 打开的（后面再弄）</p>
<p>在 IDEA 项目里的 pom.xml 添加一个 renrnen-fast</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;modules&gt;
    &lt;module&gt;gulimall-coupon&lt;&#x2F;module&gt;
    &lt;module&gt;gulimall-member&lt;&#x2F;module&gt;
    &lt;module&gt;gulimall-order&lt;&#x2F;module&gt;
    &lt;module&gt;gulimall-product&lt;&#x2F;module&gt;
    &lt;module&gt;gulimall-ware&lt;&#x2F;module&gt;

    &lt;module&gt;renren-fast&lt;&#x2F;module&gt;
&lt;&#x2F;modules&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后打开<code>renren-fast/db/mysql.sql</code>，复制全部，在 sqlyog 中创建库<code>guli-admin</code>，粘贴刚才的内容执行。</p>
<p>然后修改项目里 renren-fast 中的 application.yml，修改 application-dev.yml 中的数库库的 url，通常把 localhost 修改为<code>192.168.56.10</code>即可。然后该对后面那个数据库</p>
<pre class="line-numbers language-none"><code class="language-none">url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;guli_admin?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
username: root
password: root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后运行该 java 项目下的 RenrenApplication</p>
<p>浏览器输入 <a target="_blank" rel="noopener" href="http://localhost:8080/renren-fast/">http://localhost:8080/renren-fast/</a> 得到 {“msg”:“invalid token”,“code”:401} 就代表无误</p>
<h5 id="人人-vue（npm）"><a class="header-anchor" href="#人人-vue（npm）">¶</a>人人 vue（npm）</h5>
<p>用 VSCode 打开 renren-fast-vue（如果自己搭建的话），如果是运行完整的代码，可以去课件里找 gulimall-admin-vue-app</p>
<p>安装 node：<a target="_blank" rel="noopener" href="http://nodejs.cn/download/">http://nodejs.cn/download/</a> 选择 windows 下载。下载完安装。</p>
<blockquote>
<p>可以去这里找到 v12 的版本。（不要用 12.0，可以用 12.1）</p>
<p><a target="_blank" rel="noopener" href="https://npm.taobao.org/mirrors/node/">https://npm.taobao.org/mirrors/node/</a></p>
</blockquote>
<p><code>NPM</code>是随同<code>NodeJS</code>一起安装的包管理工具。JavaScript-NPM 类似于 java-Maven。</p>
<p>命令行输入<code>node -v</code> 检查配置好了，配置 npm 的镜像仓库地址，再执</p>
<pre class="line-numbers language-none"><code class="language-none">node -v
npm config set registry http:&#x2F;&#x2F;registry.npm.taobao.org&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后去 VScode 的项目终端中输入 <code>npm install</code>，是要去拉取依赖（package.json 类似于 pom.xml 的 dependency），但是会报错，然后进行如下操作：</p>
<h3 id="启动-fast-vue-项目"><a class="header-anchor" href="#启动-fast-vue-项目">¶</a>启动 fast-vue 项目</h3>
<p>结合下面的报错</p>
<h4 id="P16-npm-install-报错问题"><a class="header-anchor" href="#P16-npm-install-报错问题">¶</a>P16 npm install 报错问题</h4>
<p>写到了这里：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/113821646">https://blog.csdn.net/hancoder/article/details/113821646</a></p>
<h2 id="八、人人项目-逆向工程"><a class="header-anchor" href="#八、人人项目-逆向工程">¶</a>八、人人项目 - 逆向工程</h2>
<p>逆向工程搭建</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;gitee.com&#x2F;renrenio&#x2F;renren-generator.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>下载到桌面后，同样把里面的. git 文件删除，然后移动到我们 IDEA 项目目录中，同样配置好 pom.xml</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;modules&gt;
		&lt;module&gt;gulimall-coupon&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-member&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-order&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-product&lt;&#x2F;module&gt;
		&lt;module&gt;gulimall-ware&lt;&#x2F;module&gt;
		&lt;module&gt;renren-fast&lt;&#x2F;module&gt;
		&lt;module&gt;renren-generator&lt;&#x2F;module&gt;
	&lt;&#x2F;modules&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 maven 中刷新一下，让项目名变粗体，稍等下面进度条完成。</p>
<p>修改 application.yml</p>
<pre class="line-numbers language-none"><code class="language-none">url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-pms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
username: root
password: root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后修改 generator.properties（这里乱码的百度 IDEA 设置 properties 编码）</p>
<pre class="line-numbers language-none"><code class="language-none"># 主目录
mainPath&#x3D;com.atguigu
#包名
package&#x3D;com.atguigu.gulimall
#模块名
moduleName&#x3D;product
#作者
author&#x3D;hh
#email
email&#x3D;55333@qq.com
#表前缀(类名不会包含表前缀) # 我们的pms数据库中的表的前缀都pms
# 如果写了表前缀，每一张表对于的javaBean就不会添加前缀了
tablePrefix&#x3D;pms_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行 RenrenApplication。如果启动不成功，修改 application 中是 port 为 801。访问 <a target="_blank" rel="noopener" href="http://localhost:801/">http://localhost:801/</a></p>
<p>在网页上下方点击每页显示 50 个（pms 库中的表），以让全部都显示，然后点击全部，点击生成代码。下载了压缩包</p>
<p>解压压缩包，把 main 放到 gulimall-product 的同级目录下。</p>
<p>然后在项目上右击（在项目上右击很重要）new modules— maven—然后在 name 上输入 gulimall-common。</p>
<p>在 pom.xml 中也自动添加了<code>&lt;module&gt;gulimall-common&lt;/module&gt;</code></p>
<p>在 common 项目的 pom.xml 中添加</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;!-- mybatisPLUS--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;
    &lt;version&gt;3.3.2&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;
&lt;!--简化实体类，用@Data代替getset方法--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;
    &lt;version&gt;1.18.8&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;
&lt;!-- httpcomponent包。发送http请求 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;httpcore&lt;&#x2F;artifactId&gt;
    &lt;version&gt;4.4.13&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;commons-lang&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;commons-lang&lt;&#x2F;artifactId&gt;
    &lt;version&gt;2.6&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们把每个微服务里公共的类和依赖放到 common 里。</p>
<blockquote>
<p>tips: shift+F6 修改项目名</p>
</blockquote>
<p>然后在 product 项目中的 pom.xml 中加入下面内容，作为 common 的子项目</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;com.atguigu.gulimall&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;gulimall-common&lt;&#x2F;artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>复制</p>
<ul>
<li>
<p>renren-fast----utils 包下的 Query 和<code>PageUtils</code>、<code>R</code>、<code>Constant</code>复制到 common 项目的<code>java/com.atguigu.common.utils</code>下</p>
</li>
<li>
<p>把 @RequiresPermissions 这些注解掉，因为是 shiro 的</p>
</li>
<li>
<p>复制 renren-fast 中的 xss 包粘贴到 common 的 com.atguigu.common 目录下。</p>
</li>
<li>
<blockquote>
<p>还复制了 exception 文件夹，对应的位置关系自己观察一下就行</p>
</blockquote>
</li>
<li>
<p>注释掉 product 项目下类中的<code>//import org.apache.shiro.authz.annotation.RequiresPermissions;</code>，他是 shiro 的东西</p>
</li>
<li>
<p>注释 renren-generator\src\main\resources\template/Controller 中所有的 @RequiresPermissions。<code>## import org.apache.shiro.authz.annotation.RequiresPermissions;</code></p>
</li>
</ul>
<p>总之什么报错就去 fast 里面找。重启逆向工程。重新在页面上得到压缩包。重新解压出来，不过只把里面的 controller 复制粘贴到 product 项目对应的目录就行。</p>
<h5 id="测试"><a class="header-anchor" href="#测试">¶</a>测试</h5>
<p>测试与整合商品服务里的 mybatisplus</p>
<p><a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/quick-start.html#">https://mp.baomidou.com/guide/quick-start.html#</a> 配置</p>
<p>在 common 的 pom.xml 中导入</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;!-- 数据库驱动 https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;mysql&#x2F;mysql-connector-java --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;
    &lt;version&gt;8.0.17&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;
&lt;!--tomcat里一般都带--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;javax.servlet&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;servlet-api&lt;&#x2F;artifactId&gt;
    &lt;version&gt;2.5&lt;&#x2F;version&gt;
    &lt;scope&gt;provided&lt;&#x2F;scope&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>删掉 common 里 xss/xssfiler 和 XssHttpServletRequestWrapper</p>
<p>在 product 项目的 resources 目录下新建 application.yml</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-pms
    driver-class-name: com.mysql.jdbc.Driver

# MapperScan
# sql映射文件位置
mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>classpath 和 classpath* 区别：<br>
classpath：只会到你的 class 路径中查找找文件;<br>
classpath*：不仅包含 class 路径，还包括 jar 文件中 (class 路径) 进行查找</p>
<p><code>classpath*</code>的使用：当项目中有多个 classpath 路径，并同时加载多个 classpath 路径下（此种情况多数不会遇到）的文件，<code>*</code>就发挥了作用，如果不加<code>*</code>，则表示仅仅加载第一个 classpath 路径。</p>
</blockquote>
<p>然而执行后能通过，但是数据库中文显示乱码，所以我模仿逆向工程，把上面的配置 url 改为</p>
<pre class="line-numbers language-none"><code class="language-none">url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;guli_pms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>正常了。</p>
<p>然后在主启动类上加上注解 @MapperScan()</p>
<pre class="line-numbers language-none"><code class="language-none">@MapperScan(&quot;com.atguigu.gulimall.product.dao&quot;)
@SpringBootApplication
public class gulimallProductApplication &#123;


    public static void main(String[] args) &#123;

        SpringApplication.run(gulimallProductApplication.class, args);
    &#125;

&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后去测试，先通过下面方法给数据库添加内容</p>
<pre class="line-numbers language-none"><code class="language-none">@SpringBootTest
class gulimallProductApplicationTests &#123;
    @Autowired
    BrandService brandService;

    @Test
    void contextLoads() &#123;
        BrandEntity brandEntity &#x3D; new BrandEntity();
        brandEntity.setDescript(&quot;哈哈1哈&quot;);
        brandEntity.setName(&quot;华为&quot;);
        brandService.save(brandEntity);
        System.out.println(&quot;保存成功&quot;);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在数据库中就能看到新增数据了</p>
<pre class="line-numbers language-none"><code class="language-none">@SpringBootTest
class gulimallProductApplicationTests &#123;
    @Autowired
    BrandService brandService;

    @Test
    void contextLoads() &#123;
        BrandEntity brandEntity &#x3D; new BrandEntity();
        brandEntity.setBrandId(1L);
        brandEntity.setDescript(&quot;修改&quot;);
        brandService.updateById(brandEntity);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="coupon"><a class="header-anchor" href="#coupon">¶</a>coupon</h4>
<p>重新打开 generator 逆向工程，修改 generator.properties</p>
<pre class="line-numbers language-none"><code class="language-none"># 主目录
mainPath&#x3D;com.atguigu
#包名
package&#x3D;com.atguigu.gulimall
#模块名
moduleName&#x3D;coupon
#作者
autho&#x3D;hh
#email
email&#x3D;55333@qq.com
#表前缀(类名不会包含表前缀) # 我们的pms数据库中的表的前缀都pms
# 如果写了表前缀，每一张表对于的javaBean就不会添加前缀了
tablePrefix&#x3D;sms_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>修改 yml 数据库信息</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-sms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver


mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0

server:
  port: 7000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>端口号后面会设置，这里提前设置好了</p>
<p>启动生成 RenrenApplication.java，运行后去浏览器 80 端口查看，同样让他一页全显示后选择全部后生成。生成后解压复制到 coupon 项目对应目录下。</p>
<p>让 coupon 也依赖于 common，修改 pom.xml</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;com.atguigu.gulimall&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;gulimall-common&lt;&#x2F;artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>resources 下 src 包先删除</p>
<p>添加 application.yml</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-sms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver


mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行 gulimallCouponApplication.java</p>
<blockquote>
<p>隔了好几个月的注：直接 clone 别人的项目这里可能运行不起来。。。因为如后面依赖了 nacos 等服务，克隆的话这里暂时运行不起来。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/list">http://localhost:7000/coupon/coupon/list</a></p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;msg&quot;:&quot;success&quot;,&quot;code&quot;:0,&quot;page&quot;:&#123;&quot;totalCount&quot;:0,&quot;pageSize&quot;:10,&quot;totalPage&quot;:0,&quot;currPage&quot;:1,&quot;list&quot;:[]&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="member"><a class="header-anchor" href="#member">¶</a>member</h4>
<p>重新使用代码生成器生成 ums</p>
<p>模仿上面修改下面两个配置</p>
<p>代码生成器里：</p>
<pre class="line-numbers language-none"><code class="language-none">url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-ums?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none"># 主目录
mainPath&#x3D;com.atguigu
#包名
package&#x3D;com.atguigu.gulimall
#模块名
moduleName&#x3D;member
#作者
author&#x3D;hh
#email
email&#x3D;55333@qq.com
#表前缀(类名不会包含表前缀) # 我们的pms数据库中的表的前缀都pms
# 如果写了表前缀，每一张表对于的javaBean就不会添加前缀了
tablePrefix&#x3D;ums_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>重启 RenrenApplication.java，然后同样去浏览器获取压缩包解压到对应 member 项目目录</p>
<p>member 也导入依赖</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;com.atguigu.gulimall&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;gulimall-common&lt;&#x2F;artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>同样新建 application.yml</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-ums?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver


mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0

server:
  port: 8000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>order 端口是 9000，product 是 10000，ware 是 11000。</p>
<p>以后比如 order 系统要复制多份，他的端口计算 9001、9002。。。</p>
<p>重启 web 后，<a target="_blank" rel="noopener" href="http://localhost:8000/member/growthchangehistory/list">http://localhost:8000/member/growthchangehistory/list</a></p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;msg&quot;:&quot;success&quot;,&quot;code&quot;:0,&quot;page&quot;:&#123;&quot;totalCount&quot;:0,&quot;pageSize&quot;:10,&quot;totalPage&quot;:0,&quot;currPage&quot;:1,&quot;list&quot;:[]&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="order"><a class="header-anchor" href="#order">¶</a>order</h4>
<p>修改代码生成器</p>
<pre class="line-numbers language-none"><code class="language-none">url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-oms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">#代码生成器，配置信息

# 主目录
mainPath&#x3D;com.atguigu
#包名
package&#x3D;com.atguigu.gulimall
#模块名
moduleName&#x3D;order
#作者
author&#x3D;hh
#email
email&#x3D;55333@qq.com
#表前缀(类名不会包含表前缀) # 我们的pms数据库中的表的前缀都pms
# 如果写了表前缀，每一张表对于的javaBean就不会添加前缀了
tablePrefix&#x3D;oms_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行 RenrenApplication.java 重新生成后去下载解压放置。</p>
<p>application.yml</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-oms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver


mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0
      
server:
  port: 9000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>POMxml</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;com.atguigu.gulimall&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;gulimall-common&lt;&#x2F;artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>启动 gulimallOrderApplication.java</p>
<p><a target="_blank" rel="noopener" href="http://localhost:9000/order/order/list">http://localhost:9000/order/order/list</a></p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;msg&quot;:&quot;success&quot;,&quot;code&quot;:0,&quot;page&quot;:&#123;&quot;totalCount&quot;:0,&quot;pageSize&quot;:10,&quot;totalPage&quot;:0,&quot;currPage&quot;:1,&quot;list&quot;:[]&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="ware"><a class="header-anchor" href="#ware">¶</a>ware</h4>
<p>修改代码生成器</p>
<pre class="line-numbers language-none"><code class="language-none">url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-wms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">#代码生成器，配置信息

# 主目录
mainPath&#x3D;com.atguigu
#包名
package&#x3D;com.atguigu.gulimall
#模块名
moduleName&#x3D;ware
#作者
author&#x3D;hh
#email
email&#x3D;55333@qq.com
#表前缀(类名不会包含表前缀) # 我们的pms数据库中的表的前缀都pms
# 如果写了表前缀，每一张表对于的javaBean就不会添加前缀了
tablePrefix&#x3D;wms_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>运行 RenrenApplication.java 重新生成后去下载解压放置。</p>
<p>application.yml</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-wms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver


mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0
      
server:
  port: 11000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>POMxml</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;com.atguigu.gulimall&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;gulimall-common&lt;&#x2F;artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>启动 gulimallWareApplication.java</p>
<p><a target="_blank" rel="noopener" href="http://localhost:11000/ware/wareinfo/list">http://localhost:11000/ware/wareinfo/list</a></p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;msg&quot;:&quot;success&quot;,&quot;code&quot;:0,&quot;page&quot;:&#123;&quot;totalCount&quot;:0,&quot;pageSize&quot;:10,&quot;totalPage&quot;:0,&quot;currPage&quot;:1,&quot;list&quot;:[]&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="九、SpringCloud-Alibaba-简介"><a class="header-anchor" href="#九、SpringCloud-Alibaba-简介">¶</a>九、SpringCloud Alibaba 简介</h2>
<blockquote>
<p>springcloud 个人笔记：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/109063671">https://blog.csdn.net/hancoder/article/details/109063671</a></p>
</blockquote>
<p>阿里 18 年开发的微服务一站式解决方案。<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md</a></p>
<ul>
<li>注册中心：</li>
<li>配置中心：</li>
<li>网关：</li>
</ul>
<p>netflix 把 feign 闭源了，spring cloud 开了个 open feign</p>
<p>在 common 的 pom.xml 中加入</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;
            &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;&#x2F;artifactId&gt;
            &lt;version&gt;2.2.0.RELEASE&lt;&#x2F;version&gt;
            &lt;type&gt;pom&lt;&#x2F;type&gt;
            &lt;scope&gt;import&lt;&#x2F;scope&gt;
        &lt;&#x2F;dependency&gt;
    &lt;&#x2F;dependencies&gt;
&lt;&#x2F;dependencyManagement&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>上面是依赖管理，相当于以后再 dependencies 里引 spring cloud alibaba 就不用写版本号， 全用 dependencyManagement 进行管理。注意他和普通依赖的区别，他只是备注一下，并没有加入依赖</p>
<h2 id="十、Nacos-8848"><a class="header-anchor" href="#十、Nacos-8848">¶</a>十、Nacos-8848</h2>
<blockquote>
<p>springcloud 个人笔记：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/109063671">https://blog.csdn.net/hancoder/article/details/109063671</a></p>
</blockquote>
<p>一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。</p>
<p>nacos 作为我们的注册中心和配置中心。</p>
<p>注册中心文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/tree/master/spring-cloud-alibaba-examples/nacos-example/nacos-discovery-example">https://github.com/alibaba/spring-cloud-alibaba/tree/master/spring-cloud-alibaba-examples/nacos-example/nacos-discovery-example</a></p>
<p>其他文档在该项目上层即可找到，下面读一读官网给的介绍就会用了。</p>
<p>安装启动 nacos：下载–解压–双击 bin/startup.cmd。<a target="_blank" rel="noopener" href="http://127.0.0.1:8848/nacos/">http://127.0.0.1:8848/nacos/</a> 账号密码 nacos</p>
<blockquote>
<p>自己搭建 nacos 源码（推荐）：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaotian5180/article/details/105478543">https://blog.csdn.net/xiaotian5180/article/details/105478543</a></p>
</blockquote>
<blockquote>
<p>Linux/Unix/Mac 操作系统，执行命令 <code>sh startup.sh -m standalone</code></p>
</blockquote>
<p>使用 nacos：</p>
<ul>
<li>
<p>在某个项目里 properties 里写<code>spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848</code>（yaml 同理，指定 nacos 的地址）。再指定 <a target="_blank" rel="noopener" href="http://applicatin.name">applicatin.name</a> 告诉注册到 nacos 中以什么命名</p>
</li>
<li>
<p>依赖：放到 common 里</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;&#x2F;artifactId&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>
<p>使用 @<code>EnableDiscoveryClient</code> 注解开启服务注册与发现功能</p>
<pre class="line-numbers language-none"><code class="language-none">@SpringBootApplication
@EnableDiscoveryClient
public class ProviderApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(Application.class, args);
    &#125;

    @RestController
    class EchoController &#123;
        @GetMapping(value &#x3D; &quot;&#x2F;echo&#x2F;&#123;string&#125;&quot;)
        public String echo(@PathVariable String string) &#123;
            return string;
        &#125;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<p>最后 application.yml 内容，配置了服务中心名和当前模块名字</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;gulimall-sms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
  application:
    name: gulimall-coupon


mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0

server:
  port: 7000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后依次给 member、配置上面的 yaml，改下 name 就行。再给每个项目配置类上加上注解 @EnableDiscoveryClient</p>
<p>nacos 测试：</p>
<p><strong>测试 member 和 coupon 的远程调用</strong></p>
<p>想要获取当前会员领取到的所有优惠券。先去注册中心找优惠券服务，注册中心调一台优惠券服务器给会员，会员服务器发送请求给这台优惠券服务器，然后对方响应。</p>
<ul>
<li>服务请求方发送了 2 次请求，先问 nacos 要地址，然后再请求</li>
</ul>
<h2 id="十一、Feign（远程调用）与注册中心"><a class="header-anchor" href="#十一、Feign（远程调用）与注册中心">¶</a>十一、Feign（远程调用）与注册中心</h2>
<p>声明式远程调用</p>
<p>feign 是一个声明式的 HTTP 客户端，他的目的就是让远程调用更加简单。给远程服务发的是 HTTP 请求。</p>
<p>会员服务想要远程调用优惠券服务，只需要给会员服务里引入 openfeign 依赖，他就有了远程调用其他服务的能力。</p>
<p>pom.xml</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;&#x2F;artifactId&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>我们之前在 member 的 pom.xml 已经引用过了（微服务）。</p>
<p>在 coupon 中修改如下的内容</p>
<pre class="line-numbers language-none"><code class="language-none">@RequestMapping(&quot;coupon&#x2F;coupon&quot;)
public class CouponController &#123;
    @Autowired
    private CouponService couponService;

    @RequestMapping(&quot;&#x2F;member&#x2F;list&quot;)
    public R membercoupons()&#123;    &#x2F;&#x2F;全系统的所有返回都返回R
        &#x2F;&#x2F; 应该去数据库查用户对于的优惠券，但这个我们简化了，不去数据库查了，构造了一个优惠券给他返回
        CouponEntity couponEntity &#x3D; new CouponEntity();
        couponEntity.setCouponName(&quot;满100-10&quot;);&#x2F;&#x2F;优惠券的名字
        return R.ok().put(&quot;coupons&quot;,Arrays.asList(couponEntity));
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这样我们准备好了优惠券的调用内容</p>
<p>在 member 的配置类上加注解<code>@EnableDiscoveryClient，</code>告诉 member 是一个远程调用客户端，member 要调用东西的</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;*
* 想要远程调用的步骤：
* 1 引入openfeign
* 2 编写一个接口，接口告诉springcloud这个接口需要调用远程服务
* 	2.1 在接口里声明@FeignClient(&quot;gulimall-coupon&quot;)他是一个远程调用客户端且要调用coupon服务
* 	2.2 要调用coupon服务的&#x2F;coupon&#x2F;coupon&#x2F;member&#x2F;list方法
* 3 开启远程调用功能 @EnableFeignClients，要指定远程调用功能放的基础包
* *&#x2F;
@EnableFeignClients(basePackages&#x3D;&quot;com.atguigu.gulimall.member.feign&quot;)&#x2F;&#x2F;允许
@EnableDiscoveryClient
@SpringBootApplication
public class gulimallMemberApplication &#123;

	public static void main(String[] args) &#123;
		SpringApplication.run(gulimallMemberApplication.class, args);
	&#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>那么要调用什么东西呢？就是我们刚才写的优惠券的功能，复制函数部分，在 member 的 com.atguigu.gulimall.member.feign 包下新建类：</p>
<pre class="line-numbers language-none"><code class="language-none">@FeignClient(&quot;gulimall-coupon&quot;) &#x2F;&#x2F;告诉spring cloud这个接口是一个远程客户端，要调用coupon服务，再去调用coupon服务&#x2F;coupon&#x2F;coupon&#x2F;member&#x2F;list对应的方法
public interface CouponFeignService &#123;
    &#x2F;&#x2F; 远程服务的url
    @RequestMapping(&quot;&#x2F;coupon&#x2F;coupon&#x2F;member&#x2F;list&quot;)&#x2F;&#x2F;注意写全优惠券类上还有映射&#x2F;&#x2F;注意我们这个地方不是控制层，所以这个请求映射请求的不是我们服务器上的东西，而是nacos注册中心的
    public R membercoupons();&#x2F;&#x2F;得到一个R对象
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<p>@FeignClient+@RequestMapping 构成远程调用的坐标</p>
<p>其他类中看似只是调用了 CouponFeignService.membercoupons()，而实际上该方法跑去 nacos 里和 rpc 里调用了才拿到东西返回</p>
</blockquote>
<p>然后我们在 member 的控制层写一个测试请求</p>
<pre class="line-numbers language-none"><code class="language-none">@RestController
@RequestMapping(&quot;member&#x2F;member&quot;)
public class MemberController &#123;
    @Autowired
    private MemberService memberService;

    @Autowired
    CouponFeignService couponFeignService;

    @RequestMapping(&quot;&#x2F;coupons&quot;)
    public R test()&#123;
        MemberEntity memberEntity &#x3D; new MemberEntity();
        memberEntity.setNickname(&quot;会员昵称张三&quot;);
        R membercoupons &#x3D; couponFeignService.membercoupons();&#x2F;&#x2F;假设张三去数据库查了后返回了张三的优惠券信息

        &#x2F;&#x2F;打印会员和优惠券信息
        return R.ok().put(&quot;member&quot;,memberEntity).put(&quot;coupons&quot;,membercoupons.get(&quot;coupons&quot;));
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>重新启动服务</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8000/member/member/coupons">http://localhost:8000/member/member/coupons</a></p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;msg&quot;:&quot;success&quot;,&quot;code&quot;:0,&quot;coupons&quot;:[&#123;&quot;id&quot;:null,&quot;couponType&quot;:null,&quot;couponImg&quot;:null,&quot;couponName&quot;:&quot;满100-10&quot;,&quot;num&quot;:null,&quot;amount&quot;:null,&quot;perLimit&quot;:null,&quot;minPoint&quot;:null,&quot;startTime&quot;:null,&quot;endTime&quot;:null,&quot;useType&quot;:null,&quot;note&quot;:null,&quot;publishCount&quot;:null,&quot;useCount&quot;:null,&quot;receiveCount&quot;:null,&quot;enableStartTime&quot;:null,&quot;enableEndTime&quot;:null,&quot;code&quot;:null,&quot;memberLevel&quot;:null,&quot;publish&quot;:null&#125;],&quot;member&quot;:&#123;&quot;id&quot;:null,&quot;levelId&quot;:null,&quot;username&quot;:null,&quot;password&quot;:null,&quot;nickname&quot;:&quot;会员昵称张三&quot;,&quot;mobile&quot;:null,&quot;email&quot;:null,&quot;header&quot;:null,&quot;gender&quot;:null,&quot;birth&quot;:null,&quot;city&quot;:null,&quot;job&quot;:null,&quot;sign&quot;:null,&quot;sourceType&quot;:null,&quot;integration&quot;:null,&quot;growth&quot;:null,&quot;status&quot;:null,&quot;createTime&quot;:null&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>上面讲的内容很重要，我们停留 5 分钟体会一下。</p>
<p>coupon 里的 R.ok() 是什么</p>
<pre class="line-numbers language-none"><code class="language-none">public class R extends HashMap&lt;String, Object&gt; &#123;&#x2F;&#x2F;R继承了HashMap
    &#x2F;&#x2F; ok是个静态方法，new了一个R对象，并且
    public static R ok(String msg) &#123;
        R r &#x3D; new R();
        r.put(&quot;msg&quot;, msg);&#x2F;&#x2F;调用了super.put(key, value);，即hashmap的put
        return r;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="nacos-作为配置中心"><a class="header-anchor" href="#nacos-作为配置中心">¶</a>nacos 作为配置中心</h5>
<p>我们还可以用 nacos 作为配置中心。配置中心的意思是不在 application.properties 等文件中配置了，而是放到 nacos 配置中心公用，这样无需每台机器都改。</p>
<p>官方教程：<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/nacos-example/nacos-config-example/readme-zh.md">https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/nacos-example/nacos-config-example/readme-zh.md</a></p>
<p>common 中添加依赖 nacos 配置中心</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
     &lt;groupId&gt;com.alibaba.cloud&lt;&#x2F;groupId&gt;
     &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;&#x2F;artifactId&gt;
 &lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 coupons 项目中创建 / src/main/resources/bootstrap.properties ，这个文件是 springboot 里规定的，他优先级别 application.properties 高</p>
<pre class="line-numbers language-none"><code class="language-none"># 改名字，对应nacos里的配置文件名
spring.application.name&#x3D;gulimall-coupon
spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>还是原来我们使用配置的方式，只不过优先级变了，所以匹配到了 nacos 的配置</p>
<p>还是配合 @Value 注解使用</p>
<pre class="line-numbers language-none"><code class="language-none">@RestController
@RequestMapping(&quot;coupon&#x2F;coupon&quot;)
public class CouponController &#123;
    @Autowired
    private CouponService couponService;

    @Value(&quot;$&#123;coupon.user.name&#125;&quot;)&#x2F;&#x2F;从application.properties中获取&#x2F;&#x2F;不要写user.name，他是环境里的变量
    private String name;
    @Value(&quot;$&#123;coupon.user.age&#125;&quot;)
    private Integer age;
    @RequestMapping(&quot;&#x2F;test&quot;)
    public R test()&#123;

        return R.ok().put(&quot;name&quot;,name).put(&quot;age&quot;,age);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>浏览器去 nacos 里的配置列表，点击＋号，data ID：<code>gulimall-coupon.properties</code>，配置</p>
<pre class="line-numbers language-none"><code class="language-none"># gulimall-coupon.properties
coupon.user.      
coupon.user.age&#x3D;12<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>然后点击发布。重启 coupon（生产中加入 @RefreshScope 即可），<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;msg&quot;:&quot;success&quot;,&quot;code&quot;:0,&quot;name&quot;:&quot;配置中心&quot;,&quot;age&quot;:12&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>但是修改肿么办？实际生产中不能重启应用。在 coupon 的控制层上加<code>@RefreshScope</code></p>
<pre class="line-numbers language-none"><code class="language-none">@RefreshScope
@RestController
@RequestMapping(&quot;coupon&#x2F;coupon&quot;)
public class CouponController &#123;
    @Autowired
    private CouponService couponService;

    @Value(&quot;$&#123;coupon.user.name&#125;&quot;)&#x2F;&#x2F;从application.properties中获取&#x2F;&#x2F;不要写user.name，他是环境里的变量
    private String name;
    @Value(&quot;$&#123;coupon.user.age&#125;&quot;)
    private Integer age;
    @RequestMapping(&quot;&#x2F;test&quot;)
    public R test()&#123;

        return R.ok().put(&quot;name&quot;,name).put(&quot;age&quot;,age);
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>重启后，在 nacos 浏览器里修改配置，修改就可以观察到能动态修改了</p>
<p>nacos 的配置内容优先于项目本地的配置内容。</p>
<p><strong>配置中心进阶</strong></p>
<p>在 nacos 浏览器中还可以配置：</p>
<ul>
<li>
<p>命名空间：用作配置隔离。（一般每个微服务一个命名空间）</p>
<ul>
<li>
<p>默认 public。默认新增的配置都在 public 空间下</p>
</li>
<li>
<p>开发、测试、开发可以用命名空间分割。properties 每个空间有一份。</p>
</li>
<li>
<p>在 bootstrap.properties 里配置（测试完去掉，学习不需要）</p>
<pre class="line-numbers language-none"><code class="language-none"># 可以选择对应的命名空间 # 写上对应环境的命名空间ID
spring.cloud.nacos.config.namespace&#x3D;b176a68a-6800-4648-833b-be10be8bab00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>
<p>也可以为每个微服务配置一个命名空间，微服务互相隔离</p>
</li>
</ul>
</li>
<li>
<p>配置集：一组相关或不相关配置项的集合。</p>
</li>
<li>
<p>配置集 ID：类似于配置文件名，即 Data ID</p>
</li>
<li>
<p>配置分组：默认所有的配置集都属于<code>DEFAULT_GROUP</code>。双十一，618 的优惠策略改分组即可</p>
<pre class="line-numbers language-none"><code class="language-none"># 更改配置分组
spring.cloud.nacos.config.group&#x3D;DEFAULT_GROUP<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
</ul>
<p>最终方案：每个微服务创建自己的命名空间，然后使用配置分组区分环境（dev/test/prod）</p>
<p><strong>加载多配置集</strong></p>
<p>我们要把原来 application.yml 里的内容都分文件抽离出去。我们在 nacos 里创建好后，在 coupons 里指定要导入的配置即可。</p>
<p>bootstrap.properties</p>
<blockquote>
<p>在其中用数组<code>spring.cloud.nacos.config.extension-configs[]</code>写明每个配置集</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">spring.application.name&#x3D;gulimall-coupon

spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848
# 可以选择对应的命名空间 # 写上对应环境的命名空间ID
spring.cloud.nacos.config.namespace&#x3D;b176a68a-6800-4648-833b-be10be8bab00
# 更改配置分组
spring.cloud.nacos.config.group&#x3D;dev

#新版本不建议用下面的了
#spring.cloud.nacos.config.ext-config[0].data-id&#x3D;datasource.yml
#spring.cloud.nacos.config.ext-config[0].group&#x3D;dev
#spring.cloud.nacos.config.ext-config[0].refresh&#x3D;true
#spring.cloud.nacos.config.ext-config[1].data-id&#x3D;mybatis.yml
#spring.cloud.nacos.config.ext-config[1].group&#x3D;dev
#spring.cloud.nacos.config.ext-config[1].refresh&#x3D;true
#spring.cloud.nacos.config.ext-config[2].data-id&#x3D;other.yml
#spring.cloud.nacos.config.ext-config[2].group&#x3D;dev
#spring.cloud.nacos.config.ext-config[2].refresh&#x3D;true

spring.cloud.nacos.config.extension-configs[0].data-id&#x3D;datasource.yml
spring.cloud.nacos.config.extension-configs[0].group&#x3D;dev
spring.cloud.nacos.config.extension-configs[0].refresh&#x3D;true

spring.cloud.nacos.config.extension-configs[1].data-id&#x3D;mybatis.yml
spring.cloud.nacos.config.extension-configs[1].group&#x3D;dev
spring.cloud.nacos.config.extension-configs[1].refresh&#x3D;true

spring.cloud.nacos.config.extension-configs[2].data-id&#x3D;other.yml
spring.cloud.nacos.config.extension-configs[2].group&#x3D;dev
spring.cloud.nacos.config.extension-configs[2].refresh&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出内容有</p>
<pre class="line-numbers language-none"><code class="language-none">2020-06-25 00:04:13.677  WARN 17936 --- [           main] c.a.c.n.c.NacosPropertySourceBuilder     : Ignore the empty nacos configuration and get it based on dataId[gulimall-coupon] &amp; group[dev]

2020-06-25 00:04:13.681  INFO 17936 --- [           main] b.c.PropertySourceBootstrapConfiguration :
Located property source: [
BootstrapPropertySource &#123;name&#x3D;&#39;bootstrapProperties-gulimall-coupon.properties,dev&#39;&#125;, 
BootstrapPropertySource &#123;name&#x3D;&#39;bootstrapProperties-gulimall-coupon,dev&#39;&#125;, 
BootstrapPropertySource &#123;name&#x3D;&#39;bootstrapProperties-other.yml,dev&#39;&#125;, 
BootstrapPropertySource &#123;name&#x3D;&#39;bootstrapProperties-mybatis.yml,dev&#39;&#125;, 
BootstrapPropertySource &#123;name&#x3D;&#39;bootstrapProperties-datasource.yml,dev&#39;&#125;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="十二、网关-gateway-88"><a class="header-anchor" href="#十二、网关-gateway-88">¶</a>十二、网关 gateway-88</h2>
<p>动态上下线：发送请求需要知道商品服务的地址，如果商品服务器有 123 服务器，<strong>1 号掉线后</strong>，还得改，所以需要网关动态地管理，他能从注册中心中实时地感知某个服务上线还是下线。【先通过网关，网关路由到服务提供者】</p>
<p>拦截：请求也要加上询问权限，看用户有没有权限访问这个请求，也需要网关。</p>
<p>所以我们使用 spring cloud 的<code>gateway</code>组件做网关功能。</p>
<p>网关是请求流量的入口，常用功能包括路由转发，权限校验，限流控制等。springcloud <code>gateway</code>取代了<code>zuul</code>网关。</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-gateway">https://spring.io/projects/spring-cloud-gateway</a></p>
<p>参考手册：<a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-gateway/2.2.x/reference/html/">https://cloud.spring.io/spring-cloud-gateway/2.2.x/reference/html/</a></p>
<p>三大核心概念：</p>
<ul>
<li><strong>Route</strong>: The basic building block of the gateway. It is defined by an ID, a destination URI, a collection of predicates 断言, and a collection of filters. A route is matched if the aggregate predicate is true. 发一个请求给网关，网关要将请求路由到指定的服务。路由有 id，目的地 uri，断言的集合，匹配了断言就能到达指定位置，</li>
<li><strong>Predicate</strong> 断言: This is a <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html">Java 8 Function Predicate</a>. The input type is a <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/ServerWebExchange.html">Spring Framework <code>ServerWebExchange</code></a>. This lets you match on anything from the HTTP request, such as headers or parameters. 就是 java 里的断言函数，匹配请求里的任何信息，包括请求头等。根据请求头路由哪个服务</li>
<li><strong>Filter</strong>: These are instances of <a target="_blank" rel="noopener" href="https://docs.spring.io/spring/docs/5.0.x/javadoc-api/org/springframework/web/server/GatewayFilter.html">Spring Framework <code>GatewayFilter</code></a> that have been constructed with a specific factory. Here, you can modify requests and responses before or after sending the downstream request. 过滤器请求和响应都可以被修改。</li>
</ul>
<p>客户端发请求给服务端。中间有网关。先交给映射器，如果能处理就交给 handler 处理，然后交给一系列 filer，然后给指定的服务，再返回回来给客户端。</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/fdc2f8288ce78208ae8283ba3badc009.png" class="" loading="lazy">
<p>有很多断言。</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  cloud:
    gateway:
      routes:
      - id: after_route
        uri: https:&#x2F;&#x2F;example.org
        predicates:
        - Cookie&#x3D;mycookie,mycookievalue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><code>-</code>代表数组。只有断言成功了，才路由到指定的地址。</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  cloud:
    gateway:
      routes:
      - id: after_route
        uri: https:&#x2F;&#x2F;example.org
        predicates:
        - name: Cookie
          args:
            name: mycookie
            regexp: mycookievalue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>创建，使用 initilizer，Group：com.atguigu.gulimall，Artifact： gulimall-gateway，package：com.atguigu.gulimall.gateway。 搜索 gateway 选中。</p>
<p>pom.xml 里加上 common 依赖， 修改 jdk 版本，</p>
<p>开启注册服务发现 @EnableDiscoveryClient<br>
配置 nacos 注册中心地址 applicaion.properties</p>
<pre class="line-numbers language-none"><code class="language-none">spring.cloud.nacos.discovery.server-addr&#x3D;127.0.0.1:8848
spring.application.name&#x3D;gulimall-gateway
server.port&#x3D;88<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>bootstrap.properties 填写 nacos 配置中心地址</p>
<pre class="line-numbers language-none"><code class="language-none">spring.application.name&#x3D;gulimall-gateway

spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848
spring.cloud.nacos.config.namespace&#x3D;bfa85f10-1a9a-460c-a7dc-efa961b45cc1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>本项目在 nacos 中的服务名</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
    application:
        name: gulimall-gateway<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>再去 nacos 里创建命名空间 gateway（项目与项目用命名空间隔离），然后在命名空间里创建文件 guilmall-gateway.yml</p>
<p>在项目里创建 application.yml，根据条件转发到 uri 等</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  cloud:
    gateway:
      routes:
        - id: test_route
          uri: https:&#x2F;&#x2F;www.baidu.com
          predicates:
            - Query&#x3D;url,baidu

        - id: qq_route
          uri: https:&#x2F;&#x2F;www.qq.com
          predicates:
            - Query&#x3D;url,qq

        - id: product_route
          uri: lb:&#x2F;&#x2F;gulimall-product
          predicates:
            - Path&#x3D;&#x2F;api&#x2F;product&#x2F;**
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;.*),&#x2F;$\&#123;segment&#125;

        - id: third_party_route
          uri: lb:&#x2F;&#x2F;gulimall-third-party
          predicates:
            - Path&#x3D;&#x2F;api&#x2F;thirdparty&#x2F;**
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;thirdparty&#x2F;(?&lt;segment&gt;.*),&#x2F;$\&#123;segment&#125;

        - id: member_route
          uri: lb:&#x2F;&#x2F;gulimall-member
          predicates:
            - Path&#x3D;&#x2F;api&#x2F;member&#x2F;**
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;.*),&#x2F;$\&#123;segment&#125;

        - id: ware_route
          uri: lb:&#x2F;&#x2F;gulimall-ware
          predicates:
            - Path&#x3D;&#x2F;api&#x2F;ware&#x2F;**
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;.*),&#x2F;$\&#123;segment&#125;

        - id: admin_route
          uri: lb:&#x2F;&#x2F;renren-fast
          predicates:
            - Path&#x3D;&#x2F;api&#x2F;**
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;.*),&#x2F;renren-fast&#x2F;$\&#123;segment&#125;



  ## 前端项目，&#x2F;api
## http:&#x2F;&#x2F;localhost:88&#x2F;api&#x2F;captcha.jpg   http:&#x2F;&#x2F;localhost:8080&#x2F;renren-fast&#x2F;captcha.jpg
## http:&#x2F;&#x2F;localhost:88&#x2F;api&#x2F;product&#x2F;category&#x2F;list&#x2F;tree http:&#x2F;&#x2F;localhost:10000&#x2F;product&#x2F;category&#x2F;list&#x2F;tree<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>测试 localhost:8080/hello?url=baidu</p>
<blockquote>
<p>网关使用的是 Netty</p>
</blockquote>
<h2 id="十三、前端-vue-8001-和-element-ui"><a class="header-anchor" href="#十三、前端-vue-8001-和-element-ui">¶</a>十三、前端 vue-8001 和 element-ui</h2>
<p>ES6+Vue 写到了其他博客里</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107007605">https://blog.csdn.net/hancoder/article/details/107007605</a></p>
<h2 id="十四、三级分类"><a class="header-anchor" href="#十四、三级分类">¶</a>十四、三级分类</h2>
<h4 id="element-ui-的使用"><a class="header-anchor" href="#element-ui-的使用">¶</a>element-ui 的使用</h4>
<p><a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/tree">https://element.eleme.cn/#/zh-CN/component/tree</a></p>
<p>提供了 tree 组件，他的数据是以 data 属性显示的。而他的子菜单是由 data 里的 children 属性决定的，当然这个属性可以改</p>
<pre class="line-numbers language-none"><code class="language-none">defaultProps: &#123;
        children: &quot;children&quot;,
        label: &quot;name&quot;
      &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="pms-category-表说明"><a class="header-anchor" href="#pms-category-表说明">¶</a>pms_category 表说明</h4>
<p>这里有 sql 和 entity 不对应的情况，有的 sql 文件改起来比较麻烦，下面这个 sql 应该是准确的。不明白的看前面的数据库章节</p>
<pre class="line-numbers language-none"><code class="language-none">CREATE DATABASE &#x2F;*!32312 IF NOT EXISTS*&#x2F;&#96;gulimall_pms&#96; &#x2F;*!40100 DEFAULT CHARACTER SET utf8mb4 *&#x2F;;

USE &#96;gulimall_pms&#96;;

SET FOREIGN_KEY_CHES&#x3D;0;

DROP TABLE IF EXISTS &#96;pms_category&#96;;
CREATE TABLE &#96;pms_category&#96;  (
&#96;cat_id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;分类id&#39;,
&#96;name&#96; char(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT &#39;分类名称&#39;,
&#96;parent_cid&#96; bigint(20) NULL DEFAULT NULL COMMENT &#39;父分类id&#39;,
&#96;cat_level&#96; int(11) NULL DEFAULT NULL COMMENT &#39;层级&#39;,
&#96;show_status&#96; tinyint(4) NULL DEFAULT NULL COMMENT &#39;是否显示[0-不显示，1显示]&#39;,
&#96;sort&#96; int(11) NULL DEFAULT NULL COMMENT &#39;排序&#39;,
&#96;icon&#96; char(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT &#39;图标地址&#39;,
&#96;product_unit&#96; char(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT &#39;计量单位&#39;,
&#96;product_count&#96; int(11) NULL DEFAULT NULL COMMENT &#39;商品数量&#39;,
PRIMARY KEY (&#96;cat_id&#96;) USING BTREE, 
INDEX &#96;parent_cid&#96;(&#96;parent_cid&#96;) USING BTREE
) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 1437 CHARACTER SET &#x3D; utf8mb4 COLLATE &#x3D; utf8mb4_general_ci COMMENT &#x3D; &#39;商品三级分类&#39; ROW_FORMAT &#x3D; Dynamic;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>cat_id：分类 id，cat 代表分类，bigint(20)</li>
<li>name：分类名称</li>
<li>parent_cid：在哪个父目录下</li>
<li>cat_level：分类层级</li>
<li>show_status：是否显示，用于逻辑删除</li>
<li>sort：同层级同父目录下显示顺序</li>
<li>ico 图标，product_unit 商品计量单位，</li>
<li>InnoDB 表，自增大小 1437，utf 编码，动态行格式</li>
</ul>
<h5 id="sql-注："><a class="header-anchor" href="#sql-注：">¶</a>sql 注：</h5>
<blockquote>
<p>特立独行的猫那个 sql 文件里把表名大小写改了导致 renren-fast 启动不成功。如果启动不了的话，guli_admin 数据库还是不要用他的了，还是接着用 renren-fast 项目下的 db 文件夹 mysql.sql 那个文件吧</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8081/renren-fast/">http://localhost:8081/renren-fast/</a></p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;msg&quot;:&quot;invalid token&quot;,&quot;code&quot;:401&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<h5 id="验证码不显示问题"><a class="header-anchor" href="#验证码不显示问题">¶</a>验证码不显示问题</h5>
<p>F12 打开看了一下，验证码图片的端口还是 8080，也就是说，你的 renren-fast 项目的端口更改了，而前端项目不知道你改过了。</p>
<blockquote>
<p>应该是在 static/config/index.js 里改一下，但现在先不改了</p>
<p>暂时先不管了，先让 renren-fast 项目的端口重新改成 8080 吧</p>
</blockquote>
<p>接着操作后台</p>
<p>localhost:8001 ， 点击系统管理，菜单管理，新增</p>
<ul>
<li>目录</li>
<li><code>商品系统</code></li>
<li>一级菜单</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/fbb8434bb556db0c66a04c4cc82a02a2.png" class="" loading="lazy">
<p>刷新，看到左侧多了商品系统，添加的这个菜单其实是添加到了<code>guli-admin.sys_menu</code>表里</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/7204fc79483b476668d6d1d22f60d3c0.png" class="" loading="lazy">
<p>继续新增：</p>
<ul>
<li>菜单</li>
<li><code>分类维护</code></li>
<li>商品系统</li>
<li>product/category</li>
<li>…</li>
<li>menu</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/6c67b73c8075604ff5b71aa4f95cdc43.png" class="" loading="lazy">
<p><code>guli-admin.sys_menu</code>表又多了一行，父 id 是刚才的商品系统 id</p>
<h5 id="菜单路由"><a class="header-anchor" href="#菜单路由">¶</a>菜单路由</h5>
<p>在左侧点击【分类维护】，希望在此展示 3 级分类<code>http://localhost:8001/#/product-category</code> 可以注意到<code>product-category</code>我们的<code>/</code>被替换为了<code>-</code></p>
<p>比如 sys-role 具体的视图在<code>renren-fast-vue/views/modules/sys/role.vue</code></p>
<p>所以要自定义我们的 product/category 视图的话，就是创建<code>mudules/product/category.vue</code></p>
<p>输出 vue 快捷生成模板，然后去 <a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/tree">https://element.eleme.cn/#/zh-CN/component/tree</a></p>
<p>看如何使用多级目录</p>
<ul>
<li>el-tree 中的 data 是要展示的树形数据</li>
<li>props 属性设置</li>
<li>@node-click 单击函数</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">&lt;el-tree :data&#x3D;&quot;data&quot; :props&#x3D;&quot;defaultProps&quot; @node-click&#x3D;&quot;handleNodeClick&quot;&gt;&lt;&#x2F;el-tree&gt;

&lt;script&gt;
  export default &#123;
    data() &#123;
      return &#123;
        data: [&#123;
          label: &#39;一级 1&#39;,
          children: [&#123;
            label: &#39;二级 1-1&#39;,
            children: [&#123;
              label: &#39;三级 1-1-1&#39;
            &#125;]
          &#125;]
        &#125;, &#123;
          label: &#39;一级 2&#39;,
          children: [&#123;
            label: &#39;二级 2-1&#39;,
            children: [&#123;
              label: &#39;三级 2-1-1&#39;
            &#125;]
          &#125;, &#123;
            label: &#39;二级 2-2&#39;,
            children: [&#123;
              label: &#39;三级 2-2-1&#39;
            &#125;]
          &#125;]
        &#125;, &#123;
          label: &#39;一级 3&#39;,
          children: [&#123;
            label: &#39;二级 3-1&#39;,
            children: [&#123;
              label: &#39;三级 3-1-1&#39;
            &#125;]
          &#125;, &#123;
            label: &#39;二级 3-2&#39;,
            children: [&#123;
              label: &#39;三级 3-2-1&#39;
            &#125;]
          &#125;]
        &#125;],
        defaultProps: &#123;
          children: &#39;children&#39;,
          label: &#39;label&#39;
        &#125;
      &#125;;
    &#125;,
    methods: &#123;
      handleNodeClick(data) &#123;
        console.log(data);
      &#125;
    &#125;
  &#125;;
&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="网关-88"><a class="header-anchor" href="#网关-88">¶</a>网关 88</h5>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/2fdf100883db00cc9f66d2f815c7f6ba.png" class="" loading="lazy">
<p>他要给 8080 发请求读取数据，但是数据是在 10000 端口上，如果找到了这个请求改端口那改起来很麻烦。方法 1 是改 vue 项目里的全局配置，方法 2 是搭建个网关，让网关路由到 10000</p>
<blockquote>
<p>C+S+F 全局搜索</p>
</blockquote>
<p>在<code>static/config/index.js</code>里</p>
<pre class="line-numbers language-none"><code class="language-none">window.SITE_CONFIG[&#39;baseUrl&#39;] &#x3D; &#39;http:&#x2F;&#x2F;localhost:88&#x2F;api&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>接着让重新登录 <a target="_blank" rel="noopener" href="http://localhost:8001/#/login%EF%BC%8C%E9%AA%8C%E8%AF%81%E7%A0%81%E6%98%AF%E8%AF%B7%E6%B1%82">http://localhost:8001/#/login，验证码是请求</a> 88 的，所以不显示。而验证码是来源于 fast 后台的</p>
<ul>
<li>现在的验证码请求路径为，<a target="_blank" rel="noopener" href="http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6">http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
<li>原始的验证码请求路径：<a target="_blank" rel="noopener" href="http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6">http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
</ul>
<blockquote>
<p>88 是 gateway 的端口</p>
<pre class="line-numbers language-none"><code class="language-none">spring.cloud.nacos.discovery.server-addr&#x3D;127.0.0.1:8848
spring.application.name&#x3D;gulimall-gateway
server.port&#x3D;88<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>问题：他要去 nacos 中查找 api 服务，但是 nacos 里有的是 fast 服务，就通过把 api 改成 fast 服务</p>
<p>所以让 fast 注册到服务注册中心，这样请求 88 网关转发到 8080fast</p>
<p>让 fast 里加入注册中心的依赖，而 common 中有 nac 即可 os 依赖，所以引入 common</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;!-- 里面有注册中心 --&gt;
    &lt;groupId&gt;com.atguigu.gulimall&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;gulimall-common&lt;&#x2F;artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 fast 中添加</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  application:
    name: renren-fast
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848 # nacos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后在 fast 启动类上加上注解<code>@EnableDiscoveryClient</code>，重启</p>
<p>如果报错 gson 依赖，就导入 google 的 gson 依赖</p>
<p>然后在 nacos 的服务列表里看到了 renren-fast</p>
<p>在 gateway 中按格式加入</p>
<pre class="line-numbers language-none"><code class="language-none">- id: admin_route
          uri: lb:&#x2F;&#x2F;renren-fast # 路由给renren-fast
          predicates:  # 什么情况下路由给它
            - Path&#x3D;&#x2F;api&#x2F;** # 默认前端项目都带上api前缀，
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;.*),&#x2F;renren-fast&#x2F;$\&#123;segment&#125;
 # fast找<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>lb 代表负载均衡，</li>
</ul>
<h5 id="网关-路径重写"><a class="header-anchor" href="#网关-路径重写">¶</a>网关 - 路径重写</h5>
<p>修改过 vue 里的 api 后，此时验证码请求的是 <a target="_blank" rel="noopener" href="http://localhost:88/api/captcha.jpg?uuid=72b9da67-0130-4d1d-8dda-6bfe4b5f7935">http://localhost:88/api/captcha.jpg?uuid=72b9da67-0130-4d1d-8dda-6bfe4b5f7935</a></p>
<p>也就是说，他请求网关，路由到了 fast，然后取 nacos 里找 fast。</p>
<p>找到后拼接成了 <a target="_blank" rel="noopener" href="http://renren-fast:8080/api/captcha.jpg">http://renren-fast:8080/api/captcha.jpg</a></p>
<p>但是正确的是 localhost:8080/renren-fast/captcha.jpg</p>
<p>所以要利用网关带的路径重写，参考 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-rewritepath-gatewayfilter-factory">https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#the-rewritepath-gatewayfilter-factory</a></p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  cloud:
    gateway:
      routes:
      - id: rewritepath_route
        uri: https:&#x2F;&#x2F;example.org
        predicates:
        - Path&#x3D;&#x2F;red&#x2F;**
        filters:
        - RewritePath&#x3D;&#x2F;red(?&lt;segment&gt;&#x2F;?.*), $\&#123;segment&#125;
# 意思是说匹配到了red项目后，会重写。逗号后是重写的<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>照猫画虎，在网关里写了如下，把 api 换成 renren-fast</p>
<pre class="line-numbers language-none"><code class="language-none">- id: admin_route
          uri: lb:&#x2F;&#x2F;renren-fast
          predicates:
            - Path&#x3D;&#x2F;api&#x2F;**
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;.*),&#x2F;renren-fast&#x2F;$\&#123;segment&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>登录，还是报错：</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/bde1fce13ef5a36c94f931903d8d7d91.png" class="" loading="lazy">
<blockquote>
<p>:8001/#/login:1 Access to XMLHttpRequest at ‘<a target="_blank" rel="noopener" href="http://localhost:88/api/sys/login%E2%80%99">http://localhost:88/api/sys/login’</a> from origin ‘<a target="_blank" rel="noopener" href="http://localhost:8001">http://localhost:8001</a>’ has been blocked by <code>CORS</code> policy: Response to preflight request doesn’t pass access control check: No ‘<code>Access-Control-Allow-Origin</code>’ header is present on the requested resource.</p>
<p>从 8001 访问 88，引发 CORS 跨域请求，浏览器会拒绝跨域请求</p>
</blockquote>
<h4 id="跨域-P47"><a class="header-anchor" href="#跨域-P47">¶</a>跨域 P47</h4>
<p>问题描述：已拦截跨源请求：同源策略禁止读取位于 <a target="_blank" rel="noopener" href="http://localhost:88/api/sys/login">http://localhost:88/api/sys/login</a> 的远程资源。（原因：CORS 头缺少 ‘Access-Control-Allow-Origin’）。</p>
<p>问题分析：这是一种跨域问题。访问的域名和端口和原来的请求不同，请求就会被限制</p>
<p>· 跨域：指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对 js 施加的安全限制。（ajax 可以）</p>
<p>· 同源策略：是指<code>协议，域名，端囗</code>都要相同，其中有一个不同都会产生跨域；</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/395c34887dc7cd9fbddfbde5b3cb919a.png" class="" loading="lazy">
<p>跨域流程：</p>
<p>这个跨域请求的实现是通过预检请求实现的，先发送一个 OPSTIONS 探路，收到响应允许跨域后再发送真实请求</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/36abb19df131d0a12a64e1148e656d83.png" class="" loading="lazy">
<p><strong>前面跨域的解决方案</strong>：</p>
<ul>
<li>方法 1：设置 nginx 包含 admin 和 gateway</li>
<li>方法 2：让服务器告诉预检请求能跨域</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/9326f35e00df660ec46058ecd9246fa6.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/8c98dccd0b06bda0e3cf5f8979804f47.png" class="" loading="lazy">
<p>解决方法：在网关中定义 “<code>GulimallCorsConfiguration</code>” 类，该类用来做过滤，允许所有的请求跨域。</p>
<pre class="line-numbers language-none"><code class="language-none">package com.atguigu.gulimall.gateway.config;

@Configuration &#x2F;&#x2F; gateway
public class GulimallCorsConfiguration &#123;

    @Bean &#x2F;&#x2F; 添加过滤器
    public CorsWebFilter corsWebFilter()&#123;
        &#x2F;&#x2F; 基于url跨域，选择reactive包下的
        UrlBasedCorsConfigurationSource source&#x3D;new UrlBasedCorsConfigurationSource();
        &#x2F;&#x2F; 跨域配置信息
        CorsConfiguration corsConfiguration &#x3D; new CorsConfiguration();
        &#x2F;&#x2F; 允许跨域的头
        corsConfiguration.addAllowedHeader(&quot;*&quot;);
        &#x2F;&#x2F; 允许跨域的请求方式
        corsConfiguration.addAllowedMethod(&quot;*&quot;);
        &#x2F;&#x2F; 允许跨域的请求来源
        corsConfiguration.addAllowedOrigin(&quot;*&quot;);
        &#x2F;&#x2F; 是否允许携带cookie跨域
        corsConfiguration.setAllowCredentials(true);
        
       &#x2F;&#x2F; 任意url都要进行跨域配置
        source.registerCorsConfiguration(&quot;&#x2F;**&quot;,corsConfiguration);
        return new CorsWebFilter(source);
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>再次访问：<a target="_blank" rel="noopener" href="http://localhost:8001/#/login">http://localhost:8001/#/login</a></p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/686e6687aa58620e0dd6e19fb6ac3f51.png" class="" loading="lazy">
<p><a target="_blank" rel="noopener" href="http://localhost:8001/renren">http://localhost:8001/renren</a> 已拦截跨源请求：同源策略禁止读取位于 <a target="_blank" rel="noopener" href="http://localhost:88/api/sys/login">http://localhost:88/api/sys/login</a> 的远程资源。（原因：不允许有多个 ‘Access-Control-Allow-Origin’ CORS 头）n-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</p>
<p>出现了多个请求，并且也存在多个跨源请求。</p>
<p>为了解决这个问题，需要修改 renren-fast 项目，注释掉 “io.renren.config.CorsConfig” 类。然后再次进行访问。</p>
<h4 id="P48-product-路径重写"><a class="header-anchor" href="#P48-product-路径重写">¶</a>P48 product 路径重写</h4>
<p>在显示商品系统 / 分类信息的时候，出现了 404 异常，请求的 <a target="_blank" rel="noopener" href="http://localhost:88/api/product/category/list/tree">http://localhost:88/api/product/category/list/tree</a> 不存在</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/d15088764d4c25830bebca3f7f533b21.png" class="" loading="lazy">
<p>这是因为网关上所做的路径映射不正确，映射后的路径为 <a target="_blank" rel="noopener" href="http://localhost:8001/renren-fast/product/category/list/tree">http://localhost:8001/renren-fast/product/category/list/tree</a></p>
<p>但是只有通过 <a target="_blank" rel="noopener" href="http://localhost:10000/product/category/list/tree">http://localhost:10000/product/category/list/tree</a> 路径才能够正常访问，所以会报 404 异常。</p>
<p>解决方法就是定义一个 product 路由规则，进行路径重写：</p>
<pre class="line-numbers language-none"><code class="language-none">- id: product_route
          uri: lb:&#x2F;&#x2F;gulimall-product # 注册中心的服务
          predicates:
            - Path&#x3D;&#x2F;api&#x2F;product&#x2F;**
          filters:
            - RewritePath&#x3D;&#x2F;api&#x2F;(?&lt;segment&gt;&#x2F;?.*),&#x2F;$\&#123;segment&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 nacos 中新建命名空间，用命名空间隔离项目，(可以在其中新建 gulimall-product.yml)</p>
<p>在 product 项目中新建 bootstrap.properties，</p>
<pre class="line-numbers language-none"><code class="language-none">spring.application.name&#x3D;gulimall-product
spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848
spring.cloud.nacos.config.namespace&#x3D;e6cd36a8-81a2-4df2-bfbc-f0524fa17664<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在 application.yml</p>
<pre class="line-numbers language-none"><code class="language-none">spring:
  datasource:
    username: root
    password: root
    url: jdbc:mysql:&#x2F;&#x2F;192.168.56.10:3306&#x2F;guli_pms?useUnicode&#x3D;true&amp;characterEncoding&#x3D;UTF-8&amp;useSSL&#x3D;false&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai
    driver-class-name: com.mysql.cj.jdbc.Driver
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848

mybatis-plus:
  mapper-locations: classpath:&#x2F;mapper&#x2F;**&#x2F;*.xml
  global-config:
    db-config:
      id-type: auto
      logic-delete-value: 1
      logic-not-delete-value: 0

server:
  port: 10001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>主类上加上注解 @EnableDiscoveryClient</p>
<p>访问 localhost:88/api/product/category/list/tree invalid token，非法令牌，后台管理系统中没有登录，所以没有带令牌</p>
<p>原因：先匹配的先路由，fast 和 product 路由重叠，fast 要求登录</p>
<p>修正：在路由规则的顺序上，将精确的路由规则放置到模糊的路由规则的前面，否则的话，精确的路由规则将不会被匹配到，类似于异常体系中 try catch 子句中异常的处理顺序。</p>
<p><a target="_blank" rel="noopener" href="http://localhost:88/api/product/category/list/tree">http://localhost:88/api/product/category/list/tree</a> 正常</p>
<p>访问 <a target="_blank" rel="noopener" href="http://localhost:8001/#/product-category">http://localhost:8001/#/product-category</a> ，正常</p>
<p>原因是：先访问网关 88，网关路径重写后访问 nacos8848，nacos 找到服务</p>
<p>接着修改前端</p>
<p>data 解构，加上 {}，把 data 的地方改成 menus</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F;方法集合
  methods: &#123;
    getMenus() &#123;
      this.$http(&#123; &#x2F;&#x2F; http:&#x2F;&#x2F;localhost:10000&#x2F;renren-fast&#x2F;product&#x2F;category&#x2F;list&#x2F;tree
        url: this.$http.adornUrl(&quot;&#x2F;product&#x2F;category&#x2F;list&#x2F;tree&quot;),
        method: &quot;get&quot;
      &#125;)
        .then((&#123; data &#125;) &#x3D;&gt; &#123; &#x2F;&#x2F; success
          this.menus &#x3D; data.data; &#x2F;&#x2F; 数组内容，把数据给menus，就是给了vue实例，最后绑定到视图上
        &#125;) &#x2F;&#x2F;fail
        .catch(() &#x3D;&gt; &#123;&#125;);
    &#125;,<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此时有了 3 级结构，但是没有数据，在 category.vue 的模板中，数据是 menus，而还有一个 props。这是 element-ui 的规则，</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;template&gt;
  &lt;div&gt;
    &lt;el-tree
      :data&#x3D;&quot;menus&quot;
      :props&#x3D;&quot;defaultProps&quot;
    &gt;

而在data中
defaultProps: &#123;
        children: &quot;children&quot;,
        label: &quot;name&quot;
      &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="笔记-2"><a class="header-anchor" href="#笔记-2">¶</a>笔记 2</h2>
<p>笔记 - 基础篇 - 2(P49-P100)：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612619">https://blog.csdn.net/hancoder/article/details/107612619</a></p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>momo</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/" title="谷粒商城笔记_基础篇1">https://ppxiaodi.gitee.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%871/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%AB%98%E7%BA%A73/" rel="prev" title="谷粒商城笔记_分布式高级3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">谷粒商城笔记_分布式高级3</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%9F%BA%E7%A1%80%E7%AF%872/" rel="next" title="谷粒商城笔记_基础篇2"><span class="post-nav-text">谷粒商城笔记_基础篇2</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> momo</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.7.0</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div></div></body></html>