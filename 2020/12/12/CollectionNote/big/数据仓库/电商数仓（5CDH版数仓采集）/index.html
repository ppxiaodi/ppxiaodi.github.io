<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="momo"><meta name="copyright" content="momo"><meta name="generator" content="Hexo 5.2.0"><meta name="theme" content="hexo-theme-yun"><title>5CDH版数仓采集 | 我的笔记</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"ppxiaodi.github.io","root":"/","title":"momo的小站","version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="Cloudera Manager ¶1.1 CM简介 ¶1.1.1 CM简介 Cloudera Manager是一个拥有集群自动化安装、中心化管理、集群监控、报警功能的一个工具，使得安装集群从几天的时间缩短在几个小时内，运维人员从数十人降低到几人以内，极大的提高集群管理的效率。  ¶1.1.2 CM架构  ¶1.2 环境准备 ¶1.2.1 虚拟机准备 克隆三台虚拟机（hadoop102、hadoo">
<meta property="og:type" content="article">
<meta property="og:title" content="5CDH版数仓采集">
<meta property="og:url" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/index.html">
<meta property="og:site_name" content="我的笔记">
<meta property="og:description" content="Cloudera Manager ¶1.1 CM简介 ¶1.1.1 CM简介 Cloudera Manager是一个拥有集群自动化安装、中心化管理、集群监控、报警功能的一个工具，使得安装集群从几天的时间缩短在几个小时内，运维人员从数十人降低到几人以内，极大的提高集群管理的效率。  ¶1.1.2 CM架构  ¶1.2 环境准备 ¶1.2.1 虚拟机准备 克隆三台虚拟机（hadoop102、hadoo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405174909081.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnQduF.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/Gn3F74.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405174805586.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnYvQI.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntnmV.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntKTU.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntYOx.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntBfH.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnNiB6.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnN0bV.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnNza8.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GMbb0H.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GMqmcT.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GMOmmF.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQgDf.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQI8s.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQTvq.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQXaF.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlpx1.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQliqK.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlEIe.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQl1Z8.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQltRs.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlDdU.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQl5dO.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlLQI.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1CWj.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1ZwT.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1gAS.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1h1s.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ15Xq.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1j39.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ3Ggs.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ3wUU.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ3DC4.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8CMn.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/03/31/GQ8AaT.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8eG4.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8KMR.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ88IO.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8aQA.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ86Jg.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8xw6.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQGFld.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3u3QI.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3uryq.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3uffJ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3Mu2d.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3M1qP.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/856Pot-1586079875024.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3GnG8.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3GfQe.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3GjyQ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3JGOH.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3Y6gO.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3Y4UI.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3YHxS.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3tKxO.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3t1qH.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3tsds.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3tIeJ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3NpTA.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3NnTs.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3N86U.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3ND1K.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3NLAs.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3UV9x.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3UaDg.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3aSPI.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3aiM8.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3anGq.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3a8Z4.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/85ba0x.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8TgknS.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x31eJ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3tW6.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3BeH.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3Rl8.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3z79.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/856Pot.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3r0yt.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3rfln.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3sA1A.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3rOp9.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8xGWZQ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8xJRl6.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G36h6A.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G36Imt.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cPtU.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cA1J.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cen1.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cm0x.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cMtO.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cGjA.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fPSS.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fVwn.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3f8m9.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fNY6.png">
<meta property="og:image" content="https://s1.ax1x.com/2020/04/01/G3fckt.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fT7n.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fvX4.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3hmBd.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3h8gS.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3hNHs.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3haEn.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3hIgO.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G34lZ9.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G34YRK.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G34cz8.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G35h6O.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3IHrF.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3oKsS.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3o1aj.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3odLF.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3osiR.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3oWLD.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GD8jHI.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDGuCT.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDGBKH.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDG5rj.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDGvM4.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJFJK.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJneA.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJlJf.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJJyQ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJwF0.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJrSU.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJ4fK.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJLTI.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYAkq.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYm1U.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYuX4.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDY3A1.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYY9K.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDY0HA.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYs4P.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYWuQ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDY5En.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtS4x.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtC8K.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtYan.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtd2T.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtrqJ.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtWRK.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDt5se.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtHII.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172715465.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172841694.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172900987.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172938793.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405173004332.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405173050828.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405173128800.png">
<meta property="article:published_time" content="2020-12-11T16:00:00.000Z">
<meta property="article:modified_time" content="2021-07-11T08:54:53.640Z">
<meta property="article:author" content="momo">
<meta property="article:tag" content="大数据">
<meta property="article:tag" content="电商数仓">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405174909081.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="momo"><img width="96" loading="lazy" src="/yun.png" alt="momo"></a><div class="site-author-name"><a href="/about/">momo</a></div><a class="site-name" href="/about/site.html">我的笔记</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">199</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">58</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">47</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=kZJzggTTCf4SpvEQ8lXWoi5ZjhAx0ILZ&amp;jump_from=webapi" title="QQ 群 1050458482" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/jizhideyunyoujun" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/yunyoujun/" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=247102977" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/yunyoujun/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1579790" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/about/white-qrcode-and-search.jpg" title="微信公众号" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/YunYouJun" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/elpsycn" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@yunyoujun.cn" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-train-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Cloudera Manager</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-CM%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 CM简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-CM%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1.1 CM简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-CM%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.1.2 CM架构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%87%86%E5%A4%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 虚拟机准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-SSH%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 SSH免密登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-%E9%9B%86%E7%BE%A4%E5%90%8C%E6%AD%A5%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 集群同步脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-%E5%AE%89%E8%A3%85JDK%EF%BC%88%E4%B8%89%E5%8F%B0%EF%BC%89"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 安装JDK（三台）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-5-%E9%9B%86%E7%BE%A4%E6%95%B4%E4%BD%93%E6%93%8D%E4%BD%9C%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 集群整体操作脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-6-%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">1.2.6.</span> <span class="toc-text">1.2.6 安装MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-7-%E5%88%9B%E5%BB%BACM%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.7.</span> <span class="toc-text">1.2.7 创建CM用的数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-8-%E4%B8%8B%E8%BD%BD%E7%AC%AC%E4%B8%89%E6%96%B9%E4%BE%9D%E8%B5%96"><span class="toc-number">1.2.8.</span> <span class="toc-text">1.2.8 下载第三方依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-9-%E5%85%B3%E9%97%ADSELINUX"><span class="toc-number">1.2.9.</span> <span class="toc-text">1.2.9 关闭SELINUX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-10-%E9%85%8D%E7%BD%AENTP%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5"><span class="toc-number">1.2.10.</span> <span class="toc-text">1.2.10 配置NTP时钟同步</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-CM%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 CM安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-1-CM%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.3.1 CM下载地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-2-CM%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.2.</span> <span class="toc-text">1.3.2 CM安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-3-%E5%90%AF%E5%8A%A8CM%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.3.</span> <span class="toc-text">1.3.3 启动CM服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-4-%E5%85%B3%E9%97%ADCM%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.3.4.</span> <span class="toc-text">1.3.4 关闭CM服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-CM%E7%9A%84%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 CM的集群部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-%E6%8E%A5%E5%8F%97%E6%9D%A1%E6%AC%BE%E5%92%8C%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1 接受条款和协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2-%E9%80%89%E6%8B%A9%E5%85%8D%E8%B4%B9"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2 选择免费</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-3-%E6%8C%87%E5%AE%9A%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.4.3.</span> <span class="toc-text">1.4.3 指定主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-4-%E9%80%89%E6%8B%A9CDH%E7%9A%84%E7%89%88%E6%9C%AC5-12-1"><span class="toc-number">1.4.4.</span> <span class="toc-text">1.4.4 选择CDH的版本5.12.1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-5-%E7%AD%89%E5%BE%85%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-number">1.4.5.</span> <span class="toc-text">1.4.5 等待下载安装</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">第2章 数据采集模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-HDFS%E3%80%81YARN%E3%80%81Zookeeper%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 HDFS、YARN、Zookeeper安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E9%80%89%E6%8B%A9%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 选择自定义安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E9%80%89%E6%8B%A9%E5%AE%89%E8%A3%85%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 选择安装服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E5%88%86%E9%85%8D%E8%8A%82%E7%82%B9"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3 分配节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-%E9%9B%86%E7%BE%A4%E8%AE%BE%E7%BD%AE%E5%85%A8%E9%83%A8%E9%80%89%E9%BB%98%E8%AE%A4%E5%8D%B3%E5%8F%AF"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4 集群设置全部选默认即可</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.1.5.</span> <span class="toc-text">2.1.5 自动启动进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-6-%E4%BF%AE%E6%94%B9HDFS%E7%9A%84%E6%9D%83%E9%99%90%E6%A3%80%E6%9F%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.6.</span> <span class="toc-text">2.1.6 修改HDFS的权限检查配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-7-%E9%85%8D%E7%BD%AEHadoop%E6%94%AF%E6%8C%81LZO"><span class="toc-number">2.1.7.</span> <span class="toc-text">2.1.7 配置Hadoop支持LZO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Flume%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Flume安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86Flume%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 日志采集Flume安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86Flume%E9%85%8D%E7%BD%AE"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 日志采集Flume配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-Flume%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 Flume拦截器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-Kafka%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Kafka安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-%E5%AF%BC%E5%85%A5%E7%A6%BB%E7%BA%BF%E5%8C%85"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 导入离线包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E5%9C%A8%E7%BA%BF%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85%EF%BC%88%E4%B8%8D%E9%80%89%EF%BC%89"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 在线下载安装包（不选）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-Kafka%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 Kafka安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-%E6%9F%A5%E7%9C%8BKafka-Topic"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 查看Kafka Topic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-5-%E5%88%9B%E5%BB%BA-Kafka-Topic"><span class="toc-number">2.3.5.</span> <span class="toc-text">2.2.5 创建 Kafka Topic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-6-%E5%88%A0%E9%99%A4-Kafka-Topic"><span class="toc-number">2.3.6.</span> <span class="toc-text">2.3.6 删除 Kafka Topic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-7-%E7%94%9F%E4%BA%A7%E6%B6%88%E6%81%AF"><span class="toc-number">2.3.7.</span> <span class="toc-text">2.3.7 生产消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-8-%E6%B6%88%E8%B4%B9%E6%B6%88%E6%81%AF"><span class="toc-number">2.3.8.</span> <span class="toc-text">2.3.8 消费消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-9-%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AATopic%E7%9A%84%E8%AF%A6%E6%83%85"><span class="toc-number">2.3.9.</span> <span class="toc-text">2.3.9 查看某个Topic的详情</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-Flume%E6%B6%88%E8%B4%B9Kafka%E6%95%B0%E6%8D%AE%E5%86%99%E5%88%B0HDFS"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 Flume消费Kafka数据写到HDFS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E6%97%A5%E5%BF%97%E7%94%9F%E6%88%90%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%88%B0HDFS"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 日志生成数据传输到HDFS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">第3章 数仓搭建环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Hive%E5%AE%89%E8%A3%85"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Hive安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Oozie%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Oozie安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E6%B7%BB%E5%8A%A0Oozie%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 添加Oozie服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E9%80%89%E6%8B%A9%E9%9B%86%E7%BE%A4%E8%8A%82%E7%82%B9"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 选择集群节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-%E9%80%89%E6%8B%A9%E6%9C%89MySQL%E7%9A%84%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 选择有MySQL的节点安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-%E9%93%BE%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 链接数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5-%E4%B8%80%E8%B7%AF%E7%BB%A7%E7%BB%AD%E5%88%B0%E5%AE%8C%E6%88%90"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.5 一路继续到完成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-Hue%E5%AE%89%E8%A3%85"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Hue安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-Hue%E6%A6%82%E8%BF%B0"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 Hue概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%AE%89%E8%A3%85%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 安装前的准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-HUE%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 HUE安装步骤</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">第4章 用户行为数仓搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-ODS%E5%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 ODS层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1 创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E6%97%A5%E5%BF%97%E8%A1%A8ods-start-log"><span class="toc-number">4.1.2.</span> <span class="toc-text">4.1.2 创建启动日志表ods_start_log</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-ODS%E5%B1%82%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC"><span class="toc-number">4.1.3.</span> <span class="toc-text">4.1.3 ODS层加载数据脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-DWD%E5%B1%82%E5%90%AF%E5%8A%A8%E8%A1%A8%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 DWD层启动表数据解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E8%A1%A8"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1 创建启动表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-DWD%E5%B1%82%E5%90%AF%E5%8A%A8%E8%A1%A8%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2.2 DWD层启动表加载数据脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-DWS%E5%B1%82%EF%BC%88%E9%9C%80%E6%B1%82%EF%BC%9A%E7%94%A8%E6%88%B7%E6%97%A5%E6%B4%BB%E8%B7%83%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 DWS层（需求：用户日活跃）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-%E6%AF%8F%E6%97%A5%E6%B4%BB%E8%B7%83%E8%AE%BE%E5%A4%87%E6%98%8E%E7%BB%86"><span class="toc-number">4.3.1.</span> <span class="toc-text">4.3.1 每日活跃设备明细</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-DWS%E5%B1%82%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC"><span class="toc-number">4.3.2.</span> <span class="toc-text">4.3.2 DWS层加载数据脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-ADS%E5%B1%82%EF%BC%88%E9%9C%80%E6%B1%82%EF%BC%9A%E7%94%A8%E6%88%B7%E6%97%A5%E6%B4%BB%E8%B7%83%EF%BC%89"><span class="toc-number">4.4.</span> <span class="toc-text">4.4 ADS层（需求：用户日活跃）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-%E6%B4%BB%E8%B7%83%E8%AE%BE%E5%A4%87%E6%95%B0"><span class="toc-number">4.4.1.</span> <span class="toc-text">4.4.1 活跃设备数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2-ADS%E5%B1%82%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC"><span class="toc-number">4.4.2.</span> <span class="toc-text">4.4.2 ADS层加载数据脚本</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">第5章 业务数仓搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E7%94%9F%E6%88%90"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 业务数据生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-1-%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="toc-number">5.1.1.</span> <span class="toc-text">5.1.1 建表语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-2-%E7%94%9F%E6%88%90%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.2.</span> <span class="toc-text">5.1.2 生成业务数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E6%95%B0%E4%BB%93"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 业务数据导入数仓</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Sqoop%E5%AE%89%E8%A3%85"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 Sqoop安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Sqoop%E5%AE%9A%E6%97%B6%E5%AF%BC%E5%85%A5%E8%84%9A%E6%9C%AC"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 Sqoop定时导入脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-ODS%E5%B1%82"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 ODS层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95%E8%A1%A8"><span class="toc-number">5.3.1.</span> <span class="toc-text">5.3.1 创建订单表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E8%A1%A8"><span class="toc-number">5.3.2.</span> <span class="toc-text">5.3.2 创建订单详情表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-%E5%88%9B%E5%BB%BA%E5%95%86%E5%93%81%E8%A1%A8"><span class="toc-number">5.3.3.</span> <span class="toc-text">5.3.3 创建商品表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-4-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%A1%A8"><span class="toc-number">5.3.4.</span> <span class="toc-text">5.3.4 创建用户表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-5-%E5%88%9B%E5%BB%BA%E5%95%86%E5%93%81%E4%B8%80%E7%BA%A7%E5%88%86%E7%B1%BB%E8%A1%A8"><span class="toc-number">5.3.5.</span> <span class="toc-text">5.3.5 创建商品一级分类表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-6-%E5%88%9B%E5%BB%BA%E5%95%86%E5%93%81%E4%BA%8C%E7%BA%A7%E5%88%86%E7%B1%BB%E8%A1%A8"><span class="toc-number">5.3.6.</span> <span class="toc-text">5.3.6 创建商品二级分类表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-7-%E5%88%9B%E5%BB%BA%E5%95%86%E5%93%81%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E8%A1%A8"><span class="toc-number">5.3.7.</span> <span class="toc-text">5.3.7 创建商品三级分类表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-8-%E5%88%9B%E5%BB%BA%E6%94%AF%E4%BB%98%E6%B5%81%E6%B0%B4%E8%A1%A8"><span class="toc-number">5.3.8.</span> <span class="toc-text">5.3.8 创建支付流水表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-9-ODS%E5%B1%82%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E8%84%9A%E6%9C%AC"><span class="toc-number">5.3.9.</span> <span class="toc-text">5.3.9 ODS层数据导入脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-DWD%E5%B1%82"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 DWD层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-1-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95%E8%A1%A8"><span class="toc-number">5.4.1.</span> <span class="toc-text">5.4.1 创建订单表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-2-%E5%88%9B%E5%BB%BA%E8%AE%A2%E5%8D%95%E8%AF%A6%E6%83%85%E8%A1%A8"><span class="toc-number">5.4.2.</span> <span class="toc-text">5.4.2 创建订单详情表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-3-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%A1%A8"><span class="toc-number">5.4.3.</span> <span class="toc-text">5.4.3 创建用户表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-4-%E5%88%9B%E5%BB%BA%E6%94%AF%E4%BB%98%E6%B5%81%E6%B0%B4%E8%A1%A8"><span class="toc-number">5.4.4.</span> <span class="toc-text">5.4.4 创建支付流水表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-5-%E5%88%9B%E5%BB%BA%E5%95%86%E5%93%81%E8%A1%A8%EF%BC%88%E5%A2%9E%E5%8A%A0%E5%88%86%E7%B1%BB%EF%BC%89"><span class="toc-number">5.4.5.</span> <span class="toc-text">5.4.5 创建商品表（增加分类）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-6-DWD%E5%B1%82%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E8%84%9A%E6%9C%AC"><span class="toc-number">5.4.6.</span> <span class="toc-text">5.4.6 DWD层数据导入脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-DWS%E5%B1%82%E4%B9%8B%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%AE%BD%E8%A1%A8"><span class="toc-number">5.5.</span> <span class="toc-text">5.5 DWS层之用户行为宽表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-1-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E5%AE%BD%E8%A1%A8"><span class="toc-number">5.5.1.</span> <span class="toc-text">5.5.1 创建用户行为宽表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-2-%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%AE%BD%E8%A1%A8%E5%AF%BC%E5%85%A5%E8%84%9A%E6%9C%AC"><span class="toc-number">5.5.2.</span> <span class="toc-text">5.5.2 用户行为数据宽表导入脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-6-ADS%E5%B1%82%EF%BC%88%E9%9C%80%E6%B1%82%EF%BC%9AGMV%E6%88%90%E4%BA%A4%E6%80%BB%E9%A2%9D%EF%BC%89"><span class="toc-number">5.6.</span> <span class="toc-text">5.6 ADS层（需求：GMV成交总额）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-1-%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="toc-number">5.6.1.</span> <span class="toc-text">5.6.1 建表语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-2-%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E8%84%9A%E6%9C%AC"><span class="toc-number">5.6.2.</span> <span class="toc-text">5.6.2 数据导入脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-3-%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%87%BA%E8%84%9A%E6%9C%AC"><span class="toc-number">5.6.3.</span> <span class="toc-text">5.6.3 数据导出脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-7-Oozie%E5%9F%BA%E4%BA%8EHue%E5%AE%9E%E7%8E%B0GMV%E6%8C%87%E6%A0%87%E5%85%A8%E6%B5%81%E7%A8%8B%E8%B0%83%E5%BA%A6"><span class="toc-number">5.7.</span> <span class="toc-text">5.7 Oozie基于Hue实现GMV指标全流程调度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-1-%E6%89%A7%E8%A1%8C%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87"><span class="toc-number">5.7.1.</span> <span class="toc-text">5.7.1 执行前的准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-2-%E5%9C%A8Hue%E4%B8%AD%E5%88%9B%E5%BB%BAOozie%E4%BB%BB%E5%8A%A1GMV"><span class="toc-number">5.7.2.</span> <span class="toc-text">5.7.2 在Hue中创建Oozie任务GMV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-3-%E7%BC%96%E5%86%99%E4%BB%BB%E5%8A%A1%E8%84%9A%E6%9C%AC%E5%B9%B6%E4%B8%8A%E4%BC%A0%E5%88%B0HDFS"><span class="toc-number">5.7.3.</span> <span class="toc-text">5.7.3 编写任务脚本并上传到HDFS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-4-%E7%BC%96%E5%86%99%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6"><span class="toc-number">5.7.4.</span> <span class="toc-text">5.7.4 编写任务调度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-7-5-%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6"><span class="toc-number">5.7.5.</span> <span class="toc-text">5.7.5 执行任务调度</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">第6章 即席查询数仓搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-Impala%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 Impala安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E6%B7%BB%E5%8A%A0%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.1.1.</span> <span class="toc-text">6.1.1 添加服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-%E9%80%89%E6%8B%A9Impala%E6%9C%8D%E5%8A%A1"><span class="toc-number">6.1.2.</span> <span class="toc-text">6.1.2 选择Impala服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-3-%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D"><span class="toc-number">6.1.3.</span> <span class="toc-text">6.1.3 角色分配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-4-%E9%85%8D%E7%BD%AEImpala"><span class="toc-number">6.1.4.</span> <span class="toc-text">6.1.4 配置Impala</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-5-%E5%90%AF%E5%8A%A8Impala"><span class="toc-number">6.1.5.</span> <span class="toc-text">6.1.5 启动Impala</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-6-%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F"><span class="toc-number">6.1.6.</span> <span class="toc-text">6.1.6 安装成功</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-7-%E9%85%8D%E7%BD%AEHue%E6%94%AF%E6%8C%81Impala"><span class="toc-number">6.1.7.</span> <span class="toc-text">6.1.7 配置Hue支持Impala</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-Impala%E5%9F%BA%E4%BA%8EHue%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 Impala基于Hue查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">第7章 Spark2.1安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E5%8D%87%E7%BA%A7%E8%BF%87%E7%A8%8B"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 升级过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-1-%E7%A6%BB%E7%BA%BF%E5%8C%85%E4%B8%8B%E8%BD%BD"><span class="toc-number">7.1.1.</span> <span class="toc-text">7.1.1 离线包下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-2-%E7%A6%BB%E7%BA%BF%E5%8C%85%E4%B8%8A%E4%BC%A0"><span class="toc-number">7.1.2.</span> <span class="toc-text">7.1.2 离线包上传</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E9%A1%B5%E9%9D%A2%E6%93%8D%E4%BD%9C"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 页面操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-%E6%9B%B4%E6%96%B0Parcel"><span class="toc-number">7.2.1.</span> <span class="toc-text">7.2.1 更新Parcel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-%E7%82%B9%E5%87%BB%E5%88%86%E9%85%8D"><span class="toc-number">7.2.2.</span> <span class="toc-text">7.2.2 点击分配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-%E7%82%B9%E5%87%BB%E6%BF%80%E6%B4%BB"><span class="toc-number">7.2.3.</span> <span class="toc-text">7.2.3 点击激活</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-%E5%9B%9E%E5%88%B0%E9%A6%96%E9%A1%B5%E7%82%B9%E5%87%BB%E6%B7%BB%E5%8A%A0%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.2.4.</span> <span class="toc-text">7.2.4 回到首页点击添加服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-5-%E7%82%B9%E5%87%BBSpark2%E7%BB%A7%E7%BB%AD"><span class="toc-number">7.2.5.</span> <span class="toc-text">7.2.5 点击Spark2继续</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-6-%E9%80%89%E6%8B%A9%E4%B8%80%E7%BB%84%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="toc-number">7.2.6.</span> <span class="toc-text">7.2.6 选择一组依赖关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-7-%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D"><span class="toc-number">7.2.7.</span> <span class="toc-text">7.2.7 角色分配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-8-%E9%83%A8%E7%BD%B2%E5%B9%B6%E5%90%AF%E5%8A%A8"><span class="toc-number">7.2.8.</span> <span class="toc-text">7.2.8 部署并启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-9-%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%9F%A5%E7%9C%8B%E5%91%BD%E4%BB%A4"><span class="toc-number">7.2.9.</span> <span class="toc-text">7.2.9 命令行查看命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">第8章 Sentry安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-Sentry%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 Sentry安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-%E6%B7%BB%E5%8A%A0Sentry%E6%9C%8D%E5%8A%A1"><span class="toc-number">8.1.1.</span> <span class="toc-text">8.1.1 添加Sentry服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-%E9%80%89%E6%8B%A9%E6%B7%BB%E5%8A%A0%E5%88%B0%E9%9B%86%E7%BE%A4"><span class="toc-number">8.1.2.</span> <span class="toc-text">8.1.2 选择添加到集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-3-%E8%87%AA%E5%AE%9A%E4%B9%89Sentry%E8%A7%92%E8%89%B2%E5%88%86%E9%85%8D"><span class="toc-number">8.1.3.</span> <span class="toc-text">8.1.3 自定义Sentry角色分配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-4-Mysql%E4%B8%AD%E5%88%9B%E5%BB%BASentry%E5%BA%93"><span class="toc-number">8.1.4.</span> <span class="toc-text">8.1.4 Mysql中创建Sentry库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-5-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5"><span class="toc-number">8.1.5.</span> <span class="toc-text">8.1.5 配置数据库连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-6-%E6%88%90%E5%8A%9F%E5%AE%8C%E6%88%90Sentry%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B7%BB%E5%8A%A0"><span class="toc-number">8.1.6.</span> <span class="toc-text">8.1.6 成功完成Sentry的服务添加</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-Sentry%E4%B8%8EHive%E9%9B%86%E6%88%90%E4%BD%BF%E7%94%A8"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 Sentry与Hive集成使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-Hive%E7%9A%84%E9%85%8D%E7%BD%AE%E4%B8%AD%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%BB%A5%E4%B8%8B%E5%8F%82%E6%95%B0"><span class="toc-number">8.2.1.</span> <span class="toc-text">8.2.1 Hive的配置中需要配置以下参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-%E9%85%8D%E7%BD%AEHive%E4%BD%BF%E7%94%A8Sentry%E6%9C%8D%E5%8A%A1"><span class="toc-number">8.2.2.</span> <span class="toc-text">8.2.2 配置Hive使用Sentry服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-%E5%85%B3%E9%97%ADHive%E7%9A%84%E7%94%A8%E6%88%B7%E6%A8%A1%E6%8B%9F%E5%8A%9F%E8%83%BD"><span class="toc-number">8.2.3.</span> <span class="toc-text">8.2.3 关闭Hive的用户模拟功能</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-Sentry%E4%B8%8EHive%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 Sentry与Hive的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-1-%E4%BD%BF%E7%94%A8beeline%E8%BF%9E%E6%8E%A5HiveServer2%EF%BC%8C%E5%B9%B6%E7%99%BB%E5%BD%95hive%E7%94%A8%E6%88%B7"><span class="toc-number">8.3.1.</span> <span class="toc-text">8.3.1 使用beeline连接HiveServer2，并登录hive用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-2-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAadmin%E8%A7%92%E8%89%B2"><span class="toc-number">8.3.2.</span> <span class="toc-text">8.3.2 创建一个admin角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-3-%E4%B8%BAadmin%E8%A7%92%E8%89%B2%E8%B5%8B%E4%BA%88%E8%B6%85%E7%BA%A7%E6%9D%83%E9%99%90"><span class="toc-number">8.3.3.</span> <span class="toc-text">8.3.3 为admin角色赋予超级权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-4-%E5%B0%86admin%E8%A7%92%E8%89%B2%E6%8E%88%E6%9D%83%E7%BB%99hive%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">8.3.4.</span> <span class="toc-text">8.3.4 将admin角色授权给hive用户组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-5-%E5%88%9B%E5%BB%BAtest%E8%A1%A8"><span class="toc-number">8.3.5.</span> <span class="toc-text">8.3.5 创建test表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-6-%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E8%A7%92%E8%89%B2%E5%B9%B6%E6%8E%88%E6%9D%83%E7%BB%99%E7%94%A8%E6%88%B7%E7%BB%84"><span class="toc-number">8.3.6.</span> <span class="toc-text">8.3.6 创建测试角色并授权给用户组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-7-%E4%BD%BF%E7%94%A8hive%E7%94%A8%E6%88%B7%E5%88%9B%E5%BB%BA%E5%88%9B%E5%BB%BAread%E5%92%8Cwrite%E8%A7%92%E8%89%B2%EF%BC%8C%E5%B9%B6%E6%8E%88%E6%9D%83read%E8%A7%92%E8%89%B2%E5%AF%B9test%E8%A1%A8select%E6%9D%83%E9%99%90%EF%BC%8Cwrite%E8%A7%92%E8%89%B2%E5%AF%B9test%E8%A1%A8insert%E6%9D%83%E9%99%90"><span class="toc-number">8.3.7.</span> <span class="toc-text">8.3.7 使用hive用户创建创建read和write角色，并授权read角色对test表select权限，write角色对test表insert权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-8-%E4%B8%BAuser-r%E7%94%A8%E6%88%B7%E7%BB%84%E6%8E%88%E6%9D%83read%E8%A7%92%E8%89%B2%EF%BC%8C%E4%B8%BAuser-w%E7%94%A8%E6%88%B7%E7%BB%84%E6%8E%88%E6%9D%83write%E8%A7%92%E8%89%B2"><span class="toc-number">8.3.8.</span> <span class="toc-text">8.3.8 为user_r用户组授权read角色，为user_w用户组授权write角色</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-9-beeline%E9%AA%8C%E8%AF%81"><span class="toc-number">8.3.9.</span> <span class="toc-text">8.3.9 beeline验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-Kerberos%E5%9C%A8%E4%BC%81%E4%B8%9A%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 Kerberos在企业中的作用</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="momo"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="我的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">5CDH版数仓采集</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-12-12 00:00:00" itemprop="dateCreated datePublished" datetime="2020-12-12T00:00:00+08:00">2020-12-12</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2021-07-11 16:54:53" itemprop="dateModified" datetime="2021-07-11T16:54:53+08:00">2021-07-11</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">大数据</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/%E5%8D%B3%E5%B8%AD%E6%9F%A5%E8%AF%A2/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">即席查询</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">大数据</span></a><a class="tag-item" href="/tags/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">电商数仓</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1>Cloudera Manager</h1>
<h2 id="1-1-CM简介"><a class="header-anchor" href="#1-1-CM简介">¶</a>1.1 CM简介</h2>
<h3 id="1-1-1-CM简介"><a class="header-anchor" href="#1-1-1-CM简介">¶</a>1.1.1 CM简介</h3>
<p>Cloudera<br>
Manager是一个拥有集群自动化安装、中心化管理、集群监控、报警功能的一个工具，使得安装集群从几天的时间缩短在几个小时内，运维人员从数十人降低到几人以内，极大的提高集群管理的效率。</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405174909081.png" class="" title="image-20200405174909081" loading="lazy">
<h3 id="1-1-2-CM架构"><a class="header-anchor" href="#1-1-2-CM架构">¶</a>1.1.2 CM架构</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnQduF.png" class="" title="GnQduF.png" loading="lazy">
<h2 id="1-2-环境准备"><a class="header-anchor" href="#1-2-环境准备">¶</a>1.2 环境准备</h2>
<h3 id="1-2-1-虚拟机准备"><a class="header-anchor" href="#1-2-1-虚拟机准备">¶</a>1.2.1 虚拟机准备</h3>
<p>克隆三台虚拟机（hadoop102、hadoop103、hadoop104），配置好对应主机的网络IP、主机名称、关闭防火墙。</p>
<p>设置hadoop102、hadoop103、hadoop104的主机对应内存分别是：16G、4G、4G</p>
<h3 id="1-2-2-SSH免密登录"><a class="header-anchor" href="#1-2-2-SSH免密登录">¶</a>1.2.2 SSH免密登录</h3>
<p>配置hadoop102对hadoop102、hadoop103、hadoop104三台服务器免密登录。</p>
<p>1）生成公钥和私钥：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 .ssh]$ ssh-keygen -t rsa<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后敲（三个回车），就会生成两个文件id_rsa（私钥）、id_rsa.pub（公钥）</p>
<p>2）将公钥拷贝到要免密登录的目标机器上</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 .ssh]$ ssh-copy-id hadoop102
[root@hadoop102 .ssh]$ ssh-copy-id hadoop103
[root@hadoop102 .ssh]$ ssh-copy-id hadoop104<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>3）重复1和2的操作，配置hadoop103对hadoop102、hadoop103、hadoop104三台服务器免密登录。</p>
<h3 id="1-2-3-集群同步脚本"><a class="header-anchor" href="#1-2-3-集群同步脚本">¶</a>1.2.3 集群同步脚本</h3>
<p>1）在/root目录下创建bin目录，并在bin目录下创建文件xsync，文件内容如下：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 ~]$ mkdir bin
[root@hadoop102 ~]$ cd bin&#x2F;
[root@hadoop102 bin]$ vi xsync<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在该文件中编写如下代码</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#!&#x2F;bin&#x2F;bash
#1 获取输入参数个数，如果没有参数，直接退出
pcount&#x3D;$#
if((pcount&#x3D;&#x3D;0)); then
echo no args;
exit;
fi

#2 获取文件名称
p1&#x3D;$1
fname&#x3D;&#96;basename $p1&#96;
echo fname&#x3D;$fname

#3 获取上级目录到绝对路径
pdir&#x3D;&#96;cd -P $(dirname $p1); pwd&#96;
echo pdir&#x3D;$pdir

#4 获取当前用户名称
user&#x3D;&#96;whoami&#96;

#5 循环
for((host&#x3D;103; host&lt;105; host++)); do
        echo ------------------- hadoop$host --------------
        rsync -av $pdir&#x2F;$fname $user@hadoop$host:$pdir
done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）修改脚本 xsync 具有执行权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 bin]$ chmod 777 xsync<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="1-2-4-安装JDK（三台）"><a class="header-anchor" href="#1-2-4-安装JDK（三台）">¶</a>1.2.4 安装JDK（三台）</h3>
<p>1）在hadoop102的/opt目录下创建module和software文件夹</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 opt]# mkdir module
[root@hadoop102 opt]# mkdir software<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2）用SecureCRT将jdk-8u144-linux-x64.tar.gz导入到hadoop102的/opt/software目录</p>
<p>3）在Linux系统下的opt目录中查看软件包是否导入成功</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 software]$ ls
jdk-8u144-linux-x64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>4）解压JDK到/opt/module目录下，并修改文件的所有者和所有者组为root</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 software]$ tar -zxvf jdk-8u144-linux-x64.tar.gz -C &#x2F;opt&#x2F;module&#x2F;
[root@hadoop102 module]# chown root:root jdk1.8.0_144&#x2F; -R<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>5）配置JDK环境变量</p>
<p>（1）打开/etc/profile文件</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 software]$ vi &#x2F;etc&#x2F;profile
在profile文件末尾添加JDK路径
#JAVA_HOME
export JAVA_HOME&#x3D;&#x2F;opt&#x2F;module&#x2F;jdk1.8.0_144
export PATH&#x3D;$PATH:$JAVA_HOME&#x2F;bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>（2）让修改后的文件生效</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 jdk1.8.0_144]$ source &#x2F;etc&#x2F;profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6）测试JDK是否安装成功</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 jdk1.8.0_144]# java -version
java version &quot;1.8.0_144&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>7）将hadoop102中的JDK和环境变量分发到hadoop103、hadoop104两台主机</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 opt]# xsync &#x2F;opt&#x2F;module&#x2F;
[root@hadoop102 opt]# xsync &#x2F;etc&#x2F;profile

分别在hadoop103、hadoop104上source一下
[root@hadoop103 ~]$ source &#x2F;etc&#x2F;profile
[root@hadoop104 ~]# source &#x2F;etc&#x2F;profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1-2-5-集群整体操作脚本"><a class="header-anchor" href="#1-2-5-集群整体操作脚本">¶</a>1.2.5 集群整体操作脚本</h3>
<p>1）在/root/bin目录下创建脚本xcall.sh</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 bin]$ vim xcall.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）在脚本中编写如下内容</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#! &#x2F;bin&#x2F;bash

for i in hadoop102 hadoop103 hadoop104
do
        echo --------- $i ----------
        ssh $i &quot;$*&quot;
done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3）修改脚本执行权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 bin]$ chmod 777 xcall.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4）将/etc/profile文件追加到~/.bashrc后面</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 module]# cat &#x2F;etc&#x2F;profile &gt;&gt; ~&#x2F;.bashrc
[root@hadoop103 module]# cat &#x2F;etc&#x2F;profile &gt;&gt; ~&#x2F;.bashrc
[root@hadoop104 module]# cat &#x2F;etc&#x2F;profile &gt;&gt; ~&#x2F;.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>5）测试</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 bin]# xcall.sh jps<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="1-2-6-安装MySQL"><a class="header-anchor" href="#1-2-6-安装MySQL">¶</a>1.2.6 安装MySQL</h3>
<p>注意：一定要用root用户操作如下步骤；先卸载MySQL再安装</p>
<p><strong>1）安装包准备</strong></p>
<p>（1）查看MySQL是否安装</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 桌面]# rpm -qa|grep mysql
mysql-libs-5.1.73-7.el6.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>（2）如果安装了MySQL，就先卸载</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 桌面]# 
rpm -e --nodeps mysql-libs-5.1.73-7.el6.x86_64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>（3）上传mysql-libs.zip到hadoop102的/opt/software目录，并解压文件到当前目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 software]# unzip mysql-libs.zip
[root@hadoop102 software]# ls
mysql-libs.zip
mysql-libs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>（4）进入到mysql-libs文件夹下</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"> [root@hadoop102 mysql-libs]# ll
总用量 76048
-rw-r--r--. 1 root root 18509960 3月  26 2015 MySQL-client-5.6.24-1.el6.x86_64.rpm
-rw-r--r--. 1 root root  3575135 12月  1 2013 mysql-connector-java-5.1.27.tar.gz
-rw-r--r--. 1 root root 55782196 3月  26 2015 MySQL-server-5.6.24-1.el6.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>2）安装MySQL服务器</strong></p>
<p>（1）安装MySQL服务端</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 mysql-libs]# rpm -ivh MySQL-server-5.6.24-1.el6.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（2）查看产生的随机密码</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 mysql-libs]# cat &#x2F;root&#x2F;.mysql_secret
OEXaQuS8IWkG19Xs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>（3）查看MySQL状态</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 mysql-libs]# service mysql status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（4）启动MySQL</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 mysql-libs]# service mysql start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>3）安装MySQL客户端</strong></p>
<p>（1）安装MySQL客户端</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 mysql-libs]# rpm -ivh MySQL-client-5.6.24-1.el6.x86_64.rpm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（2）链接MySQL（密码替换成产生的随机密码）</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 mysql-libs]# mysql -uroot -pOEXaQuS8IWkG19Xs<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（3）修改密码</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt;SET PASSWORD&#x3D;PASSWORD(&#39;000000&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（4）退出MySQL</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt;exit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>4）MySQL中user表中主机配置</strong></p>
<p>配置只要是root用户+密码，在任何主机上都能登录MySQL数据库。</p>
<p>（1）进入MySQL</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 mysql-libs]# mysql -uroot -p000000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（2）显示数据库</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt;show databases;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（3）使用MySQL数据库</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;use mysql;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（4）展示MySQL数据库中的所有表</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;show tables;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（5）展示user表的结构</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;desc user;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（6）查询user表</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;select User, Host, Password from user;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（7）修改user表，把Host表内容修改为%</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;update user set host&#x3D;&#39;%&#39; where host&#x3D;&#39;localhost&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（8）删除root用户的其他host</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;
delete from user where Host&#x3D;&#39;hadoop102&#39;;
delete from user where Host&#x3D;&#39;127.0.0.1&#39;;
delete from user where Host&#x3D;&#39;::1&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>（9）刷新</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;flush privileges;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（10）退出</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt;quit;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="1-2-7-创建CM用的数据库"><a class="header-anchor" href="#1-2-7-创建CM用的数据库">¶</a>1.2.7 创建CM用的数据库</h3>
<p>在MySQL中依次创建监控数据库、Hive数据库、Oozie数据库、Hue数据库</p>
<p>1）启动数据库</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# mysql -uroot -p000000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）集群监控数据库</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt; create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）Hive数据库</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt; create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4）Oozie数据库</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt; create database oozie DEFAULT CHARSET utf8 COLLATE utf8_general_ci;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5）Hue数据库</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt; create database hue DEFAULT CHARSET utf8 COLLATE utf8_general_ci;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6）关闭数据库</p>
<pre class="line-numbers language-none"><code class="language-none">mysql&gt; quit;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="1-2-8-下载第三方依赖"><a class="header-anchor" href="#1-2-8-下载第三方依赖">¶</a>1.2.8 下载第三方依赖</h3>
<p>依次在三台节点（所有Agent的节点）上执行下载第三方依赖（注意：需要联网）</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# yum -y install chkconfig python bind-utils psmisc libxslt zlib sqlite cyrus-sasl-plain cyrus-sasl-gssapi fuse fuse-libs redhat-lsb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop103 ~]# yum -y install chkconfig python bind-utils psmisc libxslt zlib sqlite cyrus-sasl-plain cyrus-sasl-gssapi fuse fuse-libs redhat-lsb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop104 ~]# yum -y install chkconfig python bind-utils psmisc libxslt zlib sqlite cyrus-sasl-plain cyrus-sasl-gssapi fuse fuse-libs redhat-lsb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="1-2-9-关闭SELINUX"><a class="header-anchor" href="#1-2-9-关闭SELINUX">¶</a>1.2.9 关闭SELINUX</h3>
<p>安全增强型Linux（Security-Enhanced Linux）简称SELinux，它是一个 Linux<br>
内核模块，也是Linux的一个安全子系统。为了避免安装过程出现各种错误，建议关闭，有如下两种关闭方法：</p>
<p>1）临时关闭（不建议使用）</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# setenforce 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>但是这种方式只对当次启动有效，重启机器后会失效。</p>
<p>2）永久关闭（建议使用）</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# vim &#x2F;etc&#x2F;selinux&#x2F;config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>修改配置文件<code>/etc/selinux/config</code></p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# vim &#x2F;etc&#x2F;selinux&#x2F;config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将<code>SELINUX=enforcing</code> 改为<code>SELINUX=disabled</code></p>
<p>3）同步<code>/etc/selinux/config</code>配置文件</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# xsync &#x2F;etc&#x2F;selinux&#x2F;config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4）重启hadoop102、hadoop103、hadoop104主机</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# reboot
[root@hadoop103 ~]# reboot
[root@hadoop104 ~]# reboot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="1-2-10-配置NTP时钟同步"><a class="header-anchor" href="#1-2-10-配置NTP时钟同步">¶</a>1.2.10 配置NTP时钟同步</h3>
<p>1）NTP服务器配置</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# vi &#x2F;etc&#x2F;ntp.conf
注释掉所有的restrict开头的配置
修改#restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap
为restrict 192.168.1.102 mask 255.255.255.0 nomodify notrap
将所有server配置进行注释
添加下面两行内容
server 127.127.1.0
fudge 127.127.1.0 stratum 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）启动NTP服务 service ntpd start</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# service ntpd start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）NTP客户端配置（在agent主机上进行配置hadoop103,hadoop104）</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop103 ~]# vi &#x2F;etc&#x2F;ntp.conf

注释所有restrict和server配置
添加server 192.168.1.102<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>4）手动测试</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop103~]# ntpdate 192.168.1.102<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>显示如下内容为成功：</p>
<pre class="line-numbers language-none"><code class="language-none">17 Jun 15:34:38 ntpdate[9247]: step time server 192.168.1.102 offset 77556618.173854 sec<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果显示如下内容需要先关闭ntpd：</p>
<pre class="line-numbers language-none"><code class="language-none">17 Jun 15:25:42 ntpdate[8885]: the NTP socket is in use, exiting<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5）启动ntpd并设置为开机自启（每个节点hadoop102，hadoop103，hadoop104）</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop103 ~]#  chkconfig ntpd on
[root@hadoop103 ~]#  service ntpd start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>6）使用群发date命令查看结果</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/Gn3F74.png" class="" title="Gn3F74.png" loading="lazy">
<h2 id="1-3-CM安装部署"><a class="header-anchor" href="#1-3-CM安装部署">¶</a>1.3 CM安装部署</h2>
<h3 id="1-3-1-CM下载地址"><a class="header-anchor" href="#1-3-1-CM下载地址">¶</a>1.3.1 CM下载地址</h3>
<p>1）CM下载地址：<a target="_blank" rel="noopener" href="http://archive.cloudera.com/cm5/cm/5/cloudera-manager-el6-cm5.12.1_x86_64.tar.gz">http://archive.cloudera.com/cm5/cm/5/</a></p>
<p>2）离线库下载地址：<a target="_blank" rel="noopener" href="http://archive.cloudera.com/cdh5/parcels/latest/">http://archive.cloudera.com/cdh5/parcels</a></p>
<h3 id="1-3-2-CM安装"><a class="header-anchor" href="#1-3-2-CM安装">¶</a>1.3.2 CM安装</h3>
<p>注：以下所有操作均使用root用户</p>
<p>1）创建/opt/module/cm目录</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]# mkdir –p &#x2F;opt&#x2F;module&#x2F;cm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）上传<code>cloudera-manager-el6-cm5.12.1\_x86\_64.tar.gz</code>到hadoop102的<code>/opt/software</code>目录，并解压到<code>/opt/module/cm</code>目录</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 software]# tar -zxvf cloudera-manager-el6-cm5.12.1_x86_64.tar.gz -C &#x2F;opt&#x2F;module&#x2F;cm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）分别在hadoop102、hadoop103、hadoop104创建用户cloudera-scm</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]# 
useradd \
--system \
--home&#x3D;&#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;run&#x2F;cloudera-scm-server \
--no-create-home \
--shell&#x3D;&#x2F;bin&#x2F;false \
--comment &quot;Cloudera SCM User&quot; cloudera-scm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop103 module]# 
useradd \
--system \
--home&#x3D;&#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;run&#x2F;cloudera-scm-server \
--no-create-home \
--shell&#x3D;&#x2F;bin&#x2F;false \
--comment &quot;Cloudera SCM User&quot; cloudera-scm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop104 module]# 
useradd \
--system \
--home&#x3D;&#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;run&#x2F;cloudera-scm-server \
--no-create-home \
--shell&#x3D;&#x2F;bin&#x2F;false \
--comment &quot;Cloudera SCM User&quot; cloudera-scm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>参数说明：</p>
<blockquote>
<p>–system 创建一个系统账户</p>
<p>–home 指定用户登入时的主目录，替换系统默认值/home/&lt;用户名&gt;</p>
<p>–no-create-home 不要创建用户的主目录</p>
<p>–shell 用户的登录 shell 名</p>
<p>–comment 用户的描述信息</p>
</blockquote>
<p>注意：Cloudera<br>
Manager默认去找用户cloudera-scm，创建完该用户后，将自动使用此用户。</p>
<p>4）修改CM Agent配置</p>
<p>修改文件/opt/module/cm/cm-5.12.1/etc/cloudera-scm-agent/<br>
config.ini的主机名称</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cloudera-scm-agent]# vim &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;cloudera-scm-agent&#x2F;config.ini<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>修改主机名称</p>
<pre class="line-numbers language-none"><code class="language-none">server_host&#x3D;hadoop102<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5）配置CM的数据库</p>
<p>拷贝mysql-connector-java-5.1.27-bin.jar文件到目录 /usr/share/java/</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cm]# mkdir –p &#x2F;usr&#x2F;share&#x2F;java&#x2F;
[root@hadoop102 mysql-libs]# tar -zxvf mysql-connector-java-5.1.27.tar.gz

[root@hadoop102 mysql-libs]# cp &#x2F;opt&#x2F;software&#x2F;mysql-libs&#x2F;mysql-connector-java-5.1.27&#x2F;mysql-connector-java-5.1.27-bin.jar &#x2F;usr&#x2F;share&#x2F;java&#x2F;

[root@hadoop102 mysql-libs]# mv &#x2F;usr&#x2F;share&#x2F;java&#x2F;mysql-connector-java-5.1.27-bin.jar &#x2F;usr&#x2F;share&#x2F;java&#x2F;mysql-connector-java.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意：jar包名称要修改为mysql-connector-java.jar</p>
<p>6）使用CM自带的脚本，在MySQL中创建CM库</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cm-5.12.1]# 
&#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;share&#x2F;cmf&#x2F;schema&#x2F;scm_prepare_database.sh mysql cm -hhadoop102 -uroot -p000000 --scm-host hadoop102 scm scm scm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>参数说明</p>
<blockquote>
<p>-h：Database host</p>
<p>-u：Database username</p>
<p>-p：Database Password</p>
<p>–scm-host：SCM server’s hostname</p>
</blockquote>
<p>7）分发cm</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]# xsync &#x2F;opt&#x2F;module&#x2F;cm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>8）创建Parcel-repo</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]# mkdir -p &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo
[root@hadoop102 module]# chown cloudera-scm:cloudera-scm &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>9）拷贝下载文件<code>manifest.json</code>、<code>CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel.sha1</code>、<code>CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel</code>到hadoop102的<code>/opt/cloudera/parcel-repo/</code>目录下</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 parcel-repo]# ls
CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel  CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel.sha1  
manifest.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>10）将CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel.sha1：需改名为</p>
<p>CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel.sha</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 parcel-repo]# mv CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel.sha1 CDH-5.12.1-1.cdh5.12.1.p0.3-el6.parcel.sha<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>11）在hadoop102上创建目录/opt/cloudera/parcels，并修改该目录的所属用户及用户组为cloudera-scm</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]# mkdir -p &#x2F;opt&#x2F;cloudera&#x2F;parcels 
[root@hadoop102 module]# chown cloudera-scm:cloudera-scm &#x2F;opt&#x2F;cloudera&#x2F;parcels<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>12）分发/opt/cloudera/</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 opt]# xsync &#x2F;opt&#x2F;cloudera&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="1-3-3-启动CM服务"><a class="header-anchor" href="#1-3-3-启动CM服务">¶</a>1.3.3 启动CM服务</h3>
<p>1）启动服务节点：hadoop102</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-server start
Starting cloudera-scm-server:                              [确定]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>2）启动工作节点：hadoop102、hadoop103、hadoop104</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-agent start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop103 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-agent start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop104 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-agent start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>注意：启动过程非常慢，Manager启动成功需要等待5分钟左右，过程中会在数据库中创建对应的表需要耗费一些时间。</p>
<p>3）查看被占用则表示安装成功了！！！</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cm]# netstat -anp | grep 7180
tcp        0      0 0.0.0.0:7180                0.0.0.0:*                   LISTEN      5498&#x2F;java <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>4）访问http://hadoop102:7180，（用户名、密码：admin）</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405174805586.png" class="" title="image-20200405174805586" loading="lazy">
<h3 id="1-3-4-关闭CM服务"><a class="header-anchor" href="#1-3-4-关闭CM服务">¶</a>1.3.4 关闭CM服务</h3>
<p>1）关闭工作节点：hadoop102、hadoop103、hadoop104</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-agent stop
Stopping cloudera-scm-agent:                               [确定]
[root@hadoop103 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-agent stop
Stopping cloudera-scm-agent:                               [确定]
[root@hadoop104 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-agent stop
Stopping cloudera-scm-agent:                               [确定]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）关闭服务节点：hadoop102</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 cm]# &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;etc&#x2F;init.d&#x2F;cloudera-scm-server stop
停止 cloudera-scm-server：                                 [确定]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h2 id="1-4-CM的集群部署"><a class="header-anchor" href="#1-4-CM的集群部署">¶</a>1.4 CM的集群部署</h2>
<h3 id="1-4-1-接受条款和协议"><a class="header-anchor" href="#1-4-1-接受条款和协议">¶</a>1.4.1 接受条款和协议</h3>
{width="5.569444444444445in"
<p>height=“0.4791666666666667in”}</p>
<h3 id="1-4-2-选择免费"><a class="header-anchor" href="#1-4-2-选择免费">¶</a>1.4.2 选择免费</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnYvQI.png" class="" title="GnYvQI.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntnmV.png" class="" title="GntnmV.png" loading="lazy">
<h3 id="1-4-3-指定主机"><a class="header-anchor" href="#1-4-3-指定主机">¶</a>1.4.3 指定主机</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntKTU.png" class="" title="GntKTU.png" loading="lazy">
<h3 id="1-4-4-选择CDH的版本5-12-1"><a class="header-anchor" href="#1-4-4-选择CDH的版本5-12-1">¶</a>1.4.4 选择CDH的版本5.12.1</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntYOx.png" class="" title="GntYOx.png" loading="lazy">
<h3 id="1-4-5-等待下载安装"><a class="header-anchor" href="#1-4-5-等待下载安装">¶</a>1.4.5 等待下载安装</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GntBfH.png" class="" title="GntBfH.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnNiB6.png" class="" title="GnNiB6.png" loading="lazy">
<h1>第2章 数据采集模块</h1>
<h2 id="2-1-HDFS、YARN、Zookeeper安装"><a class="header-anchor" href="#2-1-HDFS、YARN、Zookeeper安装">¶</a>2.1 HDFS、YARN、Zookeeper安装</h2>
<h3 id="2-1-1-选择自定义安装"><a class="header-anchor" href="#2-1-1-选择自定义安装">¶</a>2.1.1 选择自定义安装</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnN0bV.png" class="" title="GnN0bV.png" loading="lazy">
<h3 id="2-1-2-选择安装服务"><a class="header-anchor" href="#2-1-2-选择安装服务">¶</a>2.1.2 选择安装服务</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GnNza8.png" class="" title="GnNza8.png" loading="lazy">
<h3 id="2-1-3-分配节点"><a class="header-anchor" href="#2-1-3-分配节点">¶</a>2.1.3 分配节点</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GMbb0H.png" class="" title="GMbb0H.png" loading="lazy">
<h3 id="2-1-4-集群设置全部选默认即可"><a class="header-anchor" href="#2-1-4-集群设置全部选默认即可">¶</a>2.1.4 集群设置全部选默认即可</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GMqmcT.png" class="" title="GMqmcT.png" loading="lazy">
<h3 id="2-1-5-自动启动进程"><a class="header-anchor" href="#2-1-5-自动启动进程">¶</a>2.1.5 自动启动进程</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GMOmmF.png" class="" title="GMOmmF.png" loading="lazy">
<h3 id="2-1-6-修改HDFS的权限检查配置"><a class="header-anchor" href="#2-1-6-修改HDFS的权限检查配置">¶</a>2.1.6 修改HDFS的权限检查配置</h3>
<p>关闭HDFS中的权限检查：dfs.permissions。</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQgDf.png" class="" title="GQQgDf.png" loading="lazy">
<h3 id="2-1-7-配置Hadoop支持LZO"><a class="header-anchor" href="#2-1-7-配置Hadoop支持LZO">¶</a>2.1.7 配置Hadoop支持LZO</h3>
<p>1）点击主机，在下拉菜单中点击Parcel</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQI8s.png" class="" title="GQQI8s.png" loading="lazy">
<p>2）点击配置</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQTvq.png" class="" title="GQQTvq.png" loading="lazy">
<p>3）找到远程Parcel存储库URL，点击最后一栏的加号，增加一栏，输入<a target="_blank" rel="noopener" href="http://archive-primary.cloudera.com/gplextras/parcels/latest/">http://archive.cloudera.com/gplextras/parcels/latest/</a>，之后点击保存更改</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQQXaF.png" class="" title="GQQXaF.png" loading="lazy">
<p>4）返回Parcel列表，可以看到多出了LZO，选择下载，下载完成后选择分配，分配完成后选择激活。</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlpx1.png" class="" title="GQlpx1.png" loading="lazy">
<p>5）安装完LZO后，打开HDFS配置，找到&quot;压缩编码解码器&quot;一栏，点击加号，添加com.hadoop.compression.lzo.LzopCodec后保存更改</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQliqK.png" class="" title="GQliqK.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlEIe.png" class="" title="GQlEIe.png" loading="lazy">
<p>6）打开YARN配置，找到MR 应用程序<br>
Classpath，添加/opt/cloudera/parcels/HADOOP_LZO/lib/hadoop/lib/hadoop-lzo-cdh4-0.4.15-gplextras.jar</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQl1Z8.png" class="" title="GQl1Z8.png" loading="lazy">
<p>7）更新过期配置，重启进程</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQltRs.png" class="" title="GQltRs.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlDdU.png" class="" title="GQlDdU.png" loading="lazy">
<h2 id="2-2-Flume安装"><a class="header-anchor" href="#2-2-Flume安装">¶</a>2.2 Flume安装</h2>
<h3 id="2-2-1-日志采集Flume安装"><a class="header-anchor" href="#2-2-1-日志采集Flume安装">¶</a>2.2.1 日志采集Flume安装</h3>
<p>1）添加服务</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQl5dO.png" class="" title="GQl5dO.png" loading="lazy">
<p>2）选择Flume，点击继续</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQlLQI.png" class="" title="GQlLQI.png" loading="lazy">
<p>3）选择节点</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1CWj.png" class="" title="GQ1CWj.png" loading="lazy">
<p>4）完成</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1ZwT.png" class="" title="GQ1ZwT.png" loading="lazy">
<h3 id="2-2-2-日志采集Flume配置"><a class="header-anchor" href="#2-2-2-日志采集Flume配置">¶</a>2.2.2 日志采集Flume配置</h3>
<p>1）Flume配置分析</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1gAS.png" class="" title="GQ1gAS.png" loading="lazy">
<p>Flume直接读log日志的数据，log日志的格式是app-yyyy-mm-dd.log。</p>
<p>2）Flume的具体配置如下：</p>
<p>（1）在CM管理页面上点击Flume</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1h1s.png" class="" title="GQ1h1s.png" loading="lazy">
<p>（2）在实例页面选择hadoop102上的Agent</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ15Xq.png" class="" title="GQ15Xq.png" loading="lazy">
<p>（3）在CM管理页面hadoop102上Flume的配置中找到代理名称改为a1</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ1j39.png" class="" title="GQ1j39.png" loading="lazy">
<p>（4）在配置文件如下内容(flume-kafka)</p>
<pre class="line-numbers language-none"><code class="language-none">a1.sources&#x3D;r1
a1.channels&#x3D;c1 c2 
a1.sinks&#x3D;k1 k2 

# configure source
a1.sources.r1.type &#x3D; TAILDIR
a1.sources.r1.positionFile &#x3D; &#x2F;opt&#x2F;module&#x2F;flume&#x2F;log_position.json
a1.sources.r1.filegroups &#x3D; f1
a1.sources.r1.filegroups.f1 &#x3D; &#x2F;tmp&#x2F;logs&#x2F;app.+
a1.sources.r1.fileHeader &#x3D; true
a1.sources.r1.channels &#x3D; c1 c2

#interceptor
a1.sources.r1.interceptors &#x3D; i1 i2
a1.sources.r1.interceptors.i1.type &#x3D; com.atguigu.flume.interceptor.LogETLInterceptor$Builder
a1.sources.r1.interceptors.i2.type &#x3D; com.atguigu.flume.interceptor.LogTypeInterceptor$Builder

# selector
a1.sources.r1.selector.type &#x3D; multiplexing
a1.sources.r1.selector.header &#x3D; topic
a1.sources.r1.selector.mapping.topic_start &#x3D; c1
a1.sources.r1.selector.mapping.topic_event &#x3D; c2

# configure channel
a1.channels.c1.type &#x3D; memory
a1.channels.c1.capacity&#x3D;10000
a1.channels.c1.byteCapacityBufferPercentage&#x3D;20

a1.channels.c2.type &#x3D; memory
a1.channels.c2.capacity&#x3D;10000
a1.channels.c2.byteCapacityBufferPercentage&#x3D;20

# configure sink
# start-sink
a1.sinks.k1.type &#x3D; org.apache.flume.sink.kafka.KafkaSink
a1.sinks.k1.kafka.topic &#x3D; topic_start
a1.sinks.k1.kafka.bootstrap.servers &#x3D; hadoop102:9092,hadoop103:9092,hadoop104:9092
a1.sinks.k1.kafka.flumeBatchSize &#x3D; 2000
a1.sinks.k1.kafka.producer.acks &#x3D; 1
a1.sinks.k1.channel &#x3D; c1

# event-sink
a1.sinks.k2.type &#x3D; org.apache.flume.sink.kafka.KafkaSink
a1.sinks.k2.kafka.topic &#x3D; topic_event
a1.sinks.k2.kafka.bootstrap.servers &#x3D; hadoop102:9092,hadoop103:9092,hadoop104:9092
a1.sinks.k2.kafka.flumeBatchSize &#x3D; 2000
a1.sinks.k2.kafka.producer.acks &#x3D; 1
a1.sinks.k2.channel &#x3D; c2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意：com.atguigu.flume.interceptor.LogETLInterceptor和com.atguigu.flume.interceptor.LogTypeInterceptor是自定义的拦截器的全类名。需要根据用户自定义的拦截器做相应修改。</p>
<p>（3）修改/opt/module/flume/log_position.json的读写权限</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 module]# mkdir -p &#x2F;opt&#x2F;module&#x2F;flume
[root@hadoop102 flume]# touch log_position.json
[root@hadoop102 flume]# chmod 777 log_position.json
[root@hadoop102 module]# xsync flume&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意：Json文件的父目录一定要创建好，并改好权限</p>
<h3 id="2-2-3-Flume拦截器"><a class="header-anchor" href="#2-2-3-Flume拦截器">¶</a>2.2.3 Flume拦截器</h3>
<p>本项目中自定义了两个拦截器，分别是：ETL拦截器、日志类型区分拦截器。</p>
<p>ETL拦截器主要用于，过滤时间戳不合法和Json数据不完整的日志</p>
<p>日志类型区分拦截器主要用于，将启动日志和事件日志区分开来，方便发往Kafka的不同Topic。</p>
<p>1）创建Maven工程flume-interceptor</p>
<p>2）创建包名：com.atguigu.flume.interceptor</p>
<p>3）在pom.xml文件中添加如下配置</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.flume<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>flume-ng-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">></span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-assembly-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRefs</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>descriptorRef</span><span class="token punctuation">></span></span>jar-with-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRef</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>descriptorRefs</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">></span></span>make-assembly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">></span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">></span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">></span></span>single<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">></span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4）在com.atguigu.flume.interceptor包下创建LogETLInterceptor类名</p>
<p>Flume ETL拦截器LogETLInterceptor</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Context</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">Interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogETLInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Event</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Event</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// 1 获取数据</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2 判断数据类型并向Header中赋值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LogUtils</span><span class="token punctuation">.</span><span class="token function">validateStart</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> event<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">LogUtils</span><span class="token punctuation">.</span><span class="token function">validateEvent</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> event<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 3 返回校验结果</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">></span></span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">></span></span> events<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">></span></span> interceptors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Event</span> event <span class="token operator">:</span> events<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Event</span> intercept1 <span class="token operator">=</span> <span class="token function">intercept</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>intercept1 <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>intercept1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> interceptors<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Interceptor</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogETLInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4）Flume日志过滤工具类</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>math<span class="token punctuation">.</span></span><span class="token class-name">NumberUtils</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogUtils</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">validateEvent</span><span class="token punctuation">(</span><span class="token class-name">String</span> log<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 服务器时间 | json</span>
        <span class="token comment">// 1549696569054 | &#123;"cm":&#123;"ln":"-89.2","sv":"V2.0.4","os":"8.2.0","g":"M67B4QYU@gmail.com","nw":"4G","l":"en","vc":"18","hw":"1080*1920","ar":"MX","uid":"u8678","t":"1549679122062","la":"-27.4","md":"sumsung-12","vn":"1.1.3","ba":"Sumsung","sr":"Y"&#125;,"ap":"weather","et":[]&#125;</span>

        <span class="token comment">// 1 切割</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> logContents <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\\|"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2 校验</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>logContents<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">//3 校验服务器时间</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logContents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">13</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">NumberUtils</span><span class="token punctuation">.</span><span class="token function">isDigits</span><span class="token punctuation">(</span>logContents<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 4 校验json</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>logContents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"&#123;"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>logContents<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">validateStart</span><span class="token punctuation">(</span><span class="token class-name">String</span> log<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>log <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token comment">// 校验json</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>log<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"&#123;"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>log<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5）Flume日志类型区分拦截器LogTypeInterceptor</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Context</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span></span><span class="token class-name">Event</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flume<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span></span><span class="token class-name">Interceptor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogTypeInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Event</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Event</span> event<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token comment">// 区分日志类型：   body  header</span>
        <span class="token comment">// 1 获取body数据</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> body <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2 获取header</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> headers <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3 判断数据类型并向Header中赋值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>log<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"topic"</span><span class="token punctuation">,</span><span class="token string">"topic_start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            headers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"topic"</span><span class="token punctuation">,</span><span class="token string">"topic_event"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> event<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">></span></span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">></span></span> events<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Event</span><span class="token punctuation">></span></span> interceptors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Event</span> event <span class="token operator">:</span> events<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Event</span> intercept1 <span class="token operator">=</span> <span class="token function">intercept</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>

            interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>intercept1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">return</span> interceptors<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Builder</span> <span class="token keyword">implements</span>  <span class="token class-name">Interceptor</span><span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">&#123;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">Interceptor</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">LogTypeInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>6）打包</p>
<p>拦截器打包之后，只需要单独包，不需要将依赖的包上传。打包之后要放入flume的lib文件夹下面。</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ3Ggs.png" class="" title="GQ3Ggs.png" loading="lazy">
<p>注意：为什么不需要依赖包？因为依赖包在flume的lib目录下面已经存在了。</p>
<p>7）采用root用户将flume-interceptor-1.0-SNAPSHOT.jar包放入到hadoop102的/opt/cloudera/parcels/CDH-5.12.1-1.cdh5.12.1.p0.3/lib/flume-ng/lib/文件夹下面。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 lib]# ls | grep interceptor
flume-interceptor-1.0-SNAPSHOT.jar<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>8）分发Flume到hadoop103</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 lib]$ xsync flume-interceptor-1.0-SNAPSHOT.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>9）启动Flume</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ3wUU.png" class="" title="GQ3wUU.png" loading="lazy">
<p>10）查看Flume日志</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ3DC4.png" class="" title="GQ3DC4.png" loading="lazy">
<h2 id="2-3-Kafka安装"><a class="header-anchor" href="#2-3-Kafka安装">¶</a>2.3 Kafka安装</h2>
<p>可以选择在线安装和离线包安装，在线安装下载时间较长，离线包安装时间较短。这里我们为了节省时间，选择离线安装。</p>
<h3 id="2-3-1-导入离线包"><a class="header-anchor" href="#2-3-1-导入离线包">¶</a>2.3.1 导入离线包</h3>
<p>1）在hadoop102上创建/opt/cloudera/csd目录</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 parcel-repo]# mkdir -p &#x2F;opt&#x2F;cloudera&#x2F;csd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）上传KAFKA-1.2.0.jar到/opt/cloudera/csd目录，并修改所有者和所有者的组</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 cloudera]# chown cloudera-scm:cloudera-scm &#x2F;opt&#x2F;cloudera&#x2F;csd&#x2F; -R<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）上传KAFKA-4.0.0-1.4.0.0.p0.1-el6.parcel、KAFKA-4.0.0-1.4.0.0.p0.1-el6.parcel.sha1到/opt/cloudera/parcel-repo目录，并修改KAFKA-4.0.0-1.4.0.0.p0.1-el6.parcel.sha1名称为KAFKA-4.0.0-1.4.0.0.p0.1-el6.parcel.sha</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 parcel-repo]# mv &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo&#x2F;KAFKA-4.0.0-1.4.0.0.p0.1-el6.parcel.sha1 &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo&#x2F;KAFKA-4.0.0-1.4.0.0.p0.1-el6.parcel.sha<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4）ClouderManager中选择Parcel-&gt;检查Parcel-&gt;Kafka点击分配-&gt;激活</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8CMn.png" class="" title="GQ8CMn.png" loading="lazy">
<p><img src="https://s1.ax1x.com/2020/03/31/GQ8AaT.png" alt="GQ8AaT.png" loading="lazy"></p>
<p>5）ClouderManager中选择Parcel-&gt;检查Parcel-&gt;Kafka点击分配-&gt;激活</p>
<h3 id="2-3-2-在线下载安装包（不选）"><a class="header-anchor" href="#2-3-2-在线下载安装包（不选）">¶</a>2.3.2 在线下载安装包（不选）</h3>
<p>1）点击主机，选择Parcel</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8eG4.png" class="" title="GQ8eG4.png" loading="lazy">
<p>2）找到Kafka点击下载，下载完成后点击分配进行分配，然后点击激活，出现已分配，已激活则证明分配激活成功</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8KMR.png" class="" title="GQ8KMR.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ88IO.png" class="" title="GQ88IO.png" loading="lazy">
<h3 id="2-3-3-Kafka安装"><a class="header-anchor" href="#2-3-3-Kafka安装">¶</a>2.3.3 Kafka安装</h3>
<ol start="3">
<li>回到首页，点击添加服务</li>
</ol>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8aQA.png" class="" title="GQ8aQA.png" loading="lazy">
<p>4）选择Kafka，点击继续</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ86Jg.png" class="" title="GQ86Jg.png" loading="lazy">
<p>5）Kafka的Broker选择三台机器</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQ8xw6.png" class="" title="GQ8xw6.png" loading="lazy">
<p>6）修改Kafka的堆大小为256M</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GQGFld.png" class="" title="GQGFld.png" loading="lazy">
<p>7）完成</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3u3QI.png" class="" title="G3u3QI.png" loading="lazy">
<p>8）重新部署客户端配置</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3uryq.png" class="" title="G3uryq.png" loading="lazy">
<p>9）点击重启过时服务</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3uffJ.png" class="" title="G3uffJ.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3Mu2d.png" class="" title="G3Mu2d.png" loading="lazy">
<p>10）等待重启，重启完成后点击完成</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3M1qP.png" class="" title="G3M1qP.png" loading="lazy">
<h3 id="2-3-4-查看Kafka-Topic"><a class="header-anchor" href="#2-3-4-查看Kafka-Topic">¶</a>2.3.4 查看Kafka Topic</h3>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 KAFKA-4.0.0-1.4.0.0.p0.1]#
&#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;KAFKA-4.0.0-1.4.0.0.p0.1&#x2F;bin&#x2F;kafka-topics --zookeeper hadoop102:2181 --list<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="2-2-5-创建-Kafka-Topic"><a class="header-anchor" href="#2-2-5-创建-Kafka-Topic">¶</a>2.2.5 创建 Kafka Topic</h3>
<p>进入到/opt/cloudera/parcels/KAFKA-4.0.0-1.4.0.0.p0.1目录下分别创建：启动日志主题、事件日志主题。</p>
<p>1）创建启动日志主题</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 KAFKA-4.0.0-1.4.0.0.p0.1]$ bin&#x2F;kafka-topics --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181  --create --replication-factor 1 --partitions 1 --topic topic_start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）创建事件日志主题</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 KAFKA-4.0.0-1.4.0.0.p0.1]$ bin&#x2F;kafka-topics --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181  --create --replication-factor 1 --partitions 1 --topic topic_event<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2-3-6-删除-Kafka-Topic"><a class="header-anchor" href="#2-3-6-删除-Kafka-Topic">¶</a>2.3.6 删除 Kafka Topic</h3>
<p>1）删除启动日志主题</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 KAFKA-4.0.0-1.4.0.0.p0.1]$ bin&#x2F;kafka-topics --delete --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181 --topic topic_start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）删除事件日志主题</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 KAFKA-4.0.0-1.4.0.0.p0.1]$ bin&#x2F;kafka-topics --delete --zookeeper hadoop102:2181,hadoop103:2181,hadoop104:2181 --topic topic_event<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2-3-7-生产消息"><a class="header-anchor" href="#2-3-7-生产消息">¶</a>2.3.7 生产消息</h3>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 KAFKA-4.0.0-1.4.0.0.p0.1]$
bin&#x2F;kafka-console-producer --broker-list hadoop102:9092 --topic topic_start
&gt;hello world
&gt;atguigu  atguigu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-3-8-消费消息"><a class="header-anchor" href="#2-3-8-消费消息">¶</a>2.3.8 消费消息</h3>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop103 KAFKA-4.0.0-1.4.0.0.p0.1]$ 
bin&#x2F;kafka-console-consumer \
--bootstrap-server hadoop102:9092 --from-beginning --topic topic_start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>–from-beginning：会把first主题中以往所有的数据都读取出来。根据业务场景选择是否增加该配置。</p>
<h3 id="2-3-9-查看某个Topic的详情"><a class="header-anchor" href="#2-3-9-查看某个Topic的详情">¶</a>2.3.9 查看某个Topic的详情</h3>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 KAFKA-4.0.0-1.4.0.0.p0.1]$ bin&#x2F;kafka-topics --zookeeper hadoop102:2181  --describe --topic topic_start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="2-4-Flume消费Kafka数据写到HDFS"><a class="header-anchor" href="#2-4-Flume消费Kafka数据写到HDFS">¶</a>2.4 Flume消费Kafka数据写到HDFS</h2>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/856Pot-1586079875024.png" class="" title="856Pot.png" loading="lazy">
<p>1）集群规划</p>
<table>
<thead>
<tr>
<th></th>
<th>服务器hadoop102</th>
<th>服务器hadoop103</th>
<th>服务器hadoop104</th>
</tr>
</thead>
<tbody>
<tr>
<td>Flume（消费Kafka）</td>
<td></td>
<td></td>
<td>Flume</td>
</tr>
</tbody>
</table>
<p>2）Flume配置分析</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3GnG8.png" class="" title="G3GnG8.png" loading="lazy">
<p>3）Flume的具体配置如下：</p>
<p>（1）在CM管理页面hadoop104上Flume的配置中找到代理名称</p>
<pre class="line-numbers language-none"><code class="language-none">a1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在配置文件如下内容(kafka-hdfs)</p>
<pre class="line-numbers language-none"><code class="language-none">## 组件
a1.sources&#x3D;r1 r2
a1.channels&#x3D;c1 c2
a1.sinks&#x3D;k1 k2

## source1
a1.sources.r1.type &#x3D; org.apache.flume.source.kafka.KafkaSource
a1.sources.r1.batchSize &#x3D; 5000
a1.sources.r1.batchDurationMillis &#x3D; 2000
a1.sources.r1.kafka.bootstrap.servers &#x3D; hadoop102:9092,hadoop103:9092,hadoop104:9092
a1.sources.r1.kafka.topics&#x3D;topic_start

## source2
a1.sources.r2.type &#x3D; org.apache.flume.source.kafka.KafkaSource
a1.sources.r2.batchSize &#x3D; 5000
a1.sources.r2.batchDurationMillis &#x3D; 2000
a1.sources.r2.kafka.bootstrap.servers &#x3D; hadoop102:9092,hadoop103:9092,hadoop104:9092
a1.sources.r2.kafka.topics&#x3D;topic_event

## channel1
a1.channels.c1.type&#x3D;memory
a1.channels.c1.capacity&#x3D;100000
a1.channels.c1.transactionCapacity&#x3D;10000

## channel2
a1.channels.c2.type&#x3D;memory
a1.channels.c2.capacity&#x3D;100000
a1.channels.c2.transactionCapacity&#x3D;10000

## sink1
a1.sinks.k1.type &#x3D; hdfs
a1.sinks.k1.hdfs.path &#x3D; &#x2F;origin_data&#x2F;gmall&#x2F;log&#x2F;topic_start&#x2F;%Y-%m-%d
a1.sinks.k1.hdfs.filePrefix &#x3D; logstart-
a1.sinks.k1.hdfs.round &#x3D; true
a1.sinks.k1.hdfs.roundValue &#x3D; 10
a1.sinks.k1.hdfs.roundUnit &#x3D; second

##sink2
a1.sinks.k2.type &#x3D; hdfs
a1.sinks.k2.hdfs.path &#x3D; &#x2F;origin_data&#x2F;gmall&#x2F;log&#x2F;topic_event&#x2F;%Y-%m-%d
a1.sinks.k2.hdfs.filePrefix &#x3D; logevent-
a1.sinks.k2.hdfs.round &#x3D; true
a1.sinks.k2.hdfs.roundValue &#x3D; 10
a1.sinks.k2.hdfs.roundUnit &#x3D; second

## 不要产生大量小文件
a1.sinks.k1.hdfs.rollInterval &#x3D; 10
a1.sinks.k1.hdfs.rollSize &#x3D; 134217728
a1.sinks.k1.hdfs.rollCount &#x3D; 0

a1.sinks.k2.hdfs.rollInterval &#x3D; 10
a1.sinks.k2.hdfs.rollSize &#x3D; 134217728
a1.sinks.k2.hdfs.rollCount &#x3D; 0

## 控制输出文件是原生文件。
a1.sinks.k1.hdfs.fileType &#x3D; CompressedStream 
a1.sinks.k2.hdfs.fileType &#x3D; CompressedStream 

a1.sinks.k1.hdfs.codeC &#x3D; lzop
a1.sinks.k2.hdfs.codeC &#x3D; lzop

## 拼装
a1.sources.r1.channels &#x3D; c1
a1.sinks.k1.channel&#x3D; c1

a1.sources.r2.channels &#x3D; c2
a1.sinks.k2.channel&#x3D; c2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-5-日志生成数据传输到HDFS"><a class="header-anchor" href="#2-5-日志生成数据传输到HDFS">¶</a>2.5 日志生成数据传输到HDFS</h2>
<p>1）将log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar上传都hadoop102的/opt/module目录</p>
<p>2）分发log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar到hadoop103</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]# xsync log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）在/root/bin目录下创建脚本lg.sh</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim lg.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4）在脚本中编写如下内容</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#! &#x2F;bin&#x2F;bash

	for i in hadoop102 hadoop103 
	do
		ssh $i &quot;java -classpath &#x2F;opt&#x2F;module&#x2F;log-collector-1.0-SNAPSHOT-jar-with-dependencies.jar com.atguigu.appclient.AppMain $1 $2 &gt;&#x2F;opt&#x2F;module&#x2F;test.log &amp;&quot;
	done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5）修改脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 lg.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>6）启动脚本</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]$ lg.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1>第3章 数仓搭建环境准备</h1>
<h2 id="3-1-Hive安装"><a class="header-anchor" href="#3-1-Hive安装">¶</a>3.1 Hive安装</h2>
<p>1）添加服务</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3GfQe.png" class="" title="G3GfQe.png" loading="lazy">
<p>2）添加Hive服务</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3GjyQ.png" class="" title="G3GjyQ.png" loading="lazy">
<p>3）将 Hive 服务添加到 Cluster 1</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3JGOH.png" class="" title="G3JGOH.png" loading="lazy">
<p>4）配置hive元数据</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3Y6gO.png" class="" title="G3Y6gO.png" loading="lazy">
<p>5）测试通过后继续</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3Y4UI.png" class="" title="G3Y4UI.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3YHxS.png" class="" title="G3YHxS.png" loading="lazy">
<p>6）自动启动Hive进程</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3tKxO.png" class="" title="G3tKxO.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3t1qH.png" class="" title="G3t1qH.png" loading="lazy">
<p>7）修改Hive配置</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3tsds.png" class="" title="G3tsds.png" loading="lazy">
<p>/opt/cloudera/parcels/HADOOP_LZO/lib/hadoop/lib/</p>
<h2 id="3-2-Oozie安装"><a class="header-anchor" href="#3-2-Oozie安装">¶</a>3.2 Oozie安装</h2>
<h3 id="3-2-1-添加Oozie服务"><a class="header-anchor" href="#3-2-1-添加Oozie服务">¶</a>3.2.1 添加Oozie服务</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3tIeJ.png" class="" title="G3tIeJ.png" loading="lazy">
<h3 id="3-2-2-选择集群节点"><a class="header-anchor" href="#3-2-2-选择集群节点">¶</a>3.2.2 选择集群节点</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3NpTA.png" class="" title="G3NpTA.png" loading="lazy">
<h3 id="3-2-3-选择有MySQL的节点安装"><a class="header-anchor" href="#3-2-3-选择有MySQL的节点安装">¶</a>3.2.3 选择有MySQL的节点安装</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3NnTs.png" class="" title="G3NnTs.png" loading="lazy">
<h3 id="3-2-4-链接数据库"><a class="header-anchor" href="#3-2-4-链接数据库">¶</a>3.2.4 链接数据库</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3N86U.png" class="" title="G3N86U.png" loading="lazy">
<h3 id="3-2-5-一路继续到完成"><a class="header-anchor" href="#3-2-5-一路继续到完成">¶</a>3.2.5 一路继续到完成</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3ND1K.png" class="" title="G3ND1K.png" loading="lazy">
<h2 id="3-3-Hue安装"><a class="header-anchor" href="#3-3-Hue安装">¶</a>3.3 Hue安装</h2>
<h3 id="3-3-1-Hue概述"><a class="header-anchor" href="#3-3-1-Hue概述">¶</a>3.3.1 Hue概述</h3>
<p>1）Hue来源</p>
<p>HUE=Hadoop User Experience（Hadoop用户体验），直白来说就一个开源的Apache<br>
Hadoop UI系统，由Cloudera Desktop演化而来，最后Cloudera公司将其贡献给Apache基金会的Hadoop社区，它是基于Python Web框架Django实现的。通过使用HUE我们可以在浏览器端的Web控制台上与Hadoop集群进行交互来分析处理数据。</p>
<p>2）Hue官网及使用者</p>
<p>官网网站：<a target="_blank" rel="noopener" href="http://gethue.com/">http://gethue.com/</a></p>
<h3 id="3-3-2-安装前的准备"><a class="header-anchor" href="#3-3-2-安装前的准备">¶</a>3.3.2 安装前的准备</h3>
<p>1）在LoadBalancer节点安装mod_ssl</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# yum -y install mod_ssl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）查看/usr/lib64/mysql下有没有libmysqlclient_r.so.16，如果没有，上传libmysqlclient_r.so.16到/usr/lib64/mysql，并软链接到/usr/lib64/</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# ls &#x2F;usr&#x2F;lib64&#x2F;mysql
[root@hadoop103 mysql]# 
scp &#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;libmysqlclient_r.so.16 root@hadoop102:&#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;

[root@hadoop102 ~]ln -s &#x2F;usr&#x2F;lib64&#x2F;mysql&#x2F;libmysqlclient_r.so.16 &#x2F;usr&#x2F;lib64&#x2F;libmysqlclient_r.so.16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="3-3-3-HUE安装步骤"><a class="header-anchor" href="#3-3-3-HUE安装步骤">¶</a>3.3.3 HUE安装步骤</h3>
<p>1）添加HUE服务</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3NLAs.png" class="" title="G3NLAs.png" loading="lazy">
<p>2）选择集群节点</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3UV9x.png" class="" title="G3UV9x.png" loading="lazy">
<p>3）分配角色</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3UaDg.png" class="" title="G3UaDg.png" loading="lazy">
<p>4）配置数据库</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3aSPI.png" class="" title="G3aSPI.png" loading="lazy">
<p>5）安装完成</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3aiM8.png" class="" title="G3aiM8.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3anGq.png" class="" title="G3anGq.png" loading="lazy">
<p>6）HUE页面</p>
<p><a target="_blank" rel="noopener" href="http://hadoop102:8888">[http://hadoop102:8888]{.underline}</a>（未优化）或<a target="_blank" rel="noopener" href="http://hadoop102:8889">[http://hadoop102:8889]{.underline}</a>（优化）</p>
<p>第一次开启HUE会出现以下页面，此时输入的用户名和密码可以随意，之后登录页面以第一次输入的账号密码为依据。例如，用户名：admin<br>
密码：admin</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3a8Z4.png" class="" title="G3a8Z4.png" loading="lazy">
<h1>第4章 用户行为数仓搭建</h1>
<h2 id="4-1-ODS层"><a class="header-anchor" href="#4-1-ODS层">¶</a>4.1 ODS层</h2>
<p>原始数据层，存放原始数据，直接加载原始日志、数据，数据保持原貌不做处理。</p>
<h3 id="4-1-1-创建数据库"><a class="header-anchor" href="#4-1-1-创建数据库">¶</a>4.1.1 创建数据库</h3>
<p>1）创建gmall数据库</p>
<pre class="line-numbers language-none"><code class="language-none">hive (default)&gt; create database gmall;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>说明：如果数据库存在且有数据，需要强制删除时执行：drop database gmall<br>
cascade;</p>
<p>2）使用gmall数据库</p>
<pre class="line-numbers language-none"><code class="language-none">hive (default)&gt; use gmall; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="4-1-2-创建启动日志表ods-start-log"><a class="header-anchor" href="#4-1-2-创建启动日志表ods-start-log">¶</a>4.1.2 创建启动日志表ods_start_log</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/85ba0x.png" class="" title="85ba0x.png" loading="lazy">
<p>1）创建输入数据是lzo输出是text，支持json解析的分区表</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">hive <span class="token punctuation">(</span>gmall<span class="token punctuation">)</span><span class="token operator">></span> 
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> ods_start_log<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> EXTERNAL <span class="token keyword">TABLE</span> ods_start_log <span class="token punctuation">(</span><span class="token punctuation">`</span>line<span class="token punctuation">`</span> string<span class="token punctuation">)</span>
PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>dt<span class="token punctuation">`</span> string<span class="token punctuation">)</span>
STORED <span class="token keyword">AS</span>
  INPUTFORMAT <span class="token string">'com.hadoop.mapred.DeprecatedLzoTextInputFormat'</span>
  OUTPUTFORMAT <span class="token string">'org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat'</span>
LOCATION <span class="token string">'/warehouse/gmall/ods/ods_start_log'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>说明Hive的LZO压缩：<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+LZO">[https://cwiki.apache.org/confluence/display/Hive/LanguageManual+LZO]{.underline}</a></p>
<h3 id="4-1-3-ODS层加载数据脚本"><a class="header-anchor" href="#4-1-3-ODS层加载数据脚本">¶</a>4.1.3 ODS层加载数据脚本</h3>
<p>1）在hadoop102的/root/bin目录下创建脚本</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim ods_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中编写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

# 定义变量方便修改
APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
   do_date&#x3D;$1
else 
   do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;
fi 

echo &quot;&#x3D;&#x3D;&#x3D;日志日期为 $do_date&#x3D;&#x3D;&#x3D;&quot;
sql&#x3D;&quot;
load data inpath &#39;&#x2F;origin_data&#x2F;gmall&#x2F;log&#x2F;topic_start&#x2F;$do_date&#39; into table &quot;$APP&quot;.ods_start_log partition(dt&#x3D;&#39;$do_date&#39;);

&quot;

hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>说明1：</p>
<blockquote>
<p>[ -n 变量值 ] 判断变量的值，是否为空</p>
<p>– 变量的值，非空，返回true</p>
<p>– 变量的值，为空，返回false</p>
</blockquote>
<p>说明2：</p>
<p>查看date命令的使用，<code>[root@hadoop102 ~]$ date --help</code></p>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 ods_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）脚本使用</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]$ ods_log.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="4-2-DWD层启动表数据解析"><a class="header-anchor" href="#4-2-DWD层启动表数据解析">¶</a>4.2 DWD层启动表数据解析</h2>
<h3 id="4-2-1-创建启动表"><a class="header-anchor" href="#4-2-1-创建启动表">¶</a>4.2.1 创建启动表</h3>
<p>1）建表语句</p>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt; 
drop table if exists dwd_start_log;
CREATE EXTERNAL TABLE dwd_start_log(
&#96;mid_id&#96; string,
&#96;user_id&#96; string, 
&#96;version_code&#96; string, 
&#96;version_name&#96; string, 
&#96;lang&#96; string, 
&#96;source&#96; string, 
&#96;os&#96; string, 
&#96;area&#96; string, 
&#96;model&#96; string,
&#96;brand&#96; string, 
&#96;sdk_version&#96; string, 
&#96;gmail&#96; string, 
&#96;height_width&#96; string,  
&#96;app_time&#96; string,
&#96;network&#96; string, 
&#96;lng&#96; string, 
&#96;lat&#96; string, 
&#96;entry&#96; string, 
&#96;open_ad_type&#96; string, 
&#96;action&#96; string, 
&#96;loading_time&#96; string, 
&#96;detail&#96; string, 
&#96;extend1&#96; string
)
PARTITIONED BY (dt string)
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dwd&#x2F;dwd_start_log&#x2F;&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-2-2-DWD层启动表加载数据脚本"><a class="header-anchor" href="#4-2-2-DWD层启动表加载数据脚本">¶</a>4.2.2 DWD层启动表加载数据脚本</h3>
<p>1）在hadoop102的/root/bin目录下创建脚本</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim dwd_start_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中编写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

# 定义变量方便修改
APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
	do_date&#x3D;$1
else 
	do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;  
fi 

sql&#x3D;&quot;
set hive.exec.dynamic.partition.mode&#x3D;nonstrict;

insert overwrite table &quot;$APP&quot;.dwd_start_log
PARTITION (dt&#x3D;&#39;$do_date&#39;)
select 
    get_json_object(line,&#39;$.mid&#39;) mid_id,
    get_json_object(line,&#39;$.uid&#39;) user_id,
    get_json_object(line,&#39;$.vc&#39;) version_code,
    get_json_object(line,&#39;$.vn&#39;) version_name,
    get_json_object(line,&#39;$.l&#39;) lang,
    get_json_object(line,&#39;$.sr&#39;) source,
    get_json_object(line,&#39;$.os&#39;) os,
    get_json_object(line,&#39;$.ar&#39;) area,
    get_json_object(line,&#39;$.md&#39;) model,
    get_json_object(line,&#39;$.ba&#39;) brand,
    get_json_object(line,&#39;$.sv&#39;) sdk_version,
    get_json_object(line,&#39;$.g&#39;) gmail,
    get_json_object(line,&#39;$.hw&#39;) height_width,
    get_json_object(line,&#39;$.t&#39;) app_time,
    get_json_object(line,&#39;$.nw&#39;) network,
    get_json_object(line,&#39;$.ln&#39;) lng,
    get_json_object(line,&#39;$.la&#39;) lat,
    get_json_object(line,&#39;$.entry&#39;) entry,
    get_json_object(line,&#39;$.open_ad_type&#39;) open_ad_type,
    get_json_object(line,&#39;$.action&#39;) action,
    get_json_object(line,&#39;$.loading_time&#39;) loading_time,
    get_json_object(line,&#39;$.detail&#39;) detail,
    get_json_object(line,&#39;$.extend1&#39;) extend1
from &quot;$APP&quot;.ods_start_log 
where dt&#x3D;&#39;$do_date&#39;;
&quot;

hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 dwd_start_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）脚本使用</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]$ dwd_start_log.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="4-3-DWS层（需求：用户日活跃）"><a class="header-anchor" href="#4-3-DWS层（需求：用户日活跃）">¶</a>4.3 DWS层（需求：用户日活跃）</h2>
<p>目标：统计当日、当周、当月活动的每个设备明细</p>
<h3 id="4-3-1-每日活跃设备明细"><a class="header-anchor" href="#4-3-1-每日活跃设备明细">¶</a>4.3.1 每日活跃设备明细</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8TgknS.png" class="" title="8TgknS.png" loading="lazy">
<p>1）建表语句</p>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists dws_uv_detail_day;
create external table dws_uv_detail_day
(
    &#96;mid_id&#96; string COMMENT &#39;设备唯一标识&#39;,
    &#96;user_id&#96; string COMMENT &#39;用户标识&#39;, 
    &#96;version_code&#96; string COMMENT &#39;程序版本号&#39;, 
    &#96;version_name&#96; string COMMENT &#39;程序版本名&#39;, 
    &#96;lang&#96; string COMMENT &#39;系统语言&#39;, 
    &#96;source&#96; string COMMENT &#39;渠道号&#39;, 
    &#96;os&#96; string COMMENT &#39;安卓系统版本&#39;, 
    &#96;area&#96; string COMMENT &#39;区域&#39;, 
    &#96;model&#96; string COMMENT &#39;手机型号&#39;, 
    &#96;brand&#96; string COMMENT &#39;手机品牌&#39;, 
    &#96;sdk_version&#96; string COMMENT &#39;sdkVersion&#39;, 
    &#96;gmail&#96; string COMMENT &#39;gmail&#39;, 
    &#96;height_width&#96; string COMMENT &#39;屏幕宽高&#39;,
    &#96;app_time&#96; string COMMENT &#39;客户端日志产生时的时间&#39;,
    &#96;network&#96; string COMMENT &#39;网络模式&#39;,
    &#96;lng&#96; string COMMENT &#39;经度&#39;,
    &#96;lat&#96; string COMMENT &#39;纬度&#39;
)
partitioned by(dt string)
stored as parquet
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dws&#x2F;dws_uv_detail_day&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-3-2-DWS层加载数据脚本"><a class="header-anchor" href="#4-3-2-DWS层加载数据脚本">¶</a>4.3.2 DWS层加载数据脚本</h3>
<p>1）在hadoop102的/root/bin目录下创建脚本</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim dws_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中编写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

# 定义变量方便修改
APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
	do_date&#x3D;$1
else 
	do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;  
fi 


sql&#x3D;&quot;
  set hive.exec.dynamic.partition.mode&#x3D;nonstrict;

  insert overwrite table &quot;$APP&quot;.dws_uv_detail_day partition(dt&#x3D;&#39;$do_date&#39;)
  select  
    mid_id,
    concat_ws(&#39;|&#39;, collect_set(user_id)) user_id,
    concat_ws(&#39;|&#39;, collect_set(version_code)) version_code,
    concat_ws(&#39;|&#39;, collect_set(version_name)) version_name,
    concat_ws(&#39;|&#39;, collect_set(lang)) lang,
    concat_ws(&#39;|&#39;, collect_set(source)) source,
    concat_ws(&#39;|&#39;, collect_set(os)) os,
    concat_ws(&#39;|&#39;, collect_set(area)) area, 
    concat_ws(&#39;|&#39;, collect_set(model)) model,
    concat_ws(&#39;|&#39;, collect_set(brand)) brand,
    concat_ws(&#39;|&#39;, collect_set(sdk_version)) sdk_version,
    concat_ws(&#39;|&#39;, collect_set(gmail)) gmail,
    concat_ws(&#39;|&#39;, collect_set(height_width)) height_width,
    concat_ws(&#39;|&#39;, collect_set(app_time)) app_time,
    concat_ws(&#39;|&#39;, collect_set(network)) network,
    concat_ws(&#39;|&#39;, collect_set(lng)) lng,
    concat_ws(&#39;|&#39;, collect_set(lat)) lat
  from &quot;$APP&quot;.dwd_start_log
  where dt&#x3D;&#39;$do_date&#39;  
  group by mid_id;
&quot;

hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 dws_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）脚本使用</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]$ dws_log.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="4-4-ADS层（需求：用户日活跃）"><a class="header-anchor" href="#4-4-ADS层（需求：用户日活跃）">¶</a>4.4 ADS层（需求：用户日活跃）</h2>
<p>目标：当日活跃设备数</p>
<h3 id="4-4-1-活跃设备数"><a class="header-anchor" href="#4-4-1-活跃设备数">¶</a>4.4.1 活跃设备数</h3>
<p>1）建表语句</p>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ads_uv_count;
create external table ads_uv_count( 
    &#96;dt&#96; string COMMENT &#39;统计日期&#39;,
    &#96;day_count&#96; bigint COMMENT &#39;当日用户数量&#39;
) COMMENT &#39;活跃设备数&#39; 
row format delimited fields terminated by &#39;\t&#39;
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ads&#x2F;ads_uv_count&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-4-2-ADS层加载数据脚本"><a class="header-anchor" href="#4-4-2-ADS层加载数据脚本">¶</a>4.4.2 ADS层加载数据脚本</h3>
<p>1）在hadoop102的/root/bin目录下创建脚本</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim ads_uv_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中编写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

# 定义变量方便修改
APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
	do_date&#x3D;$1
else 
	do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;  
fi 

sql&#x3D;&quot;
  set hive.exec.dynamic.partition.mode&#x3D;nonstrict;

insert into table &quot;$APP&quot;.ads_uv_count 
select  
  &#39;$do_date&#39; dt,
   daycount.ct
from 
(
   select  
      &#39;$do_date&#39; dt,
       count(*) ct
   from &quot;$APP&quot;.dws_uv_detail_day
   where dt&#x3D;&#39;$do_date&#39;  
)daycount;
&quot;

hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 ads_uv_log.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）脚本使用</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 module]$ ads_uv_log.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1>第5章 业务数仓搭建</h1>
<h2 id="5-1-业务数据生成"><a class="header-anchor" href="#5-1-业务数据生成">¶</a>5.1 业务数据生成</h2>
<h3 id="5-1-1-建表语句"><a class="header-anchor" href="#5-1-1-建表语句">¶</a>5.1.1 建表语句</h3>
<p>1）通过SQLyog创建数据库gmall</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x31eJ.png" class="" title="8x31eJ.png" loading="lazy">
<p>2）设置数据库编码</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3tW6.png" class="" title="8x3tW6.png" loading="lazy">
<p>3）导入建表语句（1建表脚本）</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3BeH.png" class="" title="8x3BeH.png" loading="lazy">
<p>选择-&gt;1建表脚本.sql</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3Rl8.png" class="" title="8x3Rl8.png" loading="lazy">
<p>4）重复步骤3的导入方式，依次导入：2商品分类数据插入脚本、3函数脚本、4存储过程脚本。</p>
<h3 id="5-1-2-生成业务数据"><a class="header-anchor" href="#5-1-2-生成业务数据">¶</a>5.1.2 生成业务数据</h3>
<p>1）生成业务数据函数说明</p>
<p>init_data ( do_date_string VARCHAR(20) , order_incr_num INT,<br>
user_incr_num INT , sku_num INT , if_truncate BOOLEAN )：</p>
<p>参数一：do_date_string生成数据日期</p>
<p>参数二：order_incr_num订单id个数</p>
<p>参数三：user_incr_num用户id个数</p>
<p>参数四：sku_num商品sku个数</p>
<p>参数五：if_truncate是否删除数据</p>
<p>2）案例测试：</p>
<p>（1）需求：生成日期2019年2月10日数据、订单1000个、用户200个、商品sku300个、删除原始数据。</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8x3z79.png" class="" title="8x3z79.png" loading="lazy">
<pre class="line-numbers language-none"><code class="language-none">CALL init_data(&#39;2019-02-10&#39;,1000,200,300,TRUE);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>（2）查询生成数据结果</p>
<pre class="line-numbers language-none"><code class="language-none">SELECT * from base_category1;
SELECT * from base_category2;
SELECT * from base_category3;

SELECT * from order_info;
SELECT * from order_detail;

SELECT * from sku_info;
SELECT * from user_info;

SELECT * from payment_info;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="5-2-业务数据导入数仓"><a class="header-anchor" href="#5-2-业务数据导入数仓">¶</a>5.2 业务数据导入数仓</h2>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/856Pot.png" class="" title="856Pot.png" loading="lazy">
<h3 id="5-2-1-Sqoop安装"><a class="header-anchor" href="#5-2-1-Sqoop安装">¶</a>5.2.1 Sqoop安装</h3>
<p>1）添加服务</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3r0yt.png" class="" title="G3r0yt.png" loading="lazy">
<p>2）选择Sqoop</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3rfln.png" class="" title="G3rfln.png" loading="lazy">
<p>目前选择sqoop1即可</p>
<p>3）选择节点</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3sA1A.png" class="" title="G3sA1A.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3rOp9.png" class="" title="G3rOp9.png" loading="lazy">
<h3 id="5-2-2-Sqoop定时导入脚本"><a class="header-anchor" href="#5-2-2-Sqoop定时导入脚本">¶</a>5.2.2 Sqoop定时导入脚本</h3>
<p>1）在/root/bin目录下创建脚本sqoop_import.sh</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim sqoop_import.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中填写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

db_date&#x3D;$2
echo $db_date
db_name&#x3D;gmall

import_data() &#123;
sqoop import \
--connect jdbc:mysql:&#x2F;&#x2F;hadoop102:3306&#x2F;$db_name \
--username root \
--password 000000 \
--target-dir  &#x2F;origin_data&#x2F;$db_name&#x2F;db&#x2F;$1&#x2F;$db_date \
--delete-target-dir \
--num-mappers 1 \
--fields-terminated-by &quot;\t&quot; \
--query &quot;$2&quot;&#39; and  $CONDITIONS;&#39;
&#125;

import_sku_info()&#123;
  import_data  &quot;sku_info&quot;  &quot;select 
id, spu_id, price, sku_name, sku_desc, weight, tm_id,
category3_id, create_time 
  from sku_info  where 1&#x3D;1&quot;
&#125;

import_user_info()&#123;
  import_data &quot;user_info&quot; &quot;select 
id, name, birthday, gender, email, user_level, 
create_time 
from user_info where 1&#x3D;1&quot;
&#125;

import_base_category1()&#123;
  import_data &quot;base_category1&quot; &quot;select 
id, name from base_category1 where 1&#x3D;1&quot;
&#125;

import_base_category2()&#123;
  import_data &quot;base_category2&quot; &quot;select 
id, name, category1_id from base_category2 where 1&#x3D;1&quot;
&#125;

import_base_category3()&#123;
  import_data &quot;base_category3&quot; &quot;select id, name, category2_id from base_category3 where 1&#x3D;1&quot;
&#125;

import_order_detail()&#123;
  import_data   &quot;order_detail&quot;   &quot;select 
    od.id, 
    order_id, 
    user_id, 
    sku_id, 
    sku_name, 
    order_price, 
    sku_num, 
    o.create_time  
  from order_info o , order_detail od 
  where o.id&#x3D;od.order_id 
  and DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;
&#125;

import_payment_info()&#123;
  import_data &quot;payment_info&quot;   &quot;select 
    id,  
    out_trade_no, 
    order_id, 
    user_id, 
    alipay_trade_no, 
    total_amount,  
    subject, 
    payment_type, 
    payment_time 
  from payment_info 
  where DATE_FORMAT(payment_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;&quot;
&#125;

import_order_info()&#123;
  import_data   &quot;order_info&quot;   &quot;select 
    id, 
    total_amount, 
    order_status, 
    user_id, 
    payment_way, 
    out_trade_no, 
    create_time, 
    operate_time  
  from order_info 
  where  (DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39; or DATE_FORMAT(operate_time,&#39;%Y-%m-%d&#39;)&#x3D;&#39;$db_date&#39;)&quot;
&#125;

case $1 in
  &quot;base_category1&quot;)
     import_base_category1
;;
  &quot;base_category2&quot;)
     import_base_category2
;;
  &quot;base_category3&quot;)
     import_base_category3
;;
  &quot;order_info&quot;)
     import_order_info
;;
  &quot;order_detail&quot;)
     import_order_detail
;;
  &quot;sku_info&quot;)
     import_sku_info
;;
  &quot;user_info&quot;)
     import_user_info
;;
  &quot;payment_info&quot;)
     import_payment_info
;;
   &quot;all&quot;)
   import_base_category1
   import_base_category2
   import_base_category3
   import_order_info
   import_order_detail
   import_sku_info
   import_user_info
   import_payment_info
;;
esac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 sqoop_import.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）执行脚本导入数据</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ sqoop_import.sh all 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="5-3-ODS层"><a class="header-anchor" href="#5-3-ODS层">¶</a>5.3 ODS层</h2>
<p>完全仿照业务数据库中的表字段，一模一样的创建ODS层对应表。</p>
<h3 id="5-3-1-创建订单表"><a class="header-anchor" href="#5-3-1-创建订单表">¶</a>5.3.1 创建订单表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ods_order_info;
create external table ods_order_info ( 
    &#96;id&#96; string COMMENT &#39;订单编号&#39;,
    &#96;total_amount&#96; decimal(10,2) COMMENT &#39;订单金额&#39;, 
    &#96;order_status&#96; string COMMENT &#39;订单状态&#39;, 
    &#96;user_id&#96; string COMMENT &#39;用户id&#39; ,
    &#96;payment_way&#96; string COMMENT &#39;支付方式&#39;,  
    &#96;out_trade_no&#96; string COMMENT &#39;支付流水号&#39;,  
    &#96;create_time&#96; string COMMENT &#39;创建时间&#39;,  
    &#96;operate_time&#96; string COMMENT &#39;操作时间&#39; 
) COMMENT &#39;订单表&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_order_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-2-创建订单详情表"><a class="header-anchor" href="#5-3-2-创建订单详情表">¶</a>5.3.2 创建订单详情表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ods_order_detail;
create external table ods_order_detail( 
    &#96;id&#96; string COMMENT &#39;订单编号&#39;,
    &#96;order_id&#96; string  COMMENT &#39;订单号&#39;, 
    &#96;user_id&#96; string COMMENT &#39;用户id&#39; ,
    &#96;sku_id&#96; string COMMENT &#39;商品id&#39;,  
    &#96;sku_name&#96; string COMMENT &#39;商品名称&#39;,  
    &#96;order_price&#96; string COMMENT &#39;商品价格&#39;,  
    &#96;sku_num&#96; string COMMENT &#39;商品数量&#39;,  
    &#96;create_time&#96; string COMMENT &#39;创建时间&#39;
) COMMENT &#39;订单明细表&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_order_detail&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-3-创建商品表"><a class="header-anchor" href="#5-3-3-创建商品表">¶</a>5.3.3 创建商品表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ods_sku_info;
create external table ods_sku_info( 
    &#96;id&#96; string COMMENT &#39;skuId&#39;,
    &#96;spu_id&#96; string   COMMENT &#39;spuid&#39;, 
    &#96;price&#96; decimal(10,2) COMMENT &#39;价格&#39; ,
    &#96;sku_name&#96; string COMMENT &#39;商品名称&#39;,  
    &#96;sku_desc&#96; string COMMENT &#39;商品描述&#39;,  
    &#96;weight&#96; string COMMENT &#39;重量&#39;,  
    &#96;tm_id&#96; string COMMENT &#39;品牌id&#39;,  
    &#96;category3_id&#96; string COMMENT &#39;品类id&#39;,  
    &#96;create_time&#96; string COMMENT &#39;创建时间&#39;
) COMMENT &#39;商品表&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_sku_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-4-创建用户表"><a class="header-anchor" href="#5-3-4-创建用户表">¶</a>5.3.4 创建用户表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ods_user_info;
create external table ods_user_info( 
    &#96;id&#96; string COMMENT &#39;用户id&#39;,
    &#96;name&#96;  string COMMENT &#39;姓名&#39;, 
    &#96;birthday&#96; string COMMENT &#39;生日&#39; ,
    &#96;gender&#96; string COMMENT &#39;性别&#39;,  
    &#96;email&#96; string COMMENT &#39;邮箱&#39;,  
    &#96;user_level&#96; string COMMENT &#39;用户等级&#39;,  
    &#96;create_time&#96; string COMMENT &#39;创建时间&#39;
) COMMENT &#39;用户信息&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_user_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-5-创建商品一级分类表"><a class="header-anchor" href="#5-3-5-创建商品一级分类表">¶</a>5.3.5 创建商品一级分类表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ods_base_category1;
create external table ods_base_category1( 
    &#96;id&#96; string COMMENT &#39;id&#39;,
    &#96;name&#96;  string COMMENT &#39;名称&#39;
) COMMENT &#39;商品一级分类&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_base_category1&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-6-创建商品二级分类表"><a class="header-anchor" href="#5-3-6-创建商品二级分类表">¶</a>5.3.6 创建商品二级分类表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ods_base_category2;
create external table ods_base_category2( 
    &#96;id&#96; string COMMENT &#39; id&#39;,
    &#96;name&#96;  string COMMENT &#39;名称&#39;,
    category1_id string COMMENT &#39;一级品类id&#39;
) COMMENT &#39;商品二级分类&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_base_category2&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-7-创建商品三级分类表"><a class="header-anchor" href="#5-3-7-创建商品三级分类表">¶</a>5.3.7 创建商品三级分类表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ods_base_category3;
create external table ods_base_category3( 
    &#96;id&#96; string COMMENT &#39; id&#39;,
    &#96;name&#96;  string COMMENT &#39;名称&#39;,
    category2_id string COMMENT &#39;二级品类id&#39;
) COMMENT &#39;商品三级分类&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_base_category3&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-8-创建支付流水表"><a class="header-anchor" href="#5-3-8-创建支付流水表">¶</a>5.3.8 创建支付流水表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists &#96;ods_payment_info&#96;;
create external table  &#96;ods_payment_info&#96;(
    &#96;id&#96;   bigint COMMENT &#39;编号&#39;,
    &#96;out_trade_no&#96;    string COMMENT &#39;对外业务编号&#39;,
    &#96;order_id&#96;        string COMMENT &#39;订单编号&#39;,
    &#96;user_id&#96;         string COMMENT &#39;用户编号&#39;,
    &#96;alipay_trade_no&#96; string COMMENT &#39;支付宝交易流水编号&#39;,
    &#96;total_amount&#96;    decimal(16,2) COMMENT &#39;支付金额&#39;,
    &#96;subject&#96;         string COMMENT &#39;交易内容&#39;,
    &#96;payment_type&#96; string COMMENT &#39;支付类型&#39;,
    &#96;payment_time&#96;   string COMMENT &#39;支付时间&#39;
   )  COMMENT &#39;支付流水表&#39;
PARTITIONED BY ( &#96;dt&#96; string)
row format delimited  fields terminated by &#39;\t&#39; 
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ods&#x2F;ods_payment_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-3-9-ODS层数据导入脚本"><a class="header-anchor" href="#5-3-9-ODS层数据导入脚本">¶</a>5.3.9 ODS层数据导入脚本</h3>
<p>1）在/root/bin目录下创建脚本ods_db.sh</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim ods_db.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中填写如下内容</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">#!&#x2F;bin&#x2F;bash

   APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
	do_date&#x3D;$1
else 
	do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;  
fi

sql&#x3D;&quot; 
load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;order_info&#x2F;$do_date&#39;  OVERWRITE into table &quot;$APP&quot;.ods_order_info partition(dt&#x3D;&#39;$do_date&#39;);

load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;order_detail&#x2F;$do_date&#39;  OVERWRITE into table &quot;$APP&quot;.ods_order_detail partition(dt&#x3D;&#39;$do_date&#39;);

load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;sku_info&#x2F;$do_date&#39;  OVERWRITE into table &quot;$APP&quot;.ods_sku_info partition(dt&#x3D;&#39;$do_date&#39;);

load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;user_info&#x2F;$do_date&#39; OVERWRITE into table &quot;$APP&quot;.ods_user_info partition(dt&#x3D;&#39;$do_date&#39;);

load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;payment_info&#x2F;$do_date&#39; OVERWRITE into table &quot;$APP&quot;.ods_payment_info partition(dt&#x3D;&#39;$do_date&#39;);

load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;base_category1&#x2F;$do_date&#39; OVERWRITE into table &quot;$APP&quot;.ods_base_category1 partition(dt&#x3D;&#39;$do_date&#39;);

load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;base_category2&#x2F;$do_date&#39; OVERWRITE into table &quot;$APP&quot;.ods_base_category2 partition(dt&#x3D;&#39;$do_date&#39;);

load data inpath &#39;&#x2F;origin_data&#x2F;$APP&#x2F;db&#x2F;base_category3&#x2F;$do_date&#39; OVERWRITE into table &quot;$APP&quot;.ods_base_category3 partition(dt&#x3D;&#39;$do_date&#39;); 
&quot;
hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 ods_db.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）采用脚本导入数据</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ ods_db.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="5-4-DWD层"><a class="header-anchor" href="#5-4-DWD层">¶</a>5.4 DWD层</h2>
<p>对ODS层数据进行判空过滤。对商品分类表进行维度退化(降维)。</p>
<h3 id="5-4-1-创建订单表"><a class="header-anchor" href="#5-4-1-创建订单表">¶</a>5.4.1 创建订单表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists dwd_order_info;
create external table dwd_order_info ( 
    &#96;id&#96; string COMMENT &#39;&#39;,
    &#96;total_amount&#96; decimal(10,2) COMMENT &#39;&#39;, 
    &#96;order_status&#96; string COMMENT &#39; 1  2  3  4  5&#39;, 
    &#96;user_id&#96; string COMMENT &#39;id&#39; ,
    &#96;payment_way&#96; string COMMENT &#39;&#39;,  
    &#96;out_trade_no&#96; string COMMENT &#39;&#39;,  
    &#96;create_time&#96; string COMMENT &#39;&#39;,  
    &#96;operate_time&#96; string COMMENT &#39;&#39; 
) 
PARTITIONED BY ( &#96;dt&#96; string)
stored as  parquet
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dwd&#x2F;dwd_order_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-4-2-创建订单详情表"><a class="header-anchor" href="#5-4-2-创建订单详情表">¶</a>5.4.2 创建订单详情表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists dwd_order_detail;
create external table dwd_order_detail( 
    &#96;id&#96; string COMMENT &#39;&#39;,
    &#96;order_id&#96; decimal(10,2) COMMENT &#39;&#39;, 
    &#96;user_id&#96; string COMMENT &#39;id&#39; ,
    &#96;sku_id&#96; string COMMENT &#39;id&#39;,  
    &#96;sku_name&#96; string COMMENT &#39;&#39;,  
    &#96;order_price&#96; string COMMENT &#39;&#39;,  
    &#96;sku_num&#96; string COMMENT &#39;&#39;, 
    &#96;create_time&#96; string COMMENT &#39;&#39;
) 
PARTITIONED BY (&#96;dt&#96; string)
stored as parquet
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dwd&#x2F;dwd_order_detail&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-4-3-创建用户表"><a class="header-anchor" href="#5-4-3-创建用户表">¶</a>5.4.3 创建用户表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists dwd_user_info;
create external table dwd_user_info( 
    &#96;id&#96; string COMMENT &#39;id&#39;,
    &#96;name&#96;  string COMMENT &#39;&#39;, 
    &#96;birthday&#96; string COMMENT &#39;&#39; ,
    &#96;gender&#96; string COMMENT &#39;&#39;,  
    &#96;email&#96; string COMMENT &#39;&#39;,  
    &#96;user_level&#96; string COMMENT &#39;&#39;,  
    &#96;create_time&#96; string COMMENT &#39;&#39;
) 
PARTITIONED BY (&#96;dt&#96; string)
stored as  parquet
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dwd&#x2F;dwd_user_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-4-4-创建支付流水表"><a class="header-anchor" href="#5-4-4-创建支付流水表">¶</a>5.4.4 创建支付流水表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists &#96;dwd_payment_info&#96;;
create external  table  &#96;dwd_payment_info&#96;(
    &#96;id&#96;   bigint COMMENT &#39;&#39;,
    &#96;out_trade_no&#96;    string COMMENT &#39;&#39;,
    &#96;order_id&#96;        string COMMENT &#39;&#39;,
    &#96;user_id&#96;         string COMMENT &#39;&#39;,
    &#96;alipay_trade_no&#96; string COMMENT &#39;&#39;,
    &#96;total_amount&#96;    decimal(16,2) COMMENT &#39;&#39;,
    &#96;subject&#96;         string COMMENT &#39;&#39;,
    &#96;payment_type&#96;    string COMMENT &#39;&#39;,
    &#96;payment_time&#96;    string COMMENT &#39;&#39;
   )  
PARTITIONED BY ( &#96;dt&#96; string)
stored as  parquet
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dwd&#x2F;dwd_payment_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-4-5-创建商品表（增加分类）"><a class="header-anchor" href="#5-4-5-创建商品表（增加分类）">¶</a>5.4.5 创建商品表（增加分类）</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8xGWZQ.png" class="" title="8xGWZQ.png" loading="lazy">
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists dwd_sku_info;
create external table dwd_sku_info( 
    &#96;id&#96; string COMMENT &#39;skuId&#39;,
    &#96;spu_id&#96; string COMMENT &#39;spuid&#39;, 
    &#96;price&#96; decimal(10,2) COMMENT &#39;&#39; ,
    &#96;sku_name&#96; string COMMENT &#39;&#39;,  
    &#96;sku_desc&#96; string COMMENT &#39;&#39;,  
    &#96;weight&#96; string COMMENT &#39;&#39;,  
    &#96;tm_id&#96; string COMMENT &#39;id&#39;,  
    &#96;category3_id&#96; string COMMENT &#39;1id&#39;,  
    &#96;category2_id&#96; string COMMENT &#39;2id&#39;,  
    &#96;category1_id&#96; string COMMENT &#39;3id&#39;,  
    &#96;category3_name&#96; string COMMENT &#39;3&#39;,  
    &#96;category2_name&#96; string COMMENT &#39;2&#39;,  
    &#96;category1_name&#96; string COMMENT &#39;1&#39;,  
    &#96;create_time&#96; string COMMENT &#39;&#39;
) 
PARTITIONED BY ( &#96;dt&#96; string)
stored as  parquet
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dwd&#x2F;dwd_sku_info&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-4-6-DWD层数据导入脚本"><a class="header-anchor" href="#5-4-6-DWD层数据导入脚本">¶</a>5.4.6 DWD层数据导入脚本</h3>
<p>1）在/root/bin目录下创建脚本dwd_db.sh</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim dwd_db.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中填写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

# 定义变量方便修改
APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
	do_date&#x3D;$1
else 
	do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;  
fi 

sql&#x3D;&quot;

set hive.exec.dynamic.partition.mode&#x3D;nonstrict;

insert overwrite table   &quot;$APP&quot;.dwd_order_info partition(dt)
select * from &quot;$APP&quot;.ods_order_info 
where dt&#x3D;&#39;$do_date&#39;  and id is not null;
 
insert overwrite table   &quot;$APP&quot;.dwd_order_detail partition(dt)
select * from &quot;$APP&quot;.ods_order_detail 
where dt&#x3D;&#39;$do_date&#39;   and id is not null;

insert overwrite table   &quot;$APP&quot;.dwd_user_info partition(dt)
select * from &quot;$APP&quot;.ods_user_info
where dt&#x3D;&#39;$do_date&#39;   and id is not null;
 
insert overwrite table   &quot;$APP&quot;.dwd_payment_info partition(dt)
select * from &quot;$APP&quot;.ods_payment_info
where dt&#x3D;&#39;$do_date&#39;  and id is not null;

insert overwrite table   &quot;$APP&quot;.dwd_sku_info partition(dt)
select  
    sku.id,
    sku.spu_id, 
    sku.price,
    sku.sku_name,  
    sku.sku_desc,  
    sku.weight,  
    sku.tm_id,  
    sku.category3_id,  
    c2.id category2_id ,  
    c1.id category1_id,  
    c3.name category3_name,  
    c2.name category2_name,  
    c1.name category1_name,  
    sku.create_time,
    sku.dt
from
    &quot;$APP&quot;.ods_sku_info sku 
join &quot;$APP&quot;.ods_base_category3 c3 on sku.category3_id&#x3D;c3.id 
    join &quot;$APP&quot;.ods_base_category2 c2 on c3.category2_id&#x3D;c2.id 
    join &quot;$APP&quot;.ods_base_category1 c1 on c2.category1_id&#x3D;c1.id 
where sku.dt&#x3D;&#39;$do_date&#39;  and c2.dt&#x3D;&#39;$do_date&#39;  
and  c3.dt&#x3D;&#39;$do_date&#39; and  c1.dt&#x3D;&#39;$do_date&#39; 
and sku.id is not null;

&quot;
hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 dwd_db.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）采用脚本导入数据</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ dwd_db.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="5-5-DWS层之用户行为宽表"><a class="header-anchor" href="#5-5-DWS层之用户行为宽表">¶</a>5.5 DWS层之用户行为宽表</h2>
<p>1）为什么要建宽表</p>
<p>需求目标，把每个用户单日的行为聚合起来组成一张多列宽表，以便之后关联用户维度信息后进行，不同角度的统计分析。</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/8xJRl6.png" class="" title="8xJRl6.png" loading="lazy">
<h3 id="5-5-1-创建用户行为宽表"><a class="header-anchor" href="#5-5-1-创建用户行为宽表">¶</a>5.5.1 创建用户行为宽表</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists dws_user_action;
create external table dws_user_action 
(   
    user_id          string      comment &#39;用户 id&#39;,
    order_count     bigint      comment &#39;下单次数 &#39;,
    order_amount    decimal(16,2)  comment &#39;下单金额 &#39;,
    payment_count   bigint      comment &#39;支付次数&#39;,
    payment_amount  decimal(16,2) comment &#39;支付金额 &#39;
) COMMENT &#39;每日用户行为宽表&#39;
PARTITIONED BY (&#96;dt&#96; string)
stored as parquet
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;dws&#x2F;dws_user_action&#x2F;&#39;
tblproperties (&quot;parquet.compression&quot;&#x3D;&quot;snappy&quot;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-5-2-用户行为数据宽表导入脚本"><a class="header-anchor" href="#5-5-2-用户行为数据宽表导入脚本">¶</a>5.5.2 用户行为数据宽表导入脚本</h3>
<p>1）在/root/bin目录下创建脚本dws_db_wide.sh</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim dws_db_wide.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中填写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

# 定义变量方便修改
APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
	do_date&#x3D;$1
else 
	do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;  
fi 

sql&#x3D;&quot;
with  
tmp_order as
(
    select 
        user_id, 
        count(*)  order_count,
        sum(oi.total_amount) order_amount
    from &quot;$APP&quot;.dwd_order_info oi
    where date_format(oi.create_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$do_date&#39;
    group by user_id
) ,
tmp_payment as
(
    select
        user_id, 
        sum(pi.total_amount) payment_amount, 
        count(*) payment_count 
    from &quot;$APP&quot;.dwd_payment_info pi 
    where date_format(pi.payment_time,&#39;yyyy-MM-dd&#39;)&#x3D;&#39;$do_date&#39;
    group by user_id
)
insert overwrite table &quot;$APP&quot;.dws_user_action partition(dt&#x3D;&#39;$do_date&#39;)
select
    user_actions.user_id,
    sum(user_actions.order_count),
    sum(user_actions.order_amount),
    sum(user_actions.payment_count),
    sum(user_actions.payment_amount)
from 
(
    select
        user_id,
        order_count,
        order_amount,
        0 payment_count,
        0 payment_amount
    from tmp_order

    union all
    select
        user_id,
        0 order_count,
        0 order_amount,
        payment_count,
        payment_amount
    from tmp_payment
 ) user_actions
group by user_id;
&quot;

hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 dws_db_wide.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ dws_db_wide.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="5-6-ADS层（需求：GMV成交总额）"><a class="header-anchor" href="#5-6-ADS层（需求：GMV成交总额）">¶</a>5.6 ADS层（需求：GMV成交总额）</h2>
<h3 id="5-6-1-建表语句"><a class="header-anchor" href="#5-6-1-建表语句">¶</a>5.6.1 建表语句</h3>
<pre class="line-numbers language-none"><code class="language-none">hive (gmall)&gt;
drop table if exists ads_gmv_sum_day;
create external table ads_gmv_sum_day(
    &#96;dt&#96; string COMMENT &#39;统计日期&#39;,
    &#96;gmv_count&#96;  bigint COMMENT &#39;当日gmv订单个数&#39;,
    &#96;gmv_amount&#96;  decimal(16,2) COMMENT &#39;当日gmv订单总金额&#39;,
    &#96;gmv_payment&#96;  decimal(16,2) COMMENT &#39;当日支付金额&#39;
) COMMENT &#39;GMV&#39;
row format delimited fields terminated by &#39;\t&#39;
location &#39;&#x2F;warehouse&#x2F;gmall&#x2F;ads&#x2F;ads_gmv_sum_day&#x2F;&#39;
;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-6-2-数据导入脚本"><a class="header-anchor" href="#5-6-2-数据导入脚本">¶</a>5.6.2 数据导入脚本</h3>
<p>1）在/root/bin目录下创建脚本ads_db_gmv.sh</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim ads_db_gmv.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中填写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

# 定义变量方便修改
APP&#x3D;gmall

# 如果是输入的日期按照取输入日期；如果没输入日期取当前时间的前一天
if [ -n &quot;$1&quot; ] ;then
	do_date&#x3D;$1
else 
	do_date&#x3D;&#96;date -d &quot;-1 day&quot; +%F&#96;
fi 

sql&#x3D;&quot;
insert into table &quot;$APP&quot;.ads_gmv_sum_day 
select 
    &#39;$do_date&#39; dt,
    sum(order_count)  gmv_count,
    sum(order_amount) gmv_amount,
    sum(payment_amount) payment_amount 
from &quot;$APP&quot;.dws_user_action 
where dt &#x3D;&#39;$do_date&#39;
group by dt;
&quot;

hive -e &quot;$sql&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 ads_db_gmv.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）执行脚本</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ ads_db_gmv.sh 2019-02-10<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="5-6-3-数据导出脚本"><a class="header-anchor" href="#5-6-3-数据导出脚本">¶</a>5.6.3 数据导出脚本</h3>
<p>1）在MySQL中创建ads_gmv_sum_day表</p>
<pre class="line-numbers language-none"><code class="language-none">DROP TABLE IF EXISTS ads_gmv_sum_day;
CREATE TABLE ads_gmv_sum_day(
  &#96;dt&#96; varchar(200) DEFAULT NULL COMMENT &#39;统计日期&#39;,
  &#96;gmv_count&#96; bigint(20) DEFAULT NULL COMMENT &#39;当日gmv订单个数&#39;,
  &#96;gmv_amount&#96; decimal(16, 2) DEFAULT NULL COMMENT &#39;当日gmv订单总金额&#39;,
  &#96;gmv_payment&#96; decimal(16, 2) DEFAULT NULL COMMENT &#39;当日支付金额&#39;
) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci COMMENT &#x3D; &#39;每日活跃用户数量&#39; ROW_FORMAT &#x3D; Dynamic;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）在/root/bin目录下创建脚本sqoop_export.sh</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ vim sqoop_export.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在脚本中填写如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

db_name&#x3D;gmall

export_data() &#123;
sqoop export \
--connect &quot;jdbc:mysql:&#x2F;&#x2F;hadoop102:3306&#x2F;$&#123;db_name&#125;?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&quot;  \
--username root \
--password 000000 \
--table $1 \
--num-mappers 1 \
--export-dir &#x2F;warehouse&#x2F;$db_name&#x2F;ads&#x2F;$1 \
--input-fields-terminated-by &quot;\t&quot; \
--update-mode allowinsert \
--update-key &quot;tm_id,category1_id,stat_mn,stat_date&quot; \
--input-null-string &#39;\\N&#39;    \
--input-null-non-string &#39;\\N&#39;
&#125;

case $1 in
  &quot;ads_gmv_sum_day&quot;)
     export_data &quot;ads_gmv_sum_day&quot;
;;
   &quot;all&quot;)
     export_data &quot;ads_gmv_sum_day&quot;
;;
esac<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3）增加脚本执行权限</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ chmod 777 sqoop_export.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>4）执行脚本导入数据</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]$ sqoop_export.sh all <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>5）在SQLyog查看导出数据</p>
<pre class="line-numbers language-none"><code class="language-none">select * from ads_gmv_sum_day <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="5-7-Oozie基于Hue实现GMV指标全流程调度"><a class="header-anchor" href="#5-7-Oozie基于Hue实现GMV指标全流程调度">¶</a>5.7 Oozie基于Hue实现GMV指标全流程调度</h2>
<h3 id="5-7-1-执行前的准备"><a class="header-anchor" href="#5-7-1-执行前的准备">¶</a>5.7.1 执行前的准备</h3>
<p>1）添加MySQL驱动文件</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 ~]# cp &#x2F;opt&#x2F;software&#x2F;mysql-libs&#x2F;mysql-connector-java-5.1.27&#x2F;mysql-connector-java-5.1.27-bin.jar &#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-5.12.1-1.cdh5.12.1.p0.3&#x2F;lib&#x2F;hadoop&#x2F;lib

[root@hadoop102 ~]# cp &#x2F;opt&#x2F;software&#x2F;mysql-libs&#x2F;mysql-connector-java-5.1.27&#x2F;mysql-connector-java-5.1.27-bin.jar &#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-5.12.1-1.cdh5.12.1.p0.3&#x2F;lib&#x2F;sqoop&#x2F;lib&#x2F;

[root@hadoop102 mysql-connector-java-5.1.27]# hadoop fs -put &#x2F;opt&#x2F;software&#x2F;mysql-libs&#x2F;mysql-connector-java-5.1.27&#x2F;mysql-connector-java-5.1.27-bin.jar &#x2F;user&#x2F;oozie&#x2F;share&#x2F;lib&#x2F;lib_20190603220831&#x2F;sqoop

[root@hadoop102 mysql-connector-java-5.1.27]# xsync &#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-5.12.1-1.cdh5.12.1.p0.3&#x2F;lib&#x2F;hadoop&#x2F;lib

[root@hadoop102 mysql-connector-java-5.1.27]#  xsync &#x2F;opt&#x2F;cloudera&#x2F;parcels&#x2F;CDH-5.12.1-1.cdh5.12.1.p0.3&#x2F;lib&#x2F;sqoop&#x2F;lib&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）修改YARN的容器内存yarn.nodemanager.resource.memory-mb为4G</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G36h6A.png" class="" title="G36h6A.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G36Imt.png" class="" title="G36Imt.png" loading="lazy">
<p>5）新建一个Hue账户</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cPtU.png" class="" title="G3cPtU.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cA1J.png" class="" title="G3cA1J.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cen1.png" class="" title="G3cen1.png" loading="lazy">
<p>6）切换用户</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cm0x.png" class="" title="G3cm0x.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cMtO.png" class="" title="G3cMtO.png" loading="lazy">
<h3 id="5-7-2-在Hue中创建Oozie任务GMV"><a class="header-anchor" href="#5-7-2-在Hue中创建Oozie任务GMV">¶</a>5.7.2 在Hue中创建Oozie任务GMV</h3>
<p>1）生成数据</p>
<pre class="line-numbers language-none"><code class="language-none">CALL init_data(&#39;2019-02-12&#39;,300,200,300,FALSE);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>2）安装Oozie可视化js，复制ext-2.2.zip到/opt/cloudera/parcels/CDH/lib/oozie/libext(或/var/lib/oozie)中，解压</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 libext]# unzip ext-2.2.zip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）查看Hue的web页面</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3cGjA.png" class="" title="G3cGjA.png" loading="lazy">
<p>4）选择query-&gt;scheduler-&gt;workflow</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fPSS.png" class="" title="G3fPSS.png" loading="lazy">
<p>5）点击My Workflow-&gt;输入gmv</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fVwn.png" class="" title="G3fVwn.png" loading="lazy">
<p>6）点击保存</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3f8m9.png" class="" title="G3f8m9.png" loading="lazy">
<h3 id="5-7-3-编写任务脚本并上传到HDFS"><a class="header-anchor" href="#5-7-3-编写任务脚本并上传到HDFS">¶</a>5.7.3 编写任务脚本并上传到HDFS</h3>
<p>1）点击workspace，查看上传情况</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fNY6.png" class="" title="G3fNY6.png" loading="lazy">
<p>2）上传要执行的脚本导HDFS路径</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop102 bin]# hadoop fs -put &#x2F;root&#x2F;bin&#x2F;*.sh &#x2F;user&#x2F;hue&#x2F;oozie&#x2F;workspaces&#x2F;hue-oozie-1559457755.83&#x2F;lib<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）点击左侧的<img src="https://s1.ax1x.com/2020/04/01/G3fckt.png" alt="G3fckt.png" loading="lazy">-&gt;Documents-&gt;gmv</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fT7n.png" class="" title="G3fT7n.png" loading="lazy">
<h3 id="5-7-4-编写任务调度"><a class="header-anchor" href="#5-7-4-编写任务调度">¶</a>5.7.4 编写任务调度</h3>
<p>1）点击编辑</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3fvX4.png" class="" title="G3fvX4.png" loading="lazy">
<p>2）选择actions</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3hmBd.png" class="" title="G3hmBd.png" loading="lazy">
<p>3）拖拽控件编写任务</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3h8gS.png" class="" title="G3h8gS.png" loading="lazy">
<p>4）选择执行脚本</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3hNHs.png" class="" title="G3hNHs.png" loading="lazy">
<p>5）Files再选择执行脚本</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3haEn.png" class="" title="G3haEn.png" loading="lazy">
<p>6）定义脚本参数名称</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3hIgO.png" class="" title="G3hIgO.png" loading="lazy">
<p>7）按顺序执行3-6步骤。</p>
<p>ods_db.sh、dwd_db.sh、dws_db_wide.sh、ads_db_gmv.sh和sqoop_export.sh</p>
<p>其中ods_db.sh、dwd_db.sh、dws_db_wide.sh、ads_db_gmv.sh只有一个参数do_date；</p>
<p>sqoop_export.sh只有一个参数all。</p>
<p>8）点击保存</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G34lZ9.png" class="" title="G34lZ9.png" loading="lazy">
<h3 id="5-7-5-执行任务调度"><a class="header-anchor" href="#5-7-5-执行任务调度">¶</a>5.7.5 执行任务调度</h3>
<p>1）点击执行</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G34YRK.png" class="" title="G34YRK.png" loading="lazy">
<p>2）点击提交</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G34cz8.png" class="" title="G34cz8.png" loading="lazy">
<h1>第6章 即席查询数仓搭建</h1>
<h2 id="6-1-Impala安装"><a class="header-anchor" href="#6-1-Impala安装">¶</a>6.1 Impala安装</h2>
<h3 id="6-1-1-添加服务"><a class="header-anchor" href="#6-1-1-添加服务">¶</a>6.1.1 添加服务</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G35h6O.png" class="" title="G35h6O.png" loading="lazy">
<h3 id="6-1-2-选择Impala服务"><a class="header-anchor" href="#6-1-2-选择Impala服务">¶</a>6.1.2 选择Impala服务</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3IHrF.png" class="" title="G3IHrF.png" loading="lazy">
<h3 id="6-1-3-角色分配"><a class="header-anchor" href="#6-1-3-角色分配">¶</a>6.1.3 角色分配</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3oKsS.png" class="" title="G3oKsS.png" loading="lazy">
<blockquote>
<p>注意：最好将StateStore和CataLog Sever单独部署在同一节点上。</p>
</blockquote>
<h3 id="6-1-4-配置Impala"><a class="header-anchor" href="#6-1-4-配置Impala">¶</a>6.1.4 配置Impala</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3o1aj.png" class="" title="G3o1aj.png" loading="lazy">
<h3 id="6-1-5-启动Impala"><a class="header-anchor" href="#6-1-5-启动Impala">¶</a>6.1.5 启动Impala</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3odLF.png" class="" title="G3odLF.png" loading="lazy">
<h3 id="6-1-6-安装成功"><a class="header-anchor" href="#6-1-6-安装成功">¶</a>6.1.6 安装成功</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3osiR.png" class="" title="G3osiR.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/G3oWLD.png" class="" title="G3oWLD.png" loading="lazy">
<h3 id="6-1-7-配置Hue支持Impala"><a class="header-anchor" href="#6-1-7-配置Hue支持Impala">¶</a>6.1.7 配置Hue支持Impala</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GD8jHI.png" class="" title="GD8jHI.png" loading="lazy">
<h2 id="6-2-Impala基于Hue查询"><a class="header-anchor" href="#6-2-Impala基于Hue查询">¶</a>6.2 Impala基于Hue查询</h2>
<h1>第7章 Spark2.1安装</h1>
<p>在CDH5.12.1集群中，默认安装的Spark是1.6版本，这里需要将其升级为Spark2.1版本。经查阅官方文档，发现Spark1.6和2.x是可以并行安装的，也就是说可以不用删除默认的1.6版本，可以直接安装2.x版本，它们各自用的端口也是不一样的。</p>
<p>Cloudera发布Apache Spark 2概述(可以在这里面找到安装方法和parcel包的仓库)</p>
<p>cloudera的官网可以下载相关的parcel<br>
的离线安装包：<a target="_blank" rel="noopener" href="https://www.cloudera.com/documentation/spark2/latest/topics/spark2_installing.html">https://www.cloudera.com/documentation/spark2/latest/topics/spark2_installing.html</a></p>
<p>Cloudera<br>
Manager及5.12.0版本的介绍：</p>
<p><a href="#cmug_topic_7_11_5__section">https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_parcels.html#cmug_topic_7_11_5__section</a></p>
<h2 id="7-1-升级过程"><a class="header-anchor" href="#7-1-升级过程">¶</a>7.1 升级过程</h2>
<h3 id="7-1-1-离线包下载"><a class="header-anchor" href="#7-1-1-离线包下载">¶</a>7.1.1 离线包下载</h3>
<p>1）所需软件：<a target="_blank" rel="noopener" href="http://archive.cloudera.com/spark2/csd/">http://archive.cloudera.com/spark2/csd/</a></p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDGuCT.png" class="" title="GDGuCT.png" loading="lazy">
<p>2）Parcels<br>
包的下载地址：<a target="_blank" rel="noopener" href="http://archive.cloudera.com/spark2/parcels/2.2.0.cloudera1/">http://archive.cloudera.com/spark2/parcels/2.2.0.cloudera1/</a></p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDGBKH.png" class="" title="GDGBKH.png" loading="lazy">
<h3 id="7-1-2-离线包上传"><a class="header-anchor" href="#7-1-2-离线包上传">¶</a>7.1.2 离线包上传</h3>
<p>1）上传文件SPARK2_ON_YARN-2.1.0.cloudera1.jar到<code>/opt/cloudera/csd/</code>下面</p>
<p>2）上传文件<code>SPARK2-2.1.0.cloudera1-1.cdh5.7.0.p0.120904-el6.parcel</code>和<code>SPARK2-2.1.0.cloudera1-1.cdh5.7.0.p0.120904-el6.parcel.sha1</code><br>
到<code>/opt/cloudera/parcel-repo/</code></p>
<p>3）将<code>SPARK2-2.1.0.cloudera1-1.cdh5.7.0.p0.120904-el6.parcel.sha1</code>重命名为<code>SPARK2-2.1.0.cloudera1-1.cdh5.7.0.p0.120904-el6.parcel.sha</code></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 parcel-repo]# mv &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo&#x2F;SPARK2-2.1.0.cloudera1-1.cdh5.7.0.p0.120904-el6.parcel.sha1 &#x2F;opt&#x2F;cloudera&#x2F;parcel-repo&#x2F;SPARK2-2.1.0.cloudera1-1.cdh5.7.0.p0.120904-el6.parcel.sha<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="7-2-页面操作"><a class="header-anchor" href="#7-2-页面操作">¶</a>7.2 页面操作</h2>
<h3 id="7-2-1-更新Parcel"><a class="header-anchor" href="#7-2-1-更新Parcel">¶</a>7.2.1 更新Parcel</h3>
<p>在cm首页点击Parcel，再点击检查新Parcel</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDG5rj.png" class="" title="GDG5rj.png" loading="lazy">
<h3 id="7-2-2-点击分配"><a class="header-anchor" href="#7-2-2-点击分配">¶</a>7.2.2 点击分配</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDGvM4.png" class="" title="GDGvM4.png" loading="lazy">
<h3 id="7-2-3-点击激活"><a class="header-anchor" href="#7-2-3-点击激活">¶</a>7.2.3 点击激活</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJFJK.png" class="" title="GDJFJK.png" loading="lazy">
<h3 id="7-2-4-回到首页点击添加服务"><a class="header-anchor" href="#7-2-4-回到首页点击添加服务">¶</a>7.2.4 回到首页点击添加服务</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJneA.png" class="" title="GDJneA.png" loading="lazy">
<h3 id="7-2-5-点击Spark2继续"><a class="header-anchor" href="#7-2-5-点击Spark2继续">¶</a>7.2.5 点击Spark2继续</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJlJf.png" class="" title="GDJlJf.png" loading="lazy">
<h3 id="7-2-6-选择一组依赖关系"><a class="header-anchor" href="#7-2-6-选择一组依赖关系">¶</a>7.2.6 选择一组依赖关系</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJJyQ.png" class="" title="GDJJyQ.png" loading="lazy">
<h3 id="7-2-7-角色分配"><a class="header-anchor" href="#7-2-7-角色分配">¶</a>7.2.7 角色分配</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJwF0.png" class="" title="GDJwF0.png" loading="lazy">
<h3 id="7-2-8-部署并启动"><a class="header-anchor" href="#7-2-8-部署并启动">¶</a>7.2.8 部署并启动</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJrSU.png" class="" title="GDJrSU.png" loading="lazy">
<p>注意：这里我报了一个错：客户端配置 (id=12) 已使用 1 退出，而预期值为 0</p>
<p>1）问题原因：最后找到原因是因为CM安装Spark不会去环境变量去找Java，需要将Java路径添加到CM配置文件</p>
<p>2）解决方法1（需要重启cdh）：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop102 java]# vim &#x2F;opt&#x2F;module&#x2F;cm&#x2F;cm-5.12.1&#x2F;lib64&#x2F;cmf&#x2F;service&#x2F;client&#x2F;deploy-cc.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>在文件最后加上</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">JAVA_HOME&#x3D; &#x2F;opt&#x2F;module&#x2F;jdk1.8.0_144
export JAVA_HOME&#x3D; &#x2F;opt&#x2F;module&#x2F;jdk1.8.0_144<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>3）解决方法2（无需重启cdh）：</p>
<p>查看<code>/opt/module/cm/cm-5.12.1/lib64/cmf/service/common/cloudera-config.sh</code></p>
<p>找到java8的home目录</p>
 <img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJ4fK.png" class="" title="GDJ4fK.png" loading="lazy">
<p>cdh不会使用系统默认的JAVA_HOME环境变量，而是依照bigtop进行管理，因此我们需要在指定的/usr/java/jdk1.8目录下安装jdk。当然我们已经在/opt/module/jdk1.8.0_144下安装了jdk，因此创建一个连接过去即可</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"> [root@hadoop102 ~]# ln -s &#x2F;opt&#x2F;module&#x2F;jdk1.8.0_144&#x2F; &#x2F;usr&#x2F;java&#x2F;jdk1.8
 [root@hadoop103 ~]# ln -s &#x2F;opt&#x2F;module&#x2F;jdk1.8.0_144&#x2F; &#x2F;usr&#x2F;java&#x2F;jdk1.8
[root@hadoop104 ~]# ln -s &#x2F;opt&#x2F;module&#x2F;jdk1.8.0_144&#x2F; &#x2F;usr&#x2F;java&#x2F;jdk1.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDJLTI.png" class="" title="GDJLTI.png" loading="lazy">
<p>3）解决方法3(需要重启cdh)：</p>
<p>找到hadoop102、hadoop103、hadoop104三台机器的配置，配置java主目录</p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYAkq.png" class="" title="GDYAkq.png" loading="lazy">
<h3 id="7-2-9-命令行查看命令"><a class="header-anchor" href="#7-2-9-命令行查看命令">¶</a>7.2.9 命令行查看命令</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYm1U.png" class="" title="GDYm1U.png" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYuX4.png" class="" title="GDYuX4.png" loading="lazy">
<h1>第8章 Sentry安装</h1>
<h2 id="8-1-Sentry安装部署"><a class="header-anchor" href="#8-1-Sentry安装部署">¶</a>8.1 Sentry安装部署</h2>
<h3 id="8-1-1-添加Sentry服务"><a class="header-anchor" href="#8-1-1-添加Sentry服务">¶</a>8.1.1 添加Sentry服务</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDY3A1.png" class="" title="GDY3A1.png" loading="lazy">
<h3 id="8-1-2-选择添加到集群"><a class="header-anchor" href="#8-1-2-选择添加到集群">¶</a>8.1.2 选择添加到集群</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYY9K.png" class="" title="GDYY9K.png" loading="lazy">
<h3 id="8-1-3-自定义Sentry角色分配"><a class="header-anchor" href="#8-1-3-自定义Sentry角色分配">¶</a>8.1.3 自定义Sentry角色分配</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDY0HA.png" class="" title="GDY0HA.png" loading="lazy">
<h3 id="8-1-4-Mysql中创建Sentry库"><a class="header-anchor" href="#8-1-4-Mysql中创建Sentry库">¶</a>8.1.4 Mysql中创建Sentry库</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYs4P.png" class="" title="GDYs4P.png" loading="lazy">
<h3 id="8-1-5-配置数据库连接"><a class="header-anchor" href="#8-1-5-配置数据库连接">¶</a>8.1.5 配置数据库连接</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDYWuQ.png" class="" title="GDYWuQ.png" loading="lazy">
<h3 id="8-1-6-成功完成Sentry的服务添加"><a class="header-anchor" href="#8-1-6-成功完成Sentry的服务添加">¶</a>8.1.6 成功完成Sentry的服务添加</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDY5En.png" class="" title="GDY5En.png" loading="lazy">
<h2 id="8-2-Sentry与Hive集成使用"><a class="header-anchor" href="#8-2-Sentry与Hive集成使用">¶</a>8.2 Sentry与Hive集成使用</h2>
<h3 id="8-2-1-Hive的配置中需要配置以下参数"><a class="header-anchor" href="#8-2-1-Hive的配置中需要配置以下参数">¶</a>8.2.1 Hive的配置中需要配置以下参数</h3>
<p>设置<code>sentry.hive.testing.mode</code> 为<code>true</code></p>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtS4x.png" class="" title="GDtS4x.png" loading="lazy">
<h3 id="8-2-2-配置Hive使用Sentry服务"><a class="header-anchor" href="#8-2-2-配置Hive使用Sentry服务">¶</a>8.2.2 配置Hive使用Sentry服务</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtC8K.png" class="" title="GDtC8K.png" loading="lazy">
<h3 id="8-2-3-关闭Hive的用户模拟功能"><a class="header-anchor" href="#8-2-3-关闭Hive的用户模拟功能">¶</a>8.2.3 关闭Hive的用户模拟功能</h3>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtYan.png" class="" title="GDtYan.png" loading="lazy">
<h2 id="8-3-Sentry与Hive的使用"><a class="header-anchor" href="#8-3-Sentry与Hive的使用">¶</a>8.3 Sentry与Hive的使用</h2>
<h3 id="8-3-1-使用beeline连接HiveServer2，并登录hive用户"><a class="header-anchor" href="#8-3-1-使用beeline连接HiveServer2，并登录hive用户">¶</a>8.3.1 使用beeline连接HiveServer2，并登录hive用户</h3>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop104 init.d]# beeline
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;512M; support was removed in 8.0
Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize&#x3D;512M; support was removed in 8.0
Beeline version 1.1.0-cdh5.12.1 by Apache Hive
beeline&gt; ! connect jdbc:hive2:&#x2F;&#x2F;hadoop104:10000
scan complete in 484ms
Connecting to jdbc:hive2:&#x2F;&#x2F;hadoop104:10000
Enter username for jdbc:hive2:&#x2F;&#x2F;hadoop104:10000: hive
Enter password for jdbc:hive2:&#x2F;&#x2F;hadoop104:10000: （直接回车）
Connected to: Apache Hive (version 1.1.0-cdh5.12.1)
Driver: Hive JDBC (version 1.1.0-cdh5.12.1)
Transaction isolation: TRANSACTION_REPEATABLE_READ
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtd2T.png" class="" title="GDtd2T.png" loading="lazy">
<p>注意：标红部分为输入的hive用户，输入的hive用户并未真正的校验。</p>
<h3 id="8-3-2-创建一个admin角色"><a class="header-anchor" href="#8-3-2-创建一个admin角色">¶</a>8.3.2 创建一个admin角色</h3>
<pre class="line-numbers language-none"><code class="language-none">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; create role admin;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtrqJ.png" class="" title="GDtrqJ.png" loading="lazy">
<h3 id="8-3-3-为admin角色赋予超级权限"><a class="header-anchor" href="#8-3-3-为admin角色赋予超级权限">¶</a>8.3.3 为admin角色赋予超级权限</h3>
<pre class="line-numbers language-none"><code class="language-none">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; grant all on server server1 to role admin;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtWRK.png" class="" title="GDtWRK.png" loading="lazy">
<h3 id="8-3-4-将admin角色授权给hive用户组"><a class="header-anchor" href="#8-3-4-将admin角色授权给hive用户组">¶</a>8.3.4 将admin角色授权给hive用户组</h3>
<pre class="line-numbers language-none"><code class="language-none">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; grant role admin to group hive;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDt5se.png" class="" title="GDt5se.png" loading="lazy">
<h3 id="8-3-5-创建test表"><a class="header-anchor" href="#8-3-5-创建test表">¶</a>8.3.5 创建test表</h3>
<p>使用beeline登录hive用户，创建一个test表，并插入测试数据</p>
<pre class="line-numbers language-none"><code class="language-none">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt;  create table test (s1 string, s2 string) row format delimited fields terminated by &#39;,&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/GDtHII.png" class="" title="GDtHII.png" loading="lazy">
<pre class="line-numbers language-none"><code class="language-none">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; insert into test values(&#39;a&#39;,&#39;b&#39;),(&#39;1&#39;,&#39;2&#39;);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172715465.png" class="" title="image-20200405172715465" loading="lazy">
<h3 id="8-3-6-创建测试角色并授权给用户组"><a class="header-anchor" href="#8-3-6-创建测试角色并授权给用户组">¶</a>8.3.6 创建测试角色并授权给用户组</h3>
<p>创建两个角色：</p>
<p>read：只能读default库test表，并授权给user_r用户组</p>
<p>write：只能写default库test表，并授权给user_w用户组</p>
<p>注意：集群所有节点必须存在user_r和user_w用户，用户默认用户组与用户名一致，赋权是针对用户组而不是针对用户。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[root@hadoop104 ~]# useradd user_r
[root@hadoop104 ~]# id user_r
uid&#x3D;502(user_r) gid&#x3D;503(user_r) 组&#x3D;503(user_r)
[root@hadoop104 ~]# useradd user_w
[root@hadoop104 ~]# id user_w
uid&#x3D;503(user_w) gid&#x3D;504(user_w) 组&#x3D;504(user_w)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="8-3-7-使用hive用户创建创建read和write角色，并授权read角色对test表select权限，write角色对test表insert权限"><a class="header-anchor" href="#8-3-7-使用hive用户创建创建read和write角色，并授权read角色对test表select权限，write角色对test表insert权限">¶</a>8.3.7 使用hive用户创建创建read和write角色，并授权read角色对test表select权限，write角色对test表insert权限</h3>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; create role read;

0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; grant select on table test to role read;

0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; create role write;

0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; grant insert on table test to role write;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172841694.png" class="" title="image-20200405172841694" loading="lazy">
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172900987.png" class="" title="image-20200405172900987" loading="lazy">
<h3 id="8-3-8-为user-r用户组授权read角色，为user-w用户组授权write角色"><a class="header-anchor" href="#8-3-8-为user-r用户组授权read角色，为user-w用户组授权write角色">¶</a>8.3.8 为user_r用户组授权read角色，为user_w用户组授权write角色</h3>
<pre class="line-numbers language-none"><code class="language-none">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; grant role read to group user_r;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405172938793.png" class="" title="image-20200405172938793" loading="lazy">
<pre class="line-numbers language-none"><code class="language-none">0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; grant role write to group user_w;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405173004332.png" class="" title="image-20200405173004332" loading="lazy">
<h3 id="8-3-9-beeline验证"><a class="header-anchor" href="#8-3-9-beeline验证">¶</a>8.3.9 beeline验证</h3>
<p>1.使用user_r用户登录beeline进行验证</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop104 init.d]# beeline
beeline&gt; ! connect jdbc:hive2:&#x2F;&#x2F;hadoop104:10000
scan complete in 4ms
Connecting to jdbc:hive2:&#x2F;&#x2F;hadoop104:10000
Enter username for jdbc:hive2:&#x2F;&#x2F;hadoop104:10000: user_r
Enter password for jdbc:hive2:&#x2F;&#x2F;hadoop104:10000: (直接回车)
Connected to: Apache Hive (version 1.1.0-cdh5.12.1)
Driver: Hive JDBC (version 1.1.0-cdh5.12.1)
Transaction isolation: TRANSACTION_REPEATABLE_READ
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; show tables;
INFO  : OK
+-----------+--+
| tab_name  |
+-----------+--+
| test      |
+-----------+--+
1 row selected (0.649 seconds)
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt;  select * from test;
INFO  : OK
+----------+----------+--+
| test.s1  | test.s2  |
+----------+----------+--+
| a        | b        |
| 1        | 2        |
+----------+----------+--+
2 rows selected (0.485 seconds)
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; insert into test values(&quot;2&quot;, &quot;222&quot;);
Error: Error while compiling statement: FAILED: SemanticException No valid privileges
 User user_r does not have privileges for QUERY
 The required privileges: Server&#x3D;server1-&gt;Db&#x3D;default-&gt;Table&#x3D;test-&gt;action&#x3D;insert; (state&#x3D;42000,code&#x3D;40000)
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405173050828.png" class="" title="image-20200405173050828" loading="lazy">
<p>2.使用user_w用户登录beeline验证</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop104 init.d]# beeline
beeline&gt; ! connect jdbc:hive2:&#x2F;&#x2F;hadoop104:10000
Connecting to jdbc:hive2:&#x2F;&#x2F;hadoop104:10000
Enter username for jdbc:hive2:&#x2F;&#x2F;hadoop104:10000: user_w
Enter password for jdbc:hive2:&#x2F;&#x2F;hadoop104:10000: 
Connected to: Apache Hive (version 1.1.0-cdh5.12.1)
Driver: Hive JDBC (version 1.1.0-cdh5.12.1)
Transaction isolation: TRANSACTION_REPEATABLE_READ
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; select  * from test;
Error: Error while compiling statement: FAILED: SemanticException No valid privileges
 User user_w does not have privileges for QUERY
 The required privileges: Server&#x3D;server1-&gt;Db&#x3D;default-&gt;Table&#x3D;test-&gt;Column&#x3D;s1-&gt;action&#x3D;select; (state&#x3D;42000,code&#x3D;40000)
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt; insert into test values(&quot;2&quot;, &quot;333&quot;);
…..
INFO  : Total MapReduce CPU Time Spent: 20 seconds 30 msec
INFO  : Completed executing command(queryId&#x3D;hive_20190603173535_88f71295-e612-4b45-bff7-df1fc4310a54); Time taken: 58.184 seconds
INFO  : OK
No rows affected (59.17 seconds)
0: jdbc:hive2:&#x2F;&#x2F;hadoop104:10000&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/image-20200405173128800.png" class="" title="image-20200405173128800" loading="lazy">
<p>验证总结：</p>
<p>user_r用户所属组为user_r拥有test表读权限，所以只能对test表进行selecth和count操作不能进行insert操作；</p>
<p>user_w用户所属组为user_w拥有test表写权限，所以只能对test表进行insert操作不能进行select和count操作；</p>
<h2 id="8-4-Kerberos在企业中的作用"><a class="header-anchor" href="#8-4-Kerberos在企业中的作用">¶</a>8.4 Kerberos在企业中的作用</h2>
<p>CDH平台中的安全，认证（Kerberos/LDAP）是第一步，授权（Sentry）是第二步。如果要启用授权，必须先启用认证。但在CDH平台中给出了一种测试模式，即不启用认证而只启用Sentry授权。但强烈不建议在生产系统中这样使用，因为如果没有用户认证，授权没有任何意义形同虚设，用户可以随意使用任何超级用户登录HiveServer2或者Impala，并不会做密码校验。注：本文档仅适用于测试环境。</p>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>momo</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/" title="5CDH版数仓采集">https://ppxiaodi.github.io/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%885CDH%E7%89%88%E6%95%B0%E4%BB%93%E9%87%87%E9%9B%86%EF%BC%89/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/12/12/CollectionNote/big/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%882%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%EF%BC%89/" rel="prev" title="2用户行为数据仓库"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">2用户行为数据仓库</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/12/11/CollectionNote/git/Git%20%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%90%8D%E4%BB%A5%E5%8F%8A%E6%8F%90%E4%BA%A4%E9%82%AE%E7%AE%B1/" rel="next" title="修改用户名以及提交邮箱"><span class="post-nav-text">修改用户名以及提交邮箱</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> momo</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.7.0</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div></div></body></html>