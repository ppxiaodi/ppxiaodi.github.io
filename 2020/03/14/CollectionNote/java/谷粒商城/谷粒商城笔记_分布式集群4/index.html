<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="momo"><meta name="copyright" content="momo"><meta name="generator" content="Hexo 5.2.0"><meta name="theme" content="hexo-theme-yun"><title>谷粒商城笔记_分布式集群4 | 我的笔记</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"ppxiaodi.github.io","root":"/","title":"momo的小站","version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="谷粒商城笔记_分布式集群4  本文由 简悦 SimpRead 转码， 原文地址 blog.csdn.net    个人笔记 (新手级细节教程)： https:&#x2F;&#x2F;blog.csdn.net&#x2F;hancoder&#x2F;article&#x2F;details&#x2F;106922139   官方笔记 - 基础篇：https:&#x2F;&#x2F;blog.csdn.net&#x2F;hancoder&#x2F;article&#x2F;details&#x2F;107612619">
<meta property="og:type" content="article">
<meta property="og:title" content="谷粒商城笔记_分布式集群4">
<meta property="og:url" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/index.html">
<meta property="og:site_name" content="我的笔记">
<meta property="og:description" content="谷粒商城笔记_分布式集群4  本文由 简悦 SimpRead 转码， 原文地址 blog.csdn.net    个人笔记 (新手级细节教程)： https:&#x2F;&#x2F;blog.csdn.net&#x2F;hancoder&#x2F;article&#x2F;details&#x2F;106922139   官方笔记 - 基础篇：https:&#x2F;&#x2F;blog.csdn.net&#x2F;hancoder&#x2F;article&#x2F;details&#x2F;107612619">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9kMzN3dWJyZmtpMGw2OC5jbG91ZGZyb250Lm5ldC8yNmExNzdlZGU0ZDdiMDMyMzYyMjg5YzZmY2NkNDQ4ZmM0YTkxMTc0L2ViNjkzL2ltYWdlcy9kb2NzL2NvbnRhaW5lcl9ldm9sdXRpb24uc3Zn?x-oss-process=image/format,png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a1.png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9mZXJtaGFuLm9zcy1jbi1xaW5nZGFvLmFsaXl1bmNzLmNvbS9ndWxpL2ltYWdlLTIwMjAwNTAzMTEwMTAxNjU5LnBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a2.png">
<meta property="og:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9mZXJtaGFuLm9zcy1jbi1xaW5nZGFvLmFsaXl1bmNzLmNvbS9ndWxpL2ltYWdlLTIwMjAwNTAzMTEwMzUwMjU2LnBuZw?x-oss-process=image/format,png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a3.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a4.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a5.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a6.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a7.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a8.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a9.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a10.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a11.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a12.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a13.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a14.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a15.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a16.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a17.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a18.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/image-20200503184919936.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/image-20200503185344246.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/image-20200503190101156.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a19.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a20.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a21.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a22.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a23.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a24.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a25.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a26.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a27.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a28.png">
<meta property="og:image" content="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a29.png">
<meta property="article:published_time" content="2020-03-13T16:00:00.000Z">
<meta property="article:modified_time" content="2021-07-11T08:54:54.218Z">
<meta property="article:author" content="momo">
<meta property="article:tag" content="java">
<meta property="article:tag" content="谷粒商城">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9kMzN3dWJyZmtpMGw2OC5jbG91ZGZyb250Lm5ldC8yNmExNzdlZGU0ZDdiMDMyMzYyMjg5YzZmY2NkNDQ4ZmM0YTkxMTc0L2ViNjkzL2ltYWdlcy9kb2NzL2NvbnRhaW5lcl9ldm9sdXRpb24uc3Zn?x-oss-process=image/format,png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="momo"><img width="96" loading="lazy" src="/yun.png" alt="momo"></a><div class="site-author-name"><a href="/about/">momo</a></div><a class="site-name" href="/about/site.html">我的笔记</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">199</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">58</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">47</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=kZJzggTTCf4SpvEQ8lXWoi5ZjhAx0ILZ&amp;jump_from=webapi" title="QQ 群 1050458482" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/YunYouJun" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://weibo.com/jizhideyunyoujun" title="微博" target="_blank" style="color:#E6162D"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-weibo-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/yunyoujun/" title="豆瓣" target="_blank" style="color:#007722"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=247102977" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/yunyoujun/" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1579790" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/about/white-qrcode-and-search.jpg" title="微信公众号" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/YunYouJun" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/elpsycn" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:me@yunyoujun.cn" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-train-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">谷粒商城笔记_分布式集群4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95"><span class="toc-number">1.0.1.</span> <span class="toc-text">文章目录</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81K8s-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.1.</span> <span class="toc-text">1、K8s 快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">1）简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.2.</span> <span class="toc-text">2）架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%95%B4%E4%BD%93%E4%B8%BB%E4%BB%8E%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">（1）整体主从方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89master-%E8%8A%82%E7%82%B9%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">（2）master 节点架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89Node-%E8%8A%82%E7%82%B9%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">（3）Node 节点架构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.3.</span> <span class="toc-text">3）概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C"><span class="toc-number">1.1.4.</span> <span class="toc-text">4）快速体验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85-minikube"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">（1）安装 minikube</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E4%BD%93%E9%AA%8C-nginx-%E9%83%A8%E7%BD%B2%E5%8D%87%E7%BA%A7"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">（2）体验 nginx 部署升级</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81K8s-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">2、K8s 集群安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89kubeadm"><span class="toc-number">1.2.1.</span> <span class="toc-text">1）kubeadm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E5%89%8D%E7%BD%AE%E8%A6%81%E6%B1%82"><span class="toc-number">1.2.2.</span> <span class="toc-text">2）前置要求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%EF%BC%89%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.2.3.</span> <span class="toc-text">3）部署步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%EF%BC%89%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.4.</span> <span class="toc-text">4）环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">（1）准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%90%AF%E5%8A%A8%E4%B8%89%E4%B8%AA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">（2）启动三个虚拟机</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E8%AE%BE%E7%BD%AE-Linux-%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%89%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-number">1.2.4.3.</span> <span class="toc-text">（3）设置 Linux 环境（三个节点都执行）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%EF%BC%89%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85-docker%E3%80%81kubeadm%E3%80%81kubelet%E3%80%81kubectl"><span class="toc-number">1.2.5.</span> <span class="toc-text">5）所有节点安装 docker、kubeadm、kubelet、kubectl</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85-Docker"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">（1）安装 Docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%B7%BB%E5%8A%A0%E9%98%BF%E9%87%8C%E4%B8%8E-Yum-%E6%BA%90"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">（2）添加阿里与 Yum 源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%AE%89%E8%A3%85-kubeadm%EF%BC%8Ckubelet-%E5%92%8C-kubectl"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">（3）安装 kubeadm，kubelet 和 kubectl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%EF%BC%89%E9%83%A8%E7%BD%B2-k8s-master"><span class="toc-number">1.2.6.</span> <span class="toc-text">6）部署 k8s-master</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%881%EF%BC%89master-%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">（1）master 节点初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%B5%8B%E8%AF%95-Kubectl%EF%BC%88%E4%B8%BB%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">（2）测试 Kubectl（主节点执行）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%EF%BC%89%E5%AE%89%E8%A3%85-POD-%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%EF%BC%88CNI%EF%BC%89"><span class="toc-number">1.2.7.</span> <span class="toc-text">7）安装 POD 网络插件（CNI）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%EF%BC%89%E5%8A%A0%E5%85%A5-kubenetes-%E7%9A%84-Node-%E8%8A%82%E7%82%B9"><span class="toc-number">1.2.8.</span> <span class="toc-text">8）加入 kubenetes 的 Node 节点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%EF%BC%89%E5%85%A5%E9%97%A8%E6%93%8D%E4%BD%9C-kubernetes-%E9%9B%86%E7%BE%A4"><span class="toc-number">1.2.9.</span> <span class="toc-text">9）入门操作 kubernetes 集群</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81K8s-%E7%BB%86%E8%8A%82"><span class="toc-number">1.3.</span> <span class="toc-text">3、K8s 细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81kubectl-%E6%96%87%E6%A1%A3"><span class="toc-number">1.3.1.</span> <span class="toc-text">1、kubectl 文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">2、资源类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-number">1.3.3.</span> <span class="toc-text">3、格式化输出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">语法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.3.1.1.</span> <span class="toc-text">示例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83"><span class="toc-number">1.3.4.</span> <span class="toc-text">命令参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#service-%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-number">1.3.5.</span> <span class="toc-text">service 的意义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ingress"><span class="toc-number">1.3.6.</span> <span class="toc-text">Ingress</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-kubernetes-%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E2%80%94%E2%80%94DashBoard"><span class="toc-number">1.4.</span> <span class="toc-text">安装 kubernetes 可视化界面——DashBoard</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kubesphere"><span class="toc-number">1.5.</span> <span class="toc-text">kubesphere</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AE%80%E6%B4%81"><span class="toc-number">1.5.1.</span> <span class="toc-text">1、简洁</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%AE%89%E8%A3%85%E5%89%8D%E6%8F%90%E6%8F%90%E4%BA%A4"><span class="toc-number">1.5.2.</span> <span class="toc-text">2、安装前提提交</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85-helm%EF%BC%88master-%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">1、安装 helm（master 节点执行）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%AE%89%E8%A3%85-Tilller%EF%BC%88Master-%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">2、安装 Tilller（Master 执行）</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="momo"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="我的笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">谷粒商城笔记_分布式集群4</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-14T00:00:00+08:00">2020-03-14</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2021-07-11 16:54:54" itemprop="dateModified" datetime="2021-07-11T16:54:54+08:00">2021-07-11</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/java/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">java</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">谷粒商城</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/java/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">java</span></a><a class="tag-item" href="/tags/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">谷粒商城</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h1>谷粒商城笔记_分布式集群4</h1>
<blockquote>
<p>本文由 <a target="_blank" rel="noopener" href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612802">blog.csdn.net</a></p>
</blockquote>
<ul>
<li>
<p>个人笔记 (新手级细节教程)：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/106922139">https://blog.csdn.net/hancoder/article/details/106922139</a></p>
</li>
<li>
<p>官方笔记 - 基础篇：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612619">https://blog.csdn.net/hancoder/article/details/107612619</a></p>
</li>
<li>
<p>官方笔记 - 高级篇：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612746">https://blog.csdn.net/hancoder/article/details/107612746</a></p>
</li>
<li>
<p>官方笔记 - 集群篇：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hancoder/article/details/107612802">https://blog.csdn.net/hancoder/article/details/107612802</a></p>
</li>
<li>
<p>官方笔记下载地址：<a target="_blank" rel="noopener" href="https://download.csdn.net/download/hancoder/12665396">https://download.csdn.net/download/hancoder/12665396</a></p>
</li>
</ul>
<h3 id="文章目录"><a class="header-anchor" href="#文章目录">¶</a>文章目录</h3>
<ul>
<li>
<ul>
<li><a href="#1K8s_13">1、K8s 快速入门</a></li>
<li>
<ul>
<li><a href="#1_15">1）简介</a></li>
<li><a href="#2_37">2）架构</a></li>
<li>
<ul>
<li><a href="#1_39">（1）整体主从方式</a></li>
<li><a href="#2master_49">（2）master 节点架构</a></li>
<li><a href="#3Node_57">（3）Node 节点架构</a></li>
</ul>
</li>
<li><a href="#3_75">3）概念</a></li>
<li><a href="#4_95">4）快速体验</a></li>
<li>
<ul>
<li><a href="#1minikube_99">（1）安装 minikube</a></li>
<li><a href="#2nginx_108">（2）体验 nginx 部署升级</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2K8s_120">2、K8s 集群安装</a></li>
<li>
<ul>
<li><a href="#1kubeadm_122">1）kubeadm</a></li>
<li><a href="#2_141">2）前置要求</a></li>
<li><a href="#3_149">3）部署步骤</a></li>
<li><a href="#4_159">4）环境准备</a></li>
<li>
<ul>
<li><a href="#1_161">（1）准备工作</a></li>
<li><a href="#2_177">（2）启动三个虚拟机</a></li>
<li><a href="#3Linux_297">（3）设置 Linux 环境（三个节点都执行）</a></li>
</ul>
</li>
<li><a href="#5dockerkubeadmkubeletkubectl_379">5）所有节点安装 docker、kubeadm、kubelet、kubectl</a></li>
<li>
<ul>
<li><a href="#1Docker_383">（1）安装 Docker</a></li>
<li><a href="#2Yum_435">（2）添加阿里与 Yum 源</a></li>
<li><a href="#3kubeadmkubeletkubectl_451">（3）安装 kubeadm，kubelet 和 kubectl</a></li>
</ul>
</li>
<li><a href="#6k8smaster_486">6）部署 k8s-master</a></li>
<li>
<ul>
<li><a href="#1master_488">（1）master 节点初始化</a></li>
<li><a href="#2Kubectl_627">（2）测试 Kubectl（主节点执行）</a></li>
</ul>
</li>
<li><a href="#7PODCNI_654">7）安装 POD 网络插件（CNI）</a></li>
<li><a href="#8kubenetesNode_766">8）加入 kubenetes 的 Node 节点</a></li>
<li><a href="#9kubernetes_777">9）入门操作 kubernetes 集群</a></li>
</ul>
</li>
<li><a href="#3K8s_1081">3、K8s 细节</a></li>
<li>
<ul>
<li><a href="#1kubectl_1083">1、kubectl 文档</a></li>
<li><a href="#2_1087">2、资源类型</a></li>
<li><a href="#3_1093">3、格式化输出</a></li>
<li>
<ul>
<li><a href="#_1101">语法</a></li>
<li>
<ul>
<li><a href="#_1120">示例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_1414">命令参考</a></li>
<li><a href="#service_1424">service 的意义</a></li>
<li><a href="#Ingress_1630">Ingress</a></li>
</ul>
</li>
<li><a href="#kubernetesDashBoard_1743">安装 kubernetes 可视化界面——DashBoard</a></li>
<li><a href="#kubesphere_1801">kubesphere</a></li>
<li>
<ul>
<li><a href="#1_1809">1、简洁</a></li>
<li><a href="#2_1813">2、安装前提提交</a></li>
<li>
<ul>
<li><a href="#1helmmaster_1817">1、安装 helm（master 节点执行）</a></li>
<li><a href="#2TilllerMaster_1894">2、安装 Tilller（Master 执行）</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="1、K8s-快速入门"><a class="header-anchor" href="#1、K8s-快速入门">¶</a>1、K8s 快速入门</h2>
<h3 id="1）简介"><a class="header-anchor" href="#1）简介">¶</a>1）简介</h3>
<p>kubernetes 简称 k8s。是用于自动部署，扩展和管理容器化应用程序的开源系统。<br>
中文官网：<a target="_blank" rel="noopener" href="https://kubernetes.io/Zh/">https://kubernetes.io/Zh/</a><br>
中文社区：<a target="_blank" rel="noopener" href="https://www.kubernetes.org.cn/">https://www.kubernetes.org.cn/</a><br>
官方文档：<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/home/">https://kubernetes.io/zh/docs/home/</a><br>
社区文档：<a target="_blank" rel="noopener" href="https://docs.kubernetes.org.cn/">https://docs.kubernetes.org.cn/</a></p>
<p>部署方式的进化：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9kMzN3dWJyZmtpMGw2OC5jbG91ZGZyb250Lm5ldC8yNmExNzdlZGU0ZDdiMDMyMzYyMjg5YzZmY2NkNDQ4ZmM0YTkxMTc0L2ViNjkzL2ltYWdlcy9kb2NzL2NvbnRhaW5lcl9ldm9sdXRpb24uc3Zn?x-oss-process=image/format,png" alt="" loading="lazy"></p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a1.png" class="" loading="lazy">
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9mZXJtaGFuLm9zcy1jbi1xaW5nZGFvLmFsaXl1bmNzLmNvbS9ndWxpL2ltYWdlLTIwMjAwNTAzMTEwMTAxNjU5LnBuZw?x-oss-process=image/format,png" alt="" loading="lazy"></p>
<h3 id="2）架构"><a class="header-anchor" href="#2）架构">¶</a>2）架构</h3>
<h4 id="（1）整体主从方式"><a class="header-anchor" href="#（1）整体主从方式">¶</a>（1）整体主从方式</h4>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a2.png" class="" loading="lazy">
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9mZXJtaGFuLm9zcy1jbi1xaW5nZGFvLmFsaXl1bmNzLmNvbS9ndWxpL2ltYWdlLTIwMjAwNTAzMTEwMzUwMjU2LnBuZw?x-oss-process=image/format,png" alt="" loading="lazy"></p>
<h4 id="（2）master-节点架构"><a class="header-anchor" href="#（2）master-节点架构">¶</a>（2）master 节点架构</h4>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a3.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a4.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a5.png" class="" loading="lazy">
<h4 id="（3）Node-节点架构"><a class="header-anchor" href="#（3）Node-节点架构">¶</a>（3）Node 节点架构</h4>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a6.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a7.png" class="" loading="lazy">
<h3 id="3）概念"><a class="header-anchor" href="#3）概念">¶</a>3）概念</h3>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a8.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a9.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a10.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a11.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a12.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a13.png" class="" loading="lazy">
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a14.png" class="" loading="lazy">
<h3 id="4）快速体验"><a class="header-anchor" href="#4）快速体验">¶</a>4）快速体验</h3>
<h4 id="（1）安装-minikube"><a class="header-anchor" href="#（1）安装-minikube">¶</a>（1）安装 minikube</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube/releases">https://github.com/kubernetes/minikube/releases</a><br>
下载 minikuber-windows-amd64.exe 改名为 minikube.exe<br>
打开 virtualBox，打开 cmd<br>
运行<br>
minikube start --vm-driver=virtualbox --registry-mirror=https://registry.docker-cn.com<br>
等待 20 分钟即可。</p>
<h4 id="（2）体验-nginx-部署升级"><a class="header-anchor" href="#（2）体验-nginx-部署升级">¶</a>（2）体验 nginx 部署升级</h4>
<ol>
<li>
<p>提交一个 nginx deployment<br>
kubectl apply -f <a target="_blank" rel="noopener" href="https://k8s.io/examples/application/deployment.yaml">https://k8s.io/examples/application/deployment.yaml</a></p>
</li>
<li>
<p>升级 nginx deployment<br>
kubectl apply -f <a target="_blank" rel="noopener" href="https://k8s.io/examples/application/deployment-update.yaml">https://k8s.io/examples/application/deployment-update.yaml</a></p>
</li>
<li>
<p>扩容 nginx deployment</p>
</li>
</ol>
<h2 id="2、K8s-集群安装"><a class="header-anchor" href="#2、K8s-集群安装">¶</a>2、K8s 集群安装</h2>
<h3 id="1）kubeadm"><a class="header-anchor" href="#1）kubeadm">¶</a>1）kubeadm</h3>
<p>kubeadm 是官方社区推出的一个用于快速部署 kuberneters 集群的工具。<br>
这个工具能通过两条指令完成一个 kuberneters 集群的部署</p>
<p>创建一个 master 节点</p>
<pre class="line-numbers language-none"><code class="language-none">$ kuberneters init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>将一个 node 节点加入到当前集群中</p>
<pre class="line-numbers language-none"><code class="language-none">$ kubeadm join &lt;Master节点的IP和端口&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="2）前置要求"><a class="header-anchor" href="#2）前置要求">¶</a>2）前置要求</h3>
<p>一台或多台机器，操作系统 Centos7.x-86_x64<br>
硬件配置：2GB 或更多 RAM，2 个 CPU 或更多 CPU，硬盘 30GB 或更多<br>
集群中所有的机器之间网络互通<br>
可以访问外网，需要拉取镜像<br>
禁止 Swap 分区</p>
<h3 id="3）部署步骤"><a class="header-anchor" href="#3）部署步骤">¶</a>3）部署步骤</h3>
<ol>
<li>在所有的节点上安装 Docker 和 kubeadm</li>
<li>不是 Kubernetes Master</li>
<li>部署容器网络插件</li>
<li>部署 Kubernetes Node，将节点加入 Kubernetes 集群中</li>
<li>部署 DashBoard web 页面，可视化查看 Kubernetes 资源</li>
</ol>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a15.png" class="" loading="lazy">
<h3 id="4）环境准备"><a class="header-anchor" href="#4）环境准备">¶</a>4）环境准备</h3>
<h4 id="（1）准备工作"><a class="header-anchor" href="#（1）准备工作">¶</a>（1）准备工作</h4>
<ul>
<li>我们可以使用 vagrant 快速创建三个虚拟机。虚拟机启动前先设置 virtualbox 的主机网络。现在全部统一为 192.168.56.1，以后所有虚拟机都是 56.x 的 ip 地址。</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a16.png" class="" loading="lazy">
<ul>
<li>在全局设定中，找到一个空间比较大的磁盘用用来存放镜像。</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a17.png" class="" loading="lazy">
<h4 id="（2）启动三个虚拟机"><a class="header-anchor" href="#（2）启动三个虚拟机">¶</a>（2）启动三个虚拟机</h4>
<ul>
<li>使用我们提供的 vagrant 文件，复制到非中文无空格目录下，运行 vagrant up 启动三个虚拟机。其实 vagrant 完全可以一键部署全部 K8s 集群<br>
<a target="_blank" rel="noopener" href="https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster">https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster</a><br>
<a target="_blank" rel="noopener" href="http://github.com/davidkbainbridge/k8s-playground">http://github.com/davidkbainbridge/k8s-playground</a></li>
</ul>
<p>下面是 vagrantfile，使用它来创建三个虚拟机，分别为 k8s-node1，k8s-node2 和 k8s-node3.</p>
<pre class="line-numbers language-none"><code class="language-none">Vagrant.configure(&quot;2&quot;) do |config|
   (1..3).each do |i|
        config.vm.define &quot;k8s-node#&#123;i&#125;&quot; do |node|
            # 设置虚拟机的Box
            node.vm.box &#x3D; &quot;centos&#x2F;7&quot;

            # 设置虚拟机的主机名
            node.vm.hostname&#x3D;&quot;k8s-node#&#123;i&#125;&quot;

            # 设置虚拟机的IP
            node.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.#&#123;99+i&#125;&quot;, netmask: &quot;255.255.255.0&quot;

            # 设置主机与虚拟机的共享目录
            # node.vm.synced_folder &quot;~&#x2F;Documents&#x2F;vagrant&#x2F;share&quot;, &quot;&#x2F;home&#x2F;vagrant&#x2F;share&quot;

            # VirtaulBox相关配置
            node.vm.provider &quot;virtualbox&quot; do |v|
                # 设置虚拟机的名称
                v.name &#x3D; &quot;k8s-node#&#123;i&#125;&quot;
                # 设置虚拟机的内存大小
                v.memory &#x3D; 4096
                # 设置虚拟机的CPU个数
                v.cpus &#x3D; 4
            end
        end
   end
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>进入到三个虚拟机，开启 root 的密码访问权限</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">Vagrant ssh xxx进入到系统后

su root 密码为vagrant

vi &#x2F;etc&#x2F;ssh&#x2F;sshd_config

修改
PermitRootLogin yes 
PasswordAuthentication yes

所有的虚拟机设为4核4G<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>关于在 “网络地址转换” 的连接方式下，三个节点的 eth0，IP 地址相同的问题。</p>
<p>** 问题描述：** 查看 k8s-node1 的路由表：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# ip route show
default via 10.0.2.2 dev eth0 proto dhcp metric 100 
10.0.2.0&#x2F;24 dev eth0 proto kernel scope link src 10.0.2.15 metric 100 
192.168.56.0&#x2F;24 dev eth1 proto kernel scope link src 192.168.56.100 metric 101 
[root@k8s-node1 ~<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>能够看到路由表中记录的是，通过端口 eth0 进行数据包的收发。</p>
<p>分别查看 k8s-node1，k8s-node2 和 k8s-node3 的 eth0 所绑定的 IP 地址，发现它们都是相同的，全都是 10.0.2.15，这些地址是供 kubernetes 集群通信用的，区别于 eth1 上的 IP 地址，是通远程管理使用的。</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# ip addr
...
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link&#x2F;ether 52:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15&#x2F;24 brd 10.0.2.255 scope global noprefixroute dynamic eth0
       valid_lft 84418sec preferred_lft 84418sec
    inet6 fe80::5054:ff:fe8a:fee6&#x2F;64 scope link 
       valid_lft forever preferred_lft forever
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link&#x2F;ether 08:00:27:a3:ca:c0 brd ff:ff:ff:ff:ff:ff
    inet 192.168.56.100&#x2F;24 brd 192.168.56.255 scope global noprefixroute eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fea3:cac0&#x2F;64 scope link 
       valid_lft forever preferred_lft forever
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>** 原因分析：** 这是因为它们使用是端口转发规则，使用同一个地址，通过不同的端口来区分。但是这种端口转发规则在以后的使用中会产生很多不必要的问题，所以需要修改为 NAT 网络类型。</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a18.png" class="" loading="lazy">
<p><strong>解决方法：</strong></p>
<ul>
<li>选择三个节点，然后执行 “管理”-&gt;“全局设定”-&gt;“网络”，添加一个 NAT 网络。</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/image-20200503184919936.png" class="" loading="lazy">
<ul>
<li>分别修改每台设备的网络类型，并刷新重新生成 MAC 地址。</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/image-20200503185344246.png" class="" loading="lazy">
<ul>
<li>再次查看三个节点的 IP</li>
</ul>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/image-20200503190101156.png" class="" loading="lazy">
<h4 id="（3）设置-Linux-环境（三个节点都执行）"><a class="header-anchor" href="#（3）设置-Linux-环境（三个节点都执行）">¶</a>（3）设置 Linux 环境（三个节点都执行）</h4>
<ul>
<li>关闭防火墙</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">systemctl stop firewalld
systemctl disable firewalld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>关闭 Linux</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">sed -i &#39;s&#x2F;enforcing&#x2F;disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config
setenforce 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>关闭 swap</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">swapoff -a #临时关闭
sed -ri &#39;s&#x2F;.*swap.*&#x2F;#&amp;&#x2F;&#39; &#x2F;etc&#x2F;fstab #永久关闭
free -g #验证，swap必须为0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li>添加主机名与 IP 对应关系：</li>
</ul>
<p>查看主机名：</p>
<pre class="line-numbers language-none"><code class="language-none">hostname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果主机名不正确，可以通过 “hostnamectl set-hostname <newhostname> : 指定新的 hostname” 命令来进行修改。</p>
<pre class="line-numbers language-none"><code class="language-none">vi &#x2F;etc&#x2F;hosts
10.0.2.15 k8s-node1
10.0.2.4 k8s-node2
10.0.2.5 k8s-node3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>将桥接的 IPV4 流量传递到 iptables 的链：</p>
<pre class="line-numbers language-none"><code class="language-none">cat &gt; &#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf &lt;&lt;EOF

net.bridge.bridge-nf-call-ip6tables &#x3D; 1

net.bridge.bridge-nf-call-iptables &#x3D; 1

EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>应用规则：</p>
<pre class="line-numbers language-none"><code class="language-none">sysctl --system<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>疑难问题：遇见提示是只读的文件系统，运行如下命令</p>
<pre class="line-numbers language-none"><code class="language-none">mount -o remount rw &#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>date 查看时间（可选）</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">yum -y install ntpupdate

ntpupdate time.window.com #同步最新时间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="5）所有节点安装-docker、kubeadm、kubelet、kubectl"><a class="header-anchor" href="#5）所有节点安装-docker、kubeadm、kubelet、kubectl">¶</a>5）所有节点安装 docker、kubeadm、kubelet、kubectl</h3>
<p>Kubenetes 默认 CRI（容器运行时）为 Docker，因此先安装 Docker。</p>
<h4 id="（1）安装-Docker"><a class="header-anchor" href="#（1）安装-Docker">¶</a>（1）安装 Docker</h4>
<p>1、卸载之前的 docker</p>
<pre class="line-numbers language-none"><code class="language-none">$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、安装 Docker -CE</p>
<pre class="line-numbers language-none"><code class="language-none">$ sudo yum install -y yum-utils

$ sudo yum-config-manager \
    --add-repo \
    https:&#x2F;&#x2F;download.docker.com&#x2F;linux&#x2F;centos&#x2F;docker-ce.repo
    
$ sudo yum -y install docker-ce docker-ce-cli containerd.io<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、配置镜像加速</p>
<pre class="line-numbers language-none"><code class="language-none">sudo mkdir -p &#x2F;etc&#x2F;docker
sudo tee &#x2F;etc&#x2F;docker&#x2F;daemon.json &lt;&lt;-&#39;EOF&#39;
&#123;
  &quot;registry-mirrors&quot;: [&quot;https:&#x2F;&#x2F;ke9h1pt4.mirror.aliyuncs.com&quot;]
&#125;
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、启动 Docker &amp;&amp; 设置 docker 开机启动</p>
<pre class="line-numbers language-none"><code class="language-none">systemctl enable docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>基础环境准备好，可以给三个虚拟机备份一下；</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a19.png" class="" loading="lazy">
<h4 id="（2）添加阿里与-Yum-源"><a class="header-anchor" href="#（2）添加阿里与-Yum-源">¶</a>（2）添加阿里与 Yum 源</h4>
<pre class="line-numbers language-none"><code class="language-none">cat &lt;&lt;EOF &gt; &#x2F;etc&#x2F;yum.repos.d&#x2F;kubernetes.repo
[kubernetes]
name&#x3D;Kubernetes
baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64&#x2F;
enabled&#x3D;1
gpgcheck&#x3D;1
repo_gpgcheck&#x3D;1
gpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;rpm-package-key.gpg
EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>更多详情见： <a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/kubernetes">https://developer.aliyun.com/mirror/kubernetes</a></p>
<h4 id="（3）安装-kubeadm，kubelet-和-kubectl"><a class="header-anchor" href="#（3）安装-kubeadm，kubelet-和-kubectl">¶</a>（3）安装 kubeadm，kubelet 和 kubectl</h4>
<pre class="line-numbers language-none"><code class="language-none">yum list|grep kube<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>安装</p>
<pre class="line-numbers language-none"><code class="language-none">yum install -y kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>开机启动</p>
<pre class="line-numbers language-none"><code class="language-none">systemctl enable kubelet &amp;&amp; systemctl start kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看 kubelet 的状态：</p>
<pre class="line-numbers language-none"><code class="language-none">systemctl status kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>查看 kubelet 版本：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node2 ~]# kubelet --version
Kubernetes v1.17.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="6）部署-k8s-master"><a class="header-anchor" href="#6）部署-k8s-master">¶</a>6）部署 k8s-master</h3>
<h4 id="（1）master-节点初始化"><a class="header-anchor" href="#（1）master-节点初始化">¶</a>（1）master 节点初始化</h4>
<p>在 Master 节点上，创建并执行 master_images.sh</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

images&#x3D;(
	kube-apiserver:v1.17.3
    kube-proxy:v1.17.3
	kube-controller-manager:v1.17.3
	kube-scheduler:v1.17.3
	coredns:1.6.5
	etcd:3.4.3-0
    pause:3.1
)

for imageName in $&#123;images[@]&#125; ; do
    docker pull registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;$imageName
#   docker tag registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;$imageName  k8s.gcr.io&#x2F;$imageName
done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>初始化 kubeadm</p>
<pre class="line-numbers language-none"><code class="language-none">$ kubeadm init \
--apiserver-advertise-address&#x3D;10.0.2.15 \
--image-repository registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers \
--kubernetes-version   v1.17.3 \
--service-cidr&#x3D;10.96.0.0&#x2F;16  \
--pod-network-cidr&#x3D;10.244.0.0&#x2F;16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注：</p>
<ul>
<li>–apiserver-advertise-address=10.0.2.21 ：这里的 IP 地址是 master 主机的地址，为上面的 eth0 网卡的地址；</li>
</ul>
<p>执行结果：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 opt]# kubeadm init \
&gt; --apiserver-advertise-address&#x3D;10.0.2.15 \
&gt; --image-repository registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers \
&gt; --kubernetes-version   v1.17.3 \
&gt; --service-cidr&#x3D;10.96.0.0&#x2F;16  \
&gt; --pod-network-cidr&#x3D;10.244.0.0&#x2F;16
W0503 14:07:12.594252   10124 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]
[init] Using Kubernetes version: v1.17.3
[preflight] Running pre-flight checks
        [WARNING IsDockerSystemdCheck]: detected &quot;cgroupfs&quot; as the Docker cgroup driver. The recommended driver is &quot;systemd&quot;. Please follow the guide at https:&#x2F;&#x2F;kubernetes.io&#x2F;docs&#x2F;setup&#x2F;cri&#x2F;
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
[kubelet-start] Writing kubelet environment file with flags to file &quot;&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;kubeadm-flags.env&quot;
[kubelet-start] Writing kubelet configuration to file &quot;&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yaml&quot;
[kubelet-start] Starting the kubelet
[certs] Using certificateDir folder &quot;&#x2F;etc&#x2F;kubernetes&#x2F;pki&quot;
[certs] Generating &quot;ca&quot; certificate and key
[certs] Generating &quot;apiserver&quot; certificate and key
[certs] apiserver serving cert is signed for DNS names [k8s-node1 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 10.0.2.15]
[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
[certs] Generating &quot;front-proxy-ca&quot; certificate and key
[certs] Generating &quot;front-proxy-client&quot; certificate and key
[certs] Generating &quot;etcd&#x2F;ca&quot; certificate and key
[certs] Generating &quot;etcd&#x2F;server&quot; certificate and key
[certs] etcd&#x2F;server serving cert is signed for DNS names [k8s-node1 localhost] and IPs [10.0.2.15 127.0.0.1 ::1]
[certs] Generating &quot;etcd&#x2F;peer&quot; certificate and key
[certs] etcd&#x2F;peer serving cert is signed for DNS names [k8s-node1 localhost] and IPs [10.0.2.15 127.0.0.1 ::1]
[certs] Generating &quot;etcd&#x2F;healthcheck-client&quot; certificate and key
[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
[certs] Generating &quot;sa&quot; key and public key
[kubeconfig] Using kubeconfig folder &quot;&#x2F;etc&#x2F;kubernetes&quot;
[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
[control-plane] Using manifest folder &quot;&#x2F;etc&#x2F;kubernetes&#x2F;manifests&quot;
[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
W0503 14:07:30.908642   10124 manifests.go:225] the default kube-apiserver authorization-mode is &quot;Node,RBAC&quot;; using &quot;Node,RBAC&quot;
[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
W0503 14:07:30.911330   10124 manifests.go:225] the default kube-apiserver authorization-mode is &quot;Node,RBAC&quot;; using &quot;Node,RBAC&quot;
[etcd] Creating static Pod manifest for local etcd in &quot;&#x2F;etc&#x2F;kubernetes&#x2F;manifests&quot;
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;&#x2F;etc&#x2F;kubernetes&#x2F;manifests&quot;. This can take up to 4m0s
[apiclient] All control plane components are healthy after 22.506521 seconds
[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.18&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Skipping phase. Please see --upload-certs
[mark-control-plane] Marking the node k8s-node1 as control-plane by adding the label &quot;node-role.kubernetes.io&#x2F;master&#x3D;&#39;&#39;&quot;
[mark-control-plane] Marking the node k8s-node1 as control-plane by adding the taints [node-role.kubernetes.io&#x2F;master:NoSchedule]
[bootstrap-token] Using token: sg47f3.4asffoi6ijb8ljhq
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
[kubelet-finalize] Updating &quot;&#x2F;etc&#x2F;kubernetes&#x2F;kubelet.conf&quot; to point to a rotatable kubelet client certificate and key
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy
#表示kubernetes已经初始化成功了
Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME&#x2F;.kube
  sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config
  sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https:&#x2F;&#x2F;kubernetes.io&#x2F;docs&#x2F;concepts&#x2F;cluster-administration&#x2F;addons&#x2F;

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 10.0.2.15:6443 --token sg47f3.4asffoi6ijb8ljhq \
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb 
[root@k8s-node1 opt]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>由于默认拉取镜像地址 <a target="_blank" rel="noopener" href="http://k8s.cr.io">k8s.cr.io</a> 国内无法访问，这里指定阿里云仓库地址。可以手动按照我们的 <a target="_blank" rel="noopener" href="http://images.sh">images.sh</a> 先拉取镜像。</p>
<p>地址变为：<a target="_blank" rel="noopener" href="http://registry.aliyuncs.com/googole_containers">registry.aliyuncs.com/googole_containers</a> 也可以。<br>
科普：无类别域间路由（Classless Inter-Domain Routing 、CIDR）是一个用于给用户分配 IP 地址以及在互联网上有效第路由 IP 数据包的对 IP 地址进行归类的方法。<br>
拉取可能失败，需要下载镜像。</p>
<p>运行完成提前复制：加入集群的令牌。</p>
<h4 id="（2）测试-Kubectl（主节点执行）"><a class="header-anchor" href="#（2）测试-Kubectl（主节点执行）">¶</a>（2）测试 Kubectl（主节点执行）</h4>
<pre class="line-numbers language-none"><code class="language-none">mkdir -p $HOME&#x2F;.kube
sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config
sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>详细部署文档：<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></p>
<pre class="line-numbers language-none"><code class="language-none">$ kubectl get nodes #获取所有节点<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>目前 Master 状态为 notready。等待网络加入完成即可。</p>
<pre class="line-numbers language-none"><code class="language-none">$ journalctl -u kubelet #查看kubelet日志<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">kubeadm join 10.0.2.15:6443 --token sg47f3.4asffoi6ijb8ljhq \
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="7）安装-POD-网络插件（CNI）"><a class="header-anchor" href="#7）安装-POD-网络插件（CNI）">¶</a>7）安装 POD 网络插件（CNI）</h3>
<p>在 master 节点上执行按照 POD 网络插件</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl apply -f \
https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coreos&#x2F;flanne&#x2F;master&#x2F;Documentation&#x2F;kube-flannel.yml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>以上地址可能被墙，可以直接获取本地已经下载的 flannel.yml 运行即可，如：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl apply -f  kube-flannel.yml    
podsecuritypolicy.policy&#x2F;psp.flannel.unprivileged created
clusterrole.rbac.authorization.k8s.io&#x2F;flannel created
clusterrolebinding.rbac.authorization.k8s.io&#x2F;flannel created
serviceaccount&#x2F;flannel created
configmap&#x2F;kube-flannel-cfg created
daemonset.apps&#x2F;kube-flannel-ds-amd64 created
daemonset.apps&#x2F;kube-flannel-ds-arm64 created
daemonset.apps&#x2F;kube-flannel-ds-arm created
daemonset.apps&#x2F;kube-flannel-ds-ppc64le created
daemonset.apps&#x2F;kube-flannel-ds-s390x created
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>同时 flannel.yml 中指定的 images 访问不到可以去 docker hub 找一个 wget yml 地址<br>
vi 修改 yml 所有 amd64 的地址修改了即可<br>
等待大约 3 分钟<br>
kubectl get pods -n kube-system 查看指定名称空间的 pods<br>
kubectl get pods -all-namespace 查看所有名称空间的 pods</p>
<p>$ ip link set cni0 down 如果网络出现问题，关闭 cni0，重启虚拟机继续测试<br>
执行 watch kubectl get pod -n kube-system -o wide 监控 pod 进度<br>
等待 3-10 分钟，完全都是 running 以后继续</p>
<p>查看命名空间：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get ns
NAME              STATUS   AGE
default           Active   30m
kube-node-lease   Active   30m
kube-public       Active   30m
kube-system       Active   30m
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get pods --all-namespaces       
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE
kube-system   coredns-546565776c-9sbmk            0&#x2F;1     Pending   0          31m
kube-system   coredns-546565776c-t68mr            0&#x2F;1     Pending   0          31m
kube-system   etcd-k8s-node1                      1&#x2F;1     Running   0          31m
kube-system   kube-apiserver-k8s-node1            1&#x2F;1     Running   0          31m
kube-system   kube-controller-manager-k8s-node1   1&#x2F;1     Running   0          31m
kube-system   kube-flannel-ds-amd64-6xwth         1&#x2F;1     Running   0          2m50s
kube-system   kube-proxy-sz2vz                    1&#x2F;1     Running   0          31m
kube-system   kube-scheduler-k8s-node1            1&#x2F;1     Running   0          31m
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看 master 上的节点信息：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get nodes
NAME        STATUS   ROLES    AGE   VERSION
k8s-node1   Ready    master   34m   v1.17.3   #status为ready才能够执行下面的命令
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>最后再次执行，并且分别在 “k8s-node2” 和“k8s-node3”上也执行这里命令：</p>
<pre class="line-numbers language-none"><code class="language-none">kubeadm join 10.0.2.15:6443 --token sg47f3.4asffoi6ijb8ljhq \
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 opt]# kubectl get nodes;
NAME        STATUS     ROLES    AGE   VERSION
k8s-node1   Ready      master   47m   v1.17.3
k8s-node2   NotReady   &lt;none&gt;   75s   v1.17.3
k8s-node3   NotReady   &lt;none&gt;   76s   v1.17.3
[root@k8s-node1 opt]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>监控 pod 进度</p>
<pre class="line-numbers language-none"><code class="language-none">watch kubectl get pod -n kube-system -o wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>等到所有的 status 都变为 running 状态后，再次查看节点信息：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]#  kubectl get nodes;                         
NAME        STATUS   ROLES    AGE     VERSION
k8s-node1   Ready    master   3h50m   v1.17.3
k8s-node2   Ready    &lt;none&gt;   3h3m    v1.17.3
k8s-node3   Ready    &lt;none&gt;   3h3m    v1.17.3
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="8）加入-kubenetes-的-Node-节点"><a class="header-anchor" href="#8）加入-kubenetes-的-Node-节点">¶</a>8）加入 kubenetes 的 Node 节点</h3>
<p>在 node 节点中执行，向集群中添加新的节点，执行在 kubeadm init 输出的 kubeadm join 命令；<br>
确保 node 节点成功：<br>
token 过期怎么办<br>
kubeadm token create --print-join-command</p>
<h3 id="9）入门操作-kubernetes-集群"><a class="header-anchor" href="#9）入门操作-kubernetes-集群">¶</a>9）入门操作 kubernetes 集群</h3>
<p>1、在主节点上部署一个 tomcat</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl create deployment tomcat6 --image&#x3D;tomcat:6.0.53-jre8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>获取所有的资源：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get all
NAME                           READY   STATUS              RESTARTS   AGE
pod&#x2F;tomcat6-7b84fb5fdc-cfd8g   0&#x2F;1     ContainerCreating   0          41s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service&#x2F;kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443&#x2F;TCP   70m

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps&#x2F;tomcat6   0&#x2F;1     1            0           41s

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps&#x2F;tomcat6-7b84fb5fdc   1         1         0       41s
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>kubectl get pods -o wide 可以获取到 tomcat 部署信息，能够看到它被部署到了 k8s-node2 上了</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get all -o wide
NAME                           READY   STATUS    RESTARTS   AGE    IP           NODE        NOMINATED NODE   READINESS GATES
pod&#x2F;tomcat6-7b84fb5fdc-cfd8g   1&#x2F;1     Running   0          114s   10.244.2.2   k8s-node2   &lt;none&gt;           &lt;none&gt;

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR
service&#x2F;kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443&#x2F;TCP   71m   &lt;none&gt;

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE    CONTAINERS   IMAGES               SELECTOR
deployment.apps&#x2F;tomcat6   1&#x2F;1     1            1           114s   tomcat       tomcat:6.0.53-jre8   app&#x3D;tomcat6

NAME                                 DESIRED   CURRENT   READY   AGE    CONTAINERS   IMAGES               SELECTOR
replicaset.apps&#x2F;tomcat6-7b84fb5fdc   1         1         1       114s   tomcat       tomcat:6.0.53-jre8   app&#x3D;tomcat6,pod-template-hash&#x3D;7b84fb5fdc
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看 node2 节点上，下载了哪些镜像：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node2 opt]# docker images
REPOSITORY                                                       TAG                 IMAGE ID            CREATED             SIZE
registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;kube-proxy   v1.17.3             0d40868643c6        2 weeks ago         117MB
registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;pause        3.2                 80d28bedfe5d        2 months ago        683kB
quay.io&#x2F;coreos&#x2F;flannel                                           v0.11.0-amd64       ff281650a721        15 months ago       52.6MB
tomcat                                                           6.0.53-jre8         49ab0583115a        2 years ago         290MB
[root@k8s-node2 opt]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看 Node2 节点上，正在运行的容器：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node2 opt]# docker ps
CONTAINER ID        IMAGE                                                            COMMAND                  CREATED             STATUS              PORTS               NAMES
9194cc4f0b7a        tomcat                                                           &quot;catalina.sh run&quot;        2 minutes ago       Up 2 minutes                            k8s_tomcat_tomcat6-7b84fb5fdc-cfd8g_default_0c9ebba2-992d-4c0e-99ef-3c4c3294bc59_0
f44af0c7c345        registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;pause:3.2    &quot;&#x2F;pause&quot;                 3 minutes ago       Up 3 minutes                            k8s_POD_tomcat6-7b84fb5fdc-cfd8g_default_0c9ebba2-992d-4c0e-99ef-3c4c3294bc59_0
ef74c90491e4        ff281650a721                                                     &quot;&#x2F;opt&#x2F;bin&#x2F;flanneld -…&quot;   20 minutes ago      Up 20 minutes                           k8s_kube-flannel_kube-flannel-ds-amd64-5xs5j_kube-system_11a94346-316d-470b-9668-c15ce183abec_0
c8a524e5a193        registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;kube-proxy   &quot;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;kube…&quot;   25 minutes ago      Up 25 minutes                           k8s_kube-proxy_kube-proxy-mvlnk_kube-system_519de79a-e8d8-4b1c-a74e-94634cebabce_0
4590685c519a        registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;pause:3.2    &quot;&#x2F;pause&quot;                 26 minutes ago      Up 26 minutes                           k8s_POD_kube-flannel-ds-amd64-5xs5j_kube-system_11a94346-316d-470b-9668-c15ce183abec_0
54e00af5cde4        registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;pause:3.2    &quot;&#x2F;pause&quot;                 26 minutes ago      Up 26 minutes                           k8s_POD_kube-proxy-mvlnk_kube-system_519de79a-e8d8-4b1c-a74e-94634cebabce_0
[root@k8s-node2 opt]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>在 node1 上执行：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get pods
NAME                       READY   STATUS    RESTARTS   AGE
tomcat6-7b84fb5fdc-cfd8g   1&#x2F;1     Running   0          5m35s

[root@k8s-node1 k8s]# kubectl get pods --all-namespaces
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE
default       tomcat6-7b84fb5fdc-cfd8g            1&#x2F;1     Running   0          163m
kube-system   coredns-546565776c-9sbmk            1&#x2F;1     Running   0          3h52m
kube-system   coredns-546565776c-t68mr            1&#x2F;1     Running   0          3h52m
kube-system   etcd-k8s-node1                      1&#x2F;1     Running   0          3h52m
kube-system   kube-apiserver-k8s-node1            1&#x2F;1     Running   0          3h52m
kube-system   kube-controller-manager-k8s-node1   1&#x2F;1     Running   0          3h52m
kube-system   kube-flannel-ds-amd64-5xs5j         1&#x2F;1     Running   0          3h6m
kube-system   kube-flannel-ds-amd64-6xwth         1&#x2F;1     Running   0          3h24m
kube-system   kube-flannel-ds-amd64-fvnvx         1&#x2F;1     Running   0          3h6m
kube-system   kube-proxy-7tkvl                    1&#x2F;1     Running   0          3h6m
kube-system   kube-proxy-mvlnk                    1&#x2F;1     Running   0          3h6m
kube-system   kube-proxy-sz2vz                    1&#x2F;1     Running   0          3h52m
kube-system   kube-scheduler-k8s-node1            1&#x2F;1     Running   0          3h52m
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从前面看到 tomcat 部署在 Node2 上，现在模拟因为各种原因宕机的情况，将 node2 关闭电源，观察情况。</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get nodes
NAME        STATUS     ROLES    AGE     VERSION
k8s-node1   Ready      master   4h4m    v1.17.3
k8s-node2   NotReady   &lt;none&gt;   3h18m   v1.17.3
k8s-node3   Ready      &lt;none&gt;   3h18m   v1.17.3
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get pods -o wide
NAME                       READY   STATUS    RESTARTS   AGE    IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-cfd8g   1&#x2F;1     Running   0          177m   10.244.2.2   k8s-node2   &lt;none&gt;           &lt;none&gt;
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a20.png" class="" loading="lazy">
<p>2、暴露 nginx 访问</p>
<p>在 master 上执行</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl expose deployment tomcat6 --port&#x3D;80 --target-port&#x3D;8080 --type&#x3D;NodePort<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>pod 的 80 映射容器的 8080；server 会带来 pod 的 80</p>
<p>查看服务：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443&#x2F;TCP        12h
tomcat6      NodePort    10.96.24.191   &lt;none&gt;        80:30526&#x2F;TCP   49s
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get svc -o wide
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE     SELECTOR
kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443&#x2F;TCP        12h     &lt;none&gt;
tomcat6      NodePort    10.96.24.191   &lt;none&gt;        80:30526&#x2F;TCP   3m30s   app&#x3D;tomcat6
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><a target="_blank" rel="noopener" href="http://192.168.56.100:30526/">http://192.168.56.100:30526/</a></p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a21.png" class="" loading="lazy">
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get all
NAME                           READY   STATUS    RESTARTS   AGE
pod&#x2F;tomcat6-7b84fb5fdc-qt5jm   1&#x2F;1     Running   0          13m

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
service&#x2F;kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443&#x2F;TCP        12h
service&#x2F;tomcat6      NodePort    10.96.24.191   &lt;none&gt;        80:30526&#x2F;TCP   9m50s

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps&#x2F;tomcat6   1&#x2F;1     1            1           11h

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps&#x2F;tomcat6-7b84fb5fdc   1         1         1       11h
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3、动态扩容测试</p>
<p>kubectl get deployment</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get deployment
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
tomcat6   2&#x2F;2     2            2           11h
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>应用升级： kubectl set image (–help 查看帮助)<br>
扩容：kubectl scale --replicas=3 deployment tomcat6</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl scale --replicas&#x3D;3 deployment tomcat6
deployment.apps&#x2F;tomcat6 scaled
[root@k8s-node1 ~]# 

[root@k8s-node1 ~]# kubectl get pods -o wide
NAME                       READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-hdgmc   1&#x2F;1     Running   0          61s   10.244.2.5   k8s-node2   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-qt5jm   1&#x2F;1     Running   0          19m   10.244.1.2   k8s-node3   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-vlrh6   1&#x2F;1     Running   0          61s   10.244.2.4   k8s-node2   &lt;none&gt;           &lt;none&gt;
[root@k8s-node1 ~]# kubectl get svc -o wide    
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE   SELECTOR
kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443&#x2F;TCP        13h   &lt;none&gt;
tomcat6      NodePort    10.96.24.191   &lt;none&gt;        80:30526&#x2F;TCP   16m   app&#x3D;tomcat6
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>扩容了多份，所有无论访问哪个 node 的指定端口，都可以访问到 tomcat6</p>
<p><a target="_blank" rel="noopener" href="http://192.168.56.101:30526/">http://192.168.56.101:30526/</a></p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a22.png" class="" loading="lazy">
<p><a target="_blank" rel="noopener" href="http://192.168.56.102:30526/">http://192.168.56.102:30526/</a></p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a23.png" class="" loading="lazy">
<p>缩容：kubectl scale --replicas=2 deployment tomcat6</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]#  kubectl scale --replicas&#x3D;2 deployment tomcat6
deployment.apps&#x2F;tomcat6 scaled
[root@k8s-node1 ~]# kubectl get pods -o wide                       
NAME                       READY   STATUS        RESTARTS   AGE     IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-hdgmc   0&#x2F;1     Terminating   0          4m47s   &lt;none&gt;       k8s-node2   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-qt5jm   1&#x2F;1     Running       0          22m     10.244.1.2   k8s-node3   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-vlrh6   1&#x2F;1     Running       0          4m47s   10.244.2.4   k8s-node2   &lt;none&gt;           &lt;none&gt;
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4、以上操作的 yaml 获取<br>
参照 k8s 细节</p>
<p>5、删除<br>
kubectl get all</p>
<pre class="line-numbers language-none"><code class="language-none">#查看所有资源
[root@k8s-node1 ~]# kubectl get all
NAME                           READY   STATUS    RESTARTS   AGE
pod&#x2F;tomcat6-7b84fb5fdc-qt5jm   1&#x2F;1     Running   0          26m
pod&#x2F;tomcat6-7b84fb5fdc-vlrh6   1&#x2F;1     Running   0          8m16s

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
service&#x2F;kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443&#x2F;TCP        13h
service&#x2F;tomcat6      NodePort    10.96.24.191   &lt;none&gt;        80:30526&#x2F;TCP   22m

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps&#x2F;tomcat6   2&#x2F;2     2            2           11h

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps&#x2F;tomcat6-7b84fb5fdc   2         2         2       11h
[root@k8s-node1 ~]#
#删除deployment.apps&#x2F;tomcat6 
[root@k8s-node1 ~]# kubectl delete  deployment.apps&#x2F;tomcat6 
deployment.apps &quot;tomcat6&quot; deleted

#查看剩余的资源
[root@k8s-node1 ~]# kubectl get all   
NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
service&#x2F;kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443&#x2F;TCP        13h
service&#x2F;tomcat6      NodePort    10.96.24.191   &lt;none&gt;        80:30526&#x2F;TCP   30m
[root@k8s-node1 ~]# 
[root@k8s-node1 ~]#
#删除service&#x2F;tomcat6 
[root@k8s-node1 ~]# kubectl delete service&#x2F;tomcat6  
service &quot;tomcat6&quot; deleted
[root@k8s-node1 ~]# kubectl get all
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service&#x2F;kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443&#x2F;TCP   13h
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>kubectl delete deploye/nginx<br>
kubectl delete service/nginx-service</p>
<h2 id="3、K8s-细节"><a class="header-anchor" href="#3、K8s-细节">¶</a>3、K8s 细节</h2>
<h3 id="1、kubectl-文档"><a class="header-anchor" href="#1、kubectl-文档">¶</a>1、kubectl 文档</h3>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/">https://kubernetes.io/zh/docs/reference/kubectl/overview/</a></p>
<h3 id="2、资源类型"><a class="header-anchor" href="#2、资源类型">¶</a>2、资源类型</h3>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#%e8%b5%84%e6%ba%90%e7%b1%bb%e5%9e%8b">https://kubernetes.io/zh/docs/reference/kubectl/overview/#资源类型</a></p>
<h3 id="3、格式化输出"><a class="header-anchor" href="#3、格式化输出">¶</a>3、格式化输出</h3>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/">https://kubernetes.io/zh/docs/reference/kubectl/overview/</a></p>
<blockquote>
<p>所有 <code>kubectl</code> 命令的默认输出格式都是人类可读的纯文本格式。要以特定格式向终端窗口输出详细信息，可以将 <code>-o</code> 或 <code>--output</code> 参数添加到受支持的 <code>kubectl</code> 命令中。</p>
<h4 id="语法"><a class="header-anchor" href="#语法">¶</a>语法</h4>
<pre class="line-numbers language-none"><code class="language-none">kubectl [command] [TYPE] [NAME] -o&#x3D;&lt;output_format&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>根据 <code>kubectl</code> 操作，支持以下输出格式：</p>
<table><thead><tr><th align="left">Output format</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>-o custom-columns=</code></td><td align="left">使用逗号分隔的<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#custom-columns">自定义列</a>列表打印表。</td></tr><tr><td align="left"><code>-o custom-columns-file=</code></td><td align="left">使用 `` 文件中的<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#custom-columns">自定义列</a>模板打印表。</td></tr><tr><td align="left"><code>-o json</code></td><td align="left">输出 JSON 格式的 API 对象</td></tr><tr><td align="left">`-o jsonpath=</td><td align="left">打印 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubectl/jsonpath/">jsonpath</a> 表达式定义的字段</td></tr><tr><td align="left"><code>-o jsonpath-file=</code></td><td align="left">打印 `` 文件中 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubectl/jsonpath/">jsonpath</a> 表达式定义的字段。</td></tr><tr><td align="left"><code>-o name</code></td><td align="left">仅打印资源名称而不打印任何其他内容。</td></tr><tr><td align="left"><code>-o wide</code></td><td align="left">以纯文本格式输出，包含任何附加信息。对于 pod 包含节点名。</td></tr><tr><td align="left"><code>-o yaml</code></td><td align="left">输出 YAML 格式的 API 对象。</td></tr></tbody></table>
<h5 id="示例"><a class="header-anchor" href="#示例">¶</a>示例</h5>
<p>在此示例中，以下命令将单个 pod 的详细信息输出为 YAML 格式的对象：</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl get pod web-pod-13je7 -o yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>请记住：有关每个命令支持哪种输出格式的详细信息，请参阅 <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/user-guide/kubectl/">kubectl</a> 参考文档。</p>
</blockquote>
<p>–dry-run：</p>
<blockquote>
<p>–dry-run=‘none’: Must be “none”, “server”, or “client”. If client strategy, only print the object that would be</p>
<p>sent, without sending it. If server strategy, submit server-side request without persisting the resource.</p>
<p>值必须为 none，server 或 client。如果是客户端策略，则只打印该发送对象，但不发送它。如果服务器策略，提交服务器端请求而不持久化资源。</p>
<p>也就是说，通过–dry-run 选项，并不会真正的执行这条命令。</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl create deployment tomcat6 --image&#x3D;tomcat:6.0.53-jre8 --dry-run -o yaml
W0504 03:39:08.389369    8107 helpers.go:535] --dry-run is deprecated and can be replaced with --dry-run&#x3D;client.
apiVersion: apps&#x2F;v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: tomcat6
  name: tomcat6
spec:
  replicas: 1
  selector:
    matchLabels:
      app: tomcat6
  strategy: &#123;&#125;
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: tomcat6
    spec:
      containers:
      - image: tomcat:6.0.53-jre8
        name: tomcat
        resources: &#123;&#125;
status: &#123;&#125;
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实际上我们也可以将这个 yaml 输出到文件，然后使用 kubectl apply -f 来应用它</p>
<pre class="line-numbers language-none"><code class="language-none">#输出到tomcat6.yaml 
[root@k8s-node1 ~]# kubectl create deployment tomcat6 --image&#x3D;tomcat:6.0.53-jre8 --dry-run -o yaml &gt;tomcat6.yaml
W0504 03:46:18.180366   11151 helpers.go:535] --dry-run is deprecated and can be replaced with --dry-run&#x3D;client.

#修改副本数为3
[root@k8s-node1 ~]# cat tomcat6.yaml 
apiVersion: apps&#x2F;v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: tomcat6
  name: tomcat6
spec:
  replicas: 3     #修改副本数为3
  selector:
    matchLabels:
      app: tomcat6
  strategy: &#123;&#125;
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: tomcat6
    spec:
      containers:
      - image: tomcat:6.0.53-jre8
        name: tomcat
        resources: &#123;&#125;
status: &#123;&#125;

#应用tomcat6.yaml 
[root@k8s-node1 ~]# kubectl apply -f tomcat6.yaml 
deployment.apps&#x2F;tomcat6 created
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看 pods：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get pods  
NAME                       READY   STATUS    RESTARTS   AGE
tomcat6-7b84fb5fdc-5jh6t   1&#x2F;1     Running   0          8s
tomcat6-7b84fb5fdc-8lhwv   1&#x2F;1     Running   0          8s
tomcat6-7b84fb5fdc-j4qmh   1&#x2F;1     Running   0          8s
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看某个 pod 的具体信息：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get pods tomcat6-7b84fb5fdc-5jh6t  -o yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">apiVersion: v1
kind: Pod
metadata:
  creationTimestamp: &quot;2020-05-04T03:50:47Z&quot;
  generateName: tomcat6-7b84fb5fdc-
  labels:
    app: tomcat6
    pod-template-hash: 7b84fb5fdc
  managedFields:
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:generateName: &#123;&#125;
        f:labels:
          .: &#123;&#125;
          f:app: &#123;&#125;
          f:pod-template-hash: &#123;&#125;
        f:ownerReferences:
          .: &#123;&#125;
          k:&#123;&quot;uid&quot;:&quot;292bfe3b-dd63-442e-95ce-c796ab5bdcc1&quot;&#125;:
            .: &#123;&#125;
            f:apiVersion: &#123;&#125;
            f:blockOwnerDeletion: &#123;&#125;
            f:controller: &#123;&#125;
            f:kind: &#123;&#125;
            f:name: &#123;&#125;
            f:uid: &#123;&#125;
      f:spec:
        f:containers:
          k:&#123;&quot;name&quot;:&quot;tomcat&quot;&#125;:
            .: &#123;&#125;
            f:image: &#123;&#125;
            f:imagePullPolicy: &#123;&#125;
            f:name: &#123;&#125;
            f:resources: &#123;&#125;
            f:terminationMessagePath: &#123;&#125;
            f:terminationMessagePolicy: &#123;&#125;
        f:dnsPolicy: &#123;&#125;
        f:enableServiceLinks: &#123;&#125;
        f:restartPolicy: &#123;&#125;
        f:schedulerName: &#123;&#125;
        f:securityContext: &#123;&#125;
        f:terminationGracePeriodSeconds: &#123;&#125;
    manager: kube-controller-manager
    operation: Update
    time: &quot;2020-05-04T03:50:47Z&quot;
  - apiVersion: v1
    fieldsType: FieldsV1
    fieldsV1:
      f:status:
        f:conditions:
          k:&#123;&quot;type&quot;:&quot;ContainersReady&quot;&#125;:
            .: &#123;&#125;
            f:lastProbeTime: &#123;&#125;
            f:lastTransitionTime: &#123;&#125;
            f:status: &#123;&#125;
            f:type: &#123;&#125;
          k:&#123;&quot;type&quot;:&quot;Initialized&quot;&#125;:
            .: &#123;&#125;
            f:lastProbeTime: &#123;&#125;
            f:lastTransitionTime: &#123;&#125;
            f:status: &#123;&#125;
            f:type: &#123;&#125;
          k:&#123;&quot;type&quot;:&quot;Ready&quot;&#125;:
            .: &#123;&#125;
            f:lastProbeTime: &#123;&#125;
            f:lastTransitionTime: &#123;&#125;
            f:status: &#123;&#125;
            f:type: &#123;&#125;
        f:containerStatuses: &#123;&#125;
        f:hostIP: &#123;&#125;
        f:phase: &#123;&#125;
        f:podIP: &#123;&#125;
        f:podIPs:
          .: &#123;&#125;
          k:&#123;&quot;ip&quot;:&quot;10.244.2.7&quot;&#125;:
            .: &#123;&#125;
            f:ip: &#123;&#125;
        f:startTime: &#123;&#125;
    manager: kubelet
    operation: Update
    time: &quot;2020-05-04T03:50:49Z&quot;
  name: tomcat6-7b84fb5fdc-5jh6t
  namespace: default
  ownerReferences:
  - apiVersion: apps&#x2F;v1
    blockOwnerDeletion: true
    controller: true
    kind: ReplicaSet
    name: tomcat6-7b84fb5fdc
    uid: 292bfe3b-dd63-442e-95ce-c796ab5bdcc1
  resourceVersion: &quot;46229&quot;
  selfLink: &#x2F;api&#x2F;v1&#x2F;namespaces&#x2F;default&#x2F;pods&#x2F;tomcat6-7b84fb5fdc-5jh6t
  uid: 2f661212-3b03-47e4-bcb8-79782d5c7578
spec:
  containers:
  - image: tomcat:6.0.53-jre8
    imagePullPolicy: IfNotPresent
    name: tomcat
    resources: &#123;&#125;
    terminationMessagePath: &#x2F;dev&#x2F;termination-log
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: &#x2F;var&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount
      name: default-token-bxqtw
      readOnly: true
  dnsPolicy: ClusterFirst
  enableServiceLinks: true
  nodeName: k8s-node2
  priority: 0
  restartPolicy: Always
  schedulerName: default-scheduler
  securityContext: &#123;&#125;
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: 30
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io&#x2F;not-ready
    operator: Exists
    tolerationSeconds: 300
  - effect: NoExecute
    key: node.kubernetes.io&#x2F;unreachable
    operator: Exists
    tolerationSeconds: 300
  volumes:
  - name: default-token-bxqtw
    secret:
      defaultMode: 420
      secretName: default-token-bxqtw
status:
  conditions:
  - lastProbeTime: null
    lastTransitionTime: &quot;2020-05-04T03:50:47Z&quot;
    status: &quot;True&quot;
    type: Initialized
  - lastProbeTime: null
    lastTransitionTime: &quot;2020-05-04T03:50:49Z&quot;
    status: &quot;True&quot;
    type: Ready
  - lastProbeTime: null
    lastTransitionTime: &quot;2020-05-04T03:50:49Z&quot;
    status: &quot;True&quot;
    type: ContainersReady
  - lastProbeTime: null
    lastTransitionTime: &quot;2020-05-04T03:50:47Z&quot;
    status: &quot;True&quot;
    type: PodScheduled
  containerStatuses:
  - containerID: docker:&#x2F;&#x2F;18eb0798384ea44ff68712cda9be94b6fb96265206c554a15cee28c288879304
    image: tomcat:6.0.53-jre8
    imageID: docker-pullable:&#x2F;&#x2F;tomcat@sha256:8c643303012290f89c6f6852fa133b7c36ea6fbb8eb8b8c9588a432beb24dc5d
    lastState: &#123;&#125;
    name: tomcat
    ready: true
    restartCount: 0
    started: true
    state:
      running:
        startedAt: &quot;2020-05-04T03:50:49Z&quot;
  hostIP: 10.0.2.4
  phase: Running
  podIP: 10.244.2.7
  podIPs:
  - ip: 10.244.2.7
  qosClass: BestEffort
  startTime: &quot;2020-05-04T03:50:47Z&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="命令参考"><a class="header-anchor" href="#命令参考">¶</a>命令参考</h3>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a24.png" class="" loading="lazy">
<h3 id="service-的意义"><a class="header-anchor" href="#service-的意义">¶</a>service 的意义</h3>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a25.png" class="" loading="lazy">
<p>前面我们通过命令行的方式，部署和暴露了 tomcat，实际上也可以通过 yaml 的方式来完成这些操作。</p>
<pre class="line-numbers language-none"><code class="language-none">#这些操作实际上是为了获取Deployment的yaml模板
[root@k8s-node1 ~]#  kubectl create deployment tomcat6 --image&#x3D;tomcat:6.0.53-jre8 --dry-run -o yaml &gt;tomcat6-deployment.yaml
W0504 04:13:28.265432   24263 helpers.go:535] --dry-run is deprecated and can be replaced with --dry-run&#x3D;client.
[root@k8s-node1 ~]# ls tomcat6-deployment.yaml
tomcat6-deployment.yaml
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>修改 “tomcat6-deployment.yaml” 内容如下：</p>
<pre class="line-numbers language-none"><code class="language-none">apiVersion: apps&#x2F;v1
kind: Deployment
metadata:
  labels:
    app: tomcat6
  name: tomcat6
spec:
  replicas: 3
  selector:
    matchLabels:
      app: tomcat6
  template:
    metadata: 
      labels:
        app: tomcat6
    spec:
      containers:
      - image: tomcat:6.0.53-jre8
        name: tomcat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">#部署
[root@k8s-node1 ~]# kubectl apply -f tomcat6-deployment.yaml
deployment.apps&#x2F;tomcat6 configured


#查看资源
[root@k8s-node1 ~]# kubectl get all
NAME                           READY   STATUS    RESTARTS   AGE
pod&#x2F;tomcat6-7b84fb5fdc-5jh6t   1&#x2F;1     Running   0          27m
pod&#x2F;tomcat6-7b84fb5fdc-8lhwv   1&#x2F;1     Running   0          27m
pod&#x2F;tomcat6-7b84fb5fdc-j4qmh   1&#x2F;1     Running   0          27m

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service&#x2F;kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443&#x2F;TCP   14h

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps&#x2F;tomcat6   3&#x2F;3     3            3           27m

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps&#x2F;tomcat6-7b84fb5fdc   3         3         3       27m
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">kubectl expose deployment tomcat6 --port&#x3D;80 --target-port&#x3D;8080 --type&#x3D;NodePort  --dry-run -o yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app: tomcat6
  name: tomcat6
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 8080
  selector:
    app: tomcat6
  type: NodePort
status:
  loadBalancer: &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将这段输出和 “tomcat6-deployment.yaml” 进行拼接，表示部署完毕并进行暴露服务：</p>
<pre class="line-numbers language-none"><code class="language-none">apiVersion: apps&#x2F;v1
kind: Deployment
metadata:
  labels:
    app: tomcat6
  name: tomcat6
spec:
  replicas: 3
  selector:
    matchLabels:
      app: tomcat6
  template:
    metadata: 
      labels:
        app: tomcat6
    spec:
      containers:
      - image: tomcat:6.0.53-jre8
        name: tomcat
---
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  labels:
    app: tomcat6
  name: tomcat6
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 8080
  selector:
    app: tomcat6
  type: NodePort<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>部署并暴露服务</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl apply -f tomcat6-deployment.yaml
deployment.apps&#x2F;tomcat6 created
service&#x2F;tomcat6 created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>查看服务和部署信息</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# kubectl get all
NAME                           READY   STATUS    RESTARTS   AGE
pod&#x2F;tomcat6-7b84fb5fdc-dsqmb   1&#x2F;1     Running   0          4s
pod&#x2F;tomcat6-7b84fb5fdc-gbmxc   1&#x2F;1     Running   0          5s
pod&#x2F;tomcat6-7b84fb5fdc-kjlc6   1&#x2F;1     Running   0          4s

NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service&#x2F;kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443&#x2F;TCP        14h
service&#x2F;tomcat6      NodePort    10.96.147.210   &lt;none&gt;        80:30172&#x2F;TCP   4s

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps&#x2F;tomcat6   3&#x2F;3     3            3           5s

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps&#x2F;tomcat6-7b84fb5fdc   3         3         3       5s
[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问 node1，node1 和 node3 的 30172 端口：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# curl -I http:&#x2F;&#x2F;192.168.56.&#123;100,101,102&#125;:30172&#x2F;
HTTP&#x2F;1.1 200 OK
Server: Apache-Coyote&#x2F;1.1
Accept-Ranges: bytes
ETag: W&#x2F;&quot;7454-1491118183000&quot;
Last-Modified: Sun, 02 Apr 2017 07:29:43 GMT
Content-Type: text&#x2F;html
Content-Length: 7454
Date: Mon, 04 May 2020 04:35:35 GMT

HTTP&#x2F;1.1 200 OK
Server: Apache-Coyote&#x2F;1.1
Accept-Ranges: bytes
ETag: W&#x2F;&quot;7454-1491118183000&quot;
Last-Modified: Sun, 02 Apr 2017 07:29:43 GMT
Content-Type: text&#x2F;html
Content-Length: 7454
Date: Mon, 04 May 2020 04:35:35 GMT

HTTP&#x2F;1.1 200 OK
Server: Apache-Coyote&#x2F;1.1
Accept-Ranges: bytes
ETag: W&#x2F;&quot;7454-1491118183000&quot;
Last-Modified: Sun, 02 Apr 2017 07:29:43 GMT
Content-Type: text&#x2F;html
Content-Length: 7454
Date: Mon, 04 May 2020 04:35:35 GMT

[root@k8s-node1 ~]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Ingress"><a class="header-anchor" href="#Ingress">¶</a>Ingress</h3>
<p>通过 Ingress 发现 pod 进行关联。基于域名访问<br>
通过 Ingress controller 实现 POD 负载均衡<br>
支持 TCP/UDP 4 层负载均衡和 HTTP 7 层负载均衡</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a26.png" class="" loading="lazy">
<p>步骤：<br>
（1）部署 Ingress controller</p>
<p>执行 “k8s/ingress-controller.yaml”</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl apply -f ingress-controller.yaml 
namespace&#x2F;ingress-nginx created
configmap&#x2F;nginx-configuration created
configmap&#x2F;tcp-services created
configmap&#x2F;udp-services created
serviceaccount&#x2F;nginx-ingress-serviceaccount created
clusterrole.rbac.authorization.k8s.io&#x2F;nginx-ingress-clusterrole created
role.rbac.authorization.k8s.io&#x2F;nginx-ingress-role created
rolebinding.rbac.authorization.k8s.io&#x2F;nginx-ingress-role-nisa-binding created
clusterrolebinding.rbac.authorization.k8s.io&#x2F;nginx-ingress-clusterrole-nisa-binding created
daemonset.apps&#x2F;nginx-ingress-controller created
service&#x2F;ingress-nginx created
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get pods --all-namespaces
NAMESPACE       NAME                                READY   STATUS              RESTARTS   AGE
default         tomcat6-7b84fb5fdc-dsqmb            1&#x2F;1     Running             0          16m
default         tomcat6-7b84fb5fdc-gbmxc            1&#x2F;1     Running             0          16m
default         tomcat6-7b84fb5fdc-kjlc6            1&#x2F;1     Running             0          16m
ingress-nginx   nginx-ingress-controller-9q6cs      0&#x2F;1     ContainerCreating   0          40s
ingress-nginx   nginx-ingress-controller-qx572      0&#x2F;1     ContainerCreating   0          40s
kube-system     coredns-546565776c-9sbmk            1&#x2F;1     Running             1          14h
kube-system     coredns-546565776c-t68mr            1&#x2F;1     Running             1          14h
kube-system     etcd-k8s-node1                      1&#x2F;1     Running             1          14h
kube-system     kube-apiserver-k8s-node1            1&#x2F;1     Running             1          14h
kube-system     kube-controller-manager-k8s-node1   1&#x2F;1     Running             1          14h
kube-system     kube-flannel-ds-amd64-5xs5j         1&#x2F;1     Running             2          13h
kube-system     kube-flannel-ds-amd64-6xwth         1&#x2F;1     Running             2          14h
kube-system     kube-flannel-ds-amd64-fvnvx         1&#x2F;1     Running             1          13h
kube-system     kube-proxy-7tkvl                    1&#x2F;1     Running             1          13h
kube-system     kube-proxy-mvlnk                    1&#x2F;1     Running             2          13h
kube-system     kube-proxy-sz2vz                    1&#x2F;1     Running             1          14h
kube-system     kube-scheduler-k8s-node1            1&#x2F;1     Running             1          14h
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里 master 节点负责调度，具体执行交给 node2 和 node3 来完成，能够看到它们正在下载镜像</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a27.png" class="" loading="lazy">
<p>（2）创建 Ingress 规则</p>
<pre class="line-numbers language-none"><code class="language-none">apiVersion: extensions&#x2F;v1beta1
kind: Ingress
metadata:
  name: web
spec:
  rules:
  - host: tomcat6.kubenetes.com
    http:
       paths: 
          - backend: 
              serviceName: tomcat6
              servicePort: 80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# touch ingress-tomcat6.yaml
#将上面的规则，添加到ingress-tomcat6.yaml文件中
[root@k8s-node1 k8s]# vi  ingress-tomcat6.yaml  
 
[root@k8s-node1 k8s]# kubectl apply -f ingress-tomcat6.yaml 
ingress.extensions&#x2F;web created
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>修改本机的 hosts 文件，添加如下的域名转换规则：</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.56.102 tomcat6.kubenetes.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>测试: <a target="_blank" rel="noopener" href="http://tomcat6.kubenetes.com/">http://tomcat6.kubenetes.com/</a></p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a28.png" class="" loading="lazy">
<p>并且集群中即便有一个节点不可用，也不影响整体的运行。</p>
<h2 id="安装-kubernetes-可视化界面——DashBoard"><a class="header-anchor" href="#安装-kubernetes-可视化界面——DashBoard">¶</a>安装 kubernetes 可视化界面——DashBoard</h2>
<p>1、部署 DashBoard</p>
<pre class="line-numbers language-none"><code class="language-none">$ kubectl appy -f  kubernetes-dashboard.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>文件在 “k8s” 源码目录提供</p>
<p>2、暴露 DashBoard 为公共访问</p>
<p>默认 DashBoard 只能集群内部访问，修改 Service 为 NodePort 类型，暴露到外部</p>
<pre class="line-numbers language-none"><code class="language-none">kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  type: NodePort
  ports:
    - port: 443
      targetPort: 8443
      nodePort: 3001
  selector:
    k8s-app: kubernetes-dashboard<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问地址：<a target="_blank" rel="noopener" href="http://NodeIP:30001">http://NodeIP:30001</a></p>
<p>3、创建授权账号</p>
<pre class="line-numbers language-none"><code class="language-none">$ kubectl create serviceaccount dashboar-admin -n kube-sysem<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">$ kubectl create clusterrolebinding dashboar-admin --clusterrole&#x3D;cluter-admin --serviceaccount&#x3D;kube-system:dashboard-admin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">$ kubectl describe secrets -n kube-system $( kubectl -n kube-system get secret |awk &#39;&#x2F;dashboard-admin&#x2F;&#123;print $1&#125;&#39; )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>使用输出的 token 登录 dashboard</p>
<img src="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/a29.png" class="" loading="lazy">
<h2 id="kubesphere"><a class="header-anchor" href="#kubesphere">¶</a>kubesphere</h2>
<p>默认的 dashboard 没啥用，我们用 kubesphere 可以打通全部的 devops 链路，kubesphere 集成了很多套件，集群要求比较高<br>
<a target="_blank" rel="noopener" href="https://kubesphere.io">https://kubesphere.io</a></p>
<p>kuboard 也很不错，集群要求不高<br>
<a target="_blank" rel="noopener" href="https://kuboard.cn/support/">https://kuboard.cn/support/</a></p>
<h3 id="1、简洁"><a class="header-anchor" href="#1、简洁">¶</a>1、简洁</h3>
<p>kubesphere 是一款面向云原声设计的开源项目，在目前主流容器调度平台 kubernets 智商构建的分布式多用户容器管理平台，提供简单易用的操作界面以及向导式操作方式，在降低用户使用容器调度平台学习成本的同时，极大降低开发、测试、运维的日常工作的复杂度。</p>
<h3 id="2、安装前提提交"><a class="header-anchor" href="#2、安装前提提交">¶</a>2、安装前提提交</h3>
<h4 id="1、安装-helm（master-节点执行）"><a class="header-anchor" href="#1、安装-helm（master-节点执行）">¶</a>1、安装 helm（master 节点执行）</h4>
<p>helm 是 kubernetes 的包管理器。包管理器类似于在 Ubuntu 中使用的 apt，centos 中的 yum 或者 python 中的 pip 一样，能够快速查找，下载和安装软件包。Helm 有客户端组件 helm 和服务端组件 Tiller 组成，能够将一组 K8S 资源打包统一管理，是查找、共享和使用为 Kubernetes 构建的软件的最佳方式。</p>
<p>1）安装</p>
<pre class="line-numbers language-none"><code class="language-none">curl -L https:&#x2F;&#x2F;git.io&#x2F;get_helm.sh|bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>由于被墙的原因，使用我们给定的 get_helm.sh。</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# ll
total 68
-rw-r--r-- 1 root root  7149 Feb 27 01:58 get_helm.sh
-rw-r--r-- 1 root root  6310 Feb 28 05:16 ingress-controller.yaml
-rw-r--r-- 1 root root   209 Feb 28 13:18 ingress-demo.yml
-rw-r--r-- 1 root root   236 May  4 05:09 ingress-tomcat6.yaml
-rwxr--r-- 1 root root 15016 Feb 26 15:05 kube-flannel.yml
-rw-r--r-- 1 root root  4737 Feb 26 15:38 kubernetes-dashboard.yaml
-rw-r--r-- 1 root root  3841 Feb 27 01:09 kubesphere-complete-setup.yaml
-rw-r--r-- 1 root root   392 Feb 28 11:33 master_images.sh
-rw-r--r-- 1 root root   283 Feb 28 11:34 node_images.sh
-rw-r--r-- 1 root root  1053 Feb 28 03:53 product.yaml
-rw-r--r-- 1 root root   931 May  3 10:08 Vagrantfile
[root@k8s-node1 k8s]# sh get_helm.sh 
Downloading https:&#x2F;&#x2F;get.helm.sh&#x2F;helm-v2.16.6-linux-amd64.tar.gz
Preparing to install helm and tiller into &#x2F;usr&#x2F;local&#x2F;bin
helm installed into &#x2F;usr&#x2F;local&#x2F;bin&#x2F;helm
tiller installed into &#x2F;usr&#x2F;local&#x2F;bin&#x2F;tiller
Run &#39;helm init&#39; to configure helm.
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2）验证版本</p>
<pre class="line-numbers language-none"><code class="language-none">helm version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>3）创建权限（master 执行）</p>
<p>创建 helm-rbac.yaml，写入如下内容</p>
<pre class="line-numbers language-none"><code class="language-none">apiVersion: v1
kind: ServiceAccount
metadata:
  name: tiller
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io&#x2F;v1
kind: ClusterRoleBinding
metadata:
  name: tiller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
  - kind: ServiceAccount
    name: kubernetes-dashboard
    namespace: kube-system<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>应用配置：</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]#  kubectl apply -f helm-rbac.yaml
serviceaccount&#x2F;tiller created
clusterrolebinding.rbac.authorization.k8s.io&#x2F;tiller created
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="2、安装-Tilller（Master-执行）"><a class="header-anchor" href="#2、安装-Tilller（Master-执行）">¶</a>2、安装 Tilller（Master 执行）</h4>
<p>1、初始化</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# helm init --service-account&#x3D;tiller --tiller-image&#x3D;sapcc&#x2F;tiller:v2.16.3 --history-max 300 
Creating &#x2F;root&#x2F;.helm 
Creating &#x2F;root&#x2F;.helm&#x2F;repository 
Creating &#x2F;root&#x2F;.helm&#x2F;repository&#x2F;cache 
Creating &#x2F;root&#x2F;.helm&#x2F;repository&#x2F;local 
Creating &#x2F;root&#x2F;.helm&#x2F;plugins 
Creating &#x2F;root&#x2F;.helm&#x2F;starters 
Creating &#x2F;root&#x2F;.helm&#x2F;cache&#x2F;archive 
Creating &#x2F;root&#x2F;.helm&#x2F;repository&#x2F;repositories.yaml 
Adding stable repo with URL: https:&#x2F;&#x2F;kubernetes-charts.storage.googleapis.com 
Adding local repo with URL: http:&#x2F;&#x2F;127.0.0.1:8879&#x2F;charts 
$HELM_HOME has been configured at &#x2F;root&#x2F;.helm.

Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.

Please note: by default, Tiller is deployed with an insecure &#39;allow unauthenticated users&#39; policy.
To prevent this, run &#96;helm init&#96; with the --tiller-tls-verify flag.
For more information on securing your installation see: https:&#x2F;&#x2F;v2.helm.sh&#x2F;docs&#x2F;securing_installation&#x2F;
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>–tiller-image 指定镜像，否则会被墙，等待节点上部署的 tiller 完成即可。</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]#  kubectl get pods -n kube-system
NAME                                   READY   STATUS             RESTARTS   AGE
coredns-546565776c-9sbmk               1&#x2F;1     Running            3          23h
coredns-546565776c-t68mr               1&#x2F;1     Running            3          23h
etcd-k8s-node1                         1&#x2F;1     Running            3          23h
kube-apiserver-k8s-node1               1&#x2F;1     Running            3          23h
kube-controller-manager-k8s-node1      1&#x2F;1     Running            3          23h
kube-flannel-ds-amd64-5xs5j            1&#x2F;1     Running            4          22h
kube-flannel-ds-amd64-6xwth            1&#x2F;1     Running            5          23h
kube-flannel-ds-amd64-fvnvx            1&#x2F;1     Running            4          22h
kube-proxy-7tkvl                       1&#x2F;1     Running            3          22h
kube-proxy-mvlnk                       1&#x2F;1     Running            4          22h
kube-proxy-sz2vz                       1&#x2F;1     Running            3          23h
kube-scheduler-k8s-node1               1&#x2F;1     Running            3          23h
kubernetes-dashboard-975499656-jxczv   0&#x2F;1     ImagePullBackOff   0          7h45m
tiller-deploy-8cc566858-67bxb          1&#x2F;1     Running            0          31s
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>查看集群的所有节点信息：</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl get node -o wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]#  kubectl get node -o wide
NAME        STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION               CONTAINER-RUNTIME
k8s-node1   Ready    master   23h   v1.17.3   10.0.2.15     &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.12.2.el7.x86_64   docker:&#x2F;&#x2F;19.3.8
k8s-node2   Ready    &lt;none&gt;   22h   v1.17.3   10.0.2.4      &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.12.2.el7.x86_64   docker:&#x2F;&#x2F;19.3.8
k8s-node3   Ready    &lt;none&gt;   22h   v1.17.3   10.0.2.5      &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.12.2.el7.x86_64   docker:&#x2F;&#x2F;19.3.8
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>2、测试</p>
<pre class="line-numbers language-none"><code class="language-none">helm install stable&#x2F;nginx-ingress --name nginx-ingress<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>最小化安装 KubeSphere</p>
<p>若集群可用 CPU &gt; 1 Core 且可用内存 &gt; 2 G，可以使用以下命令最小化安装 KubeSphere：</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl apply -f https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubesphere&#x2F;ks-installer&#x2F;master&#x2F;kubesphere-minimal.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>提示：若您的服务器提示无法访问 GitHub，可将</strong> <a target="_blank" rel="noopener" href="https://github.com/kubesphere/ks-installer/blob/master/kubesphere-minimal.yaml">kubesphere-minimal.yaml</a> <strong>或</strong> <a target="_blank" rel="noopener" href="https://github.com/kubesphere/ks-installer/blob/master/kubesphere-complete-setup.yaml">kubesphere-complete-setup.yaml</a> <strong>文件保存到本地作为本地的静态文件，再参考上述命令进行安装。</strong></p>
<ol>
<li>查看滚动刷新的安装日志，请耐心等待安装成功。</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">$ kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l app&#x3D;ks-install -o jsonpath&#x3D;&#39;&#123;.items[0].metadata.name&#125;&#39;) -f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<blockquote>
<p>说明：安装过程中若遇到问题，也可以通过以上日志命令来排查问题。</p>
</blockquote>
</div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/alipay-qrcode.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/qqpay-qrcode.png" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg"><img loading="lazy" src="https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/donate/wechatpay-qrcode.jpg" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>momo</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/" title="谷粒商城笔记_分布式集群4">https://ppxiaodi.github.io/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_%E5%88%86%E5%B8%83%E5%BC%8F%E9%9B%86%E7%BE%A44/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E_%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81redisson%E4%B8%8E%E7%BC%93%E5%AD%98/" rel="prev" title="谷粒商城_分布式锁redisson与缓存"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">谷粒商城_分布式锁redisson与缓存</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/03/14/CollectionNote/java/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E%E7%AC%94%E8%AE%B0_ElasticSearch/" rel="next" title="谷粒商城笔记_ElasticSearch"><span class="post-nav-text">谷粒商城笔记_ElasticSearch</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> momo</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.7.0</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="搜索..." value=""></div><div id="local-search-result"></div></div></div></body></html>